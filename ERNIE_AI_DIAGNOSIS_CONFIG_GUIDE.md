# ç™¾åº¦æ–‡å¿ƒä¸€è¨€ï¼ˆERNIEï¼‰AIè¯Šæ–­ç³»ç»Ÿ - å®Œæ•´é…ç½®æŒ‡å—

> **é…ç½®æ—¥æœŸ**: 2025å¹´10æœˆ24æ—¥  
> **ç³»ç»Ÿç‰ˆæœ¬**: v2.0  
> **æ¯æ—¥é¢„ç®—**: Â¥10å…ƒ  
> **ä¸»è¦åœºæ™¯**: å›¾ç‰‡+æ–‡æœ¬ç»¼åˆè¯Šæ–­  

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [ä¸‰å±‚æ¨¡å‹é…ç½®](#ä¸‰å±‚æ¨¡å‹é…ç½®)
3. [æ™ºèƒ½è·¯ç”±ç­–ç•¥](#æ™ºèƒ½è·¯ç”±ç­–ç•¥)
4. [æˆæœ¬æ§åˆ¶æœºåˆ¶](#æˆæœ¬æ§åˆ¶æœºåˆ¶)
5. [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
6. [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
7. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
9. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å°ç¨‹åºå‰ç«¯ (ai-diagnosis.ts)          â”‚
â”‚  - ç”¨æˆ·è¾“å…¥ç—‡çŠ¶                                   â”‚
â”‚  - ä¸Šä¼ å›¾ç‰‡ï¼ˆæœ€å¤š2å¼ ï¼Œå‹ç¼©è‡³1024x1024, 50%è´¨é‡ï¼‰ â”‚
â”‚  - æäº¤è¯Šæ–­è¯·æ±‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       äº‘å‡½æ•°ï¼šai-diagnosis                      â”‚
â”‚  - åˆ›å»ºè¯Šæ–­ä»»åŠ¡                                   â”‚
â”‚  - ä¿å­˜åˆ° health_ai_diagnosis é›†åˆ               â”‚
â”‚  - è§¦å‘å¼‚æ­¥å¤„ç†                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    äº‘å‡½æ•°ï¼šprocess-ai-diagnosis                 â”‚
â”‚  - æ™ºèƒ½ä»»åŠ¡ç±»å‹é€‰æ‹©                               â”‚
â”‚  - å¤æ‚åº¦è¯„ä¼°                                     â”‚
â”‚  - ç´§æ€¥åº¦åˆ¤æ–­                                     â”‚
â”‚  - å›¾ç‰‡ä»·å€¼åˆ†æ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      äº‘å‡½æ•°ï¼šai-multi-modelï¼ˆæ ¸å¿ƒè·¯ç”±ï¼‰         â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   æˆæœ¬æ§åˆ¶å™¨ï¼ˆDailyCostControllerï¼‰     â”‚    â”‚
â”‚  â”‚  - è·å–ä»Šæ—¥å·²ç”¨é¢åº¦                     â”‚    â”‚
â”‚  â”‚  - è®¡ç®—å‰©ä½™é¢„ç®—                         â”‚    â”‚
â”‚  â”‚  - æ™ºèƒ½é™çº§ç­–ç•¥                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                              â”‚
â”‚                   â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚        æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨                   â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  æœ‰å›¾ç‰‡ï¼Ÿ â”€â”€YESâ”€â”€> ERNIE 4.5 VL (2åˆ†)  â”‚    â”‚
â”‚  â”‚     â”‚                                    â”‚    â”‚
â”‚  â”‚     NO                                   â”‚    â”‚
â”‚  â”‚     â”‚                                    â”‚    â”‚
â”‚  â”‚  å¤æ‚ï¼Ÿâ”€â”€YESâ”€â”€> ERNIE 4.0 Turbo (0.6åˆ†) â”‚    â”‚
â”‚  â”‚     â”‚                                    â”‚    â”‚
â”‚  â”‚     NO                                   â”‚    â”‚
â”‚  â”‚     â”‚                                    â”‚    â”‚
â”‚  â”‚     â””â”€â”€â”€â”€> ERNIE-Speed-128K (å…è´¹)      â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                              â”‚
â”‚                   â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚       ç™¾åº¦APIè®¤è¯ä¸è°ƒç”¨                 â”‚    â”‚
â”‚  â”‚  - è·å–Access Tokenï¼ˆç¼“å­˜30å¤©ï¼‰         â”‚    â”‚
â”‚  â”‚  - å›¾ç‰‡Base64è½¬æ¢ï¼ˆ4MBé™åˆ¶ï¼‰            â”‚    â”‚
â”‚  â”‚  - æ¶ˆæ¯æ ¼å¼è½¬æ¢                         â”‚    â”‚
â”‚  â”‚  - APIè¯·æ±‚ä¸å“åº”è§£æ                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                              â”‚
â”‚                   â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚       æˆæœ¬è®°å½•ï¼ˆsys_ai_usageï¼‰          â”‚    â”‚
â”‚  â”‚  - æ¨¡å‹ID                               â”‚    â”‚
â”‚  â”‚  - è°ƒç”¨æˆæœ¬                             â”‚    â”‚
â”‚  â”‚  - Tokenæ¶ˆè€—                            â”‚    â”‚
â”‚  â”‚  - æ—¥æœŸæ—¶é—´                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¿”å›è¯Šæ–­ç»“æœ                        â”‚
â”‚  - ä¸»è¦è¯Šæ–­ï¼ˆç–¾ç—…åç§°ã€ç½®ä¿¡åº¦ã€æ¨ç†è¿‡ç¨‹ï¼‰         â”‚
â”‚  - é‰´åˆ«è¯Šæ–­                                       â”‚
â”‚  - æ²»ç–—å»ºè®®                                       â”‚
â”‚  - å›¾ç‰‡åˆ†æï¼ˆå¦‚æœ‰ï¼‰                               â”‚
â”‚  - é¢„ç®—æç¤ºï¼ˆå¦‚é™çº§ï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– ä¸‰å±‚æ¨¡å‹é…ç½®

### 1ï¸âƒ£ ERNIE-Speed-128Kï¼ˆå…è´¹ä¸»åŠ›ï¼‰

**ç”¨é€”**: å¸¸è§„æ–‡æœ¬è¯Šæ–­  
**æˆæœ¬**: **å®Œå…¨å…è´¹**ï¼ˆæ¯æœˆ30,000æ¬¡ï¼‰  
**é€‚ç”¨åœºæ™¯**:
- æ—¥å¸¸å¥åº·æ£€æŸ¥ï¼ˆ80%çš„è¯Šæ–­è¯·æ±‚ï¼‰
- ç—‡çŠ¶ç®€å•æ˜ç¡®
- æ— å›¾ç‰‡æˆ–å›¾ç‰‡ä¸æ¸…æ™°æ—¶çš„é™çº§æ–¹æ¡ˆ

**é…ç½®ä»£ç **:
```javascript
'ernie-speed-128k': {
  provider: 'ç™¾åº¦æ–‡å¿ƒ',
  baseURL: 'https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/',
  endpoint: 'ernie-speed-128k',
  model: 'ERNIE-Speed-128K',
  apiKey: process.env.ERNIE_API_KEY,
  secretKey: process.env.ERNIE_SECRET_KEY,
  maxTokens: 128000,
  costPerKToken: 0,
  freeQuotaPerMonth: 30000,
  supportVision: false
}
```

**ç‰¹ç‚¹**:
- âœ… 128Kè¶…é•¿ä¸Šä¸‹æ–‡
- âœ… å“åº”é€Ÿåº¦å¿«ï¼ˆ5-8ç§’ï¼‰
- âœ… ä¸­æ–‡ç†è§£èƒ½åŠ›å¼º
- âœ… æ— éœ€æˆæœ¬æ§åˆ¶

---

### 2ï¸âƒ£ ERNIE 4.5 VLï¼ˆå¤šæ¨¡æ€è§†è§‰ï¼‰

**ç”¨é€”**: **å›¾ç‰‡+æ–‡æœ¬ç»¼åˆè¯Šæ–­**ï¼ˆä¸»è¦åœºæ™¯ï¼‰  
**æˆæœ¬**: **2åˆ†/æ¬¡**ï¼ˆÂ¥0.02ï¼‰  
**é€‚ç”¨åœºæ™¯**:
- æ‰€æœ‰åŒ…å«å›¾ç‰‡çš„è¯Šæ–­è¯·æ±‚
- ç²ªä¾¿å›¾ç‰‡åˆ†æ
- ä½“æ€è§‚å¯Ÿ
- ç¯å¢ƒè¯„ä¼°

**é…ç½®ä»£ç **:
```javascript
'ernie-4.5-vl': {
  provider: 'ç™¾åº¦æ–‡å¿ƒ',
  baseURL: 'https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/',
  endpoint: 'ernie-4.5-turbo-vl-32k',
  model: 'ernie-4.5-vl-preview',
  apiKey: process.env.ERNIE_API_KEY,
  secretKey: process.env.ERNIE_SECRET_KEY,
  maxTokens: 32000,
  costPerKToken: 0.003,
  outputCostPerKToken: 0.009,
  estimatedCostPerCall: 0.02,
  maxRequestsPerDay: 50,  // æ¯å¤©é™åˆ¶50æ¬¡
  supportVision: true,
  maxImages: 4
}
```

**æ ¸å¿ƒèƒ½åŠ›**:
- ğŸ” åŸç”Ÿå¤šæ¨¡æ€ï¼ˆå›¾ç‰‡+æ–‡æœ¬æ·±åº¦èåˆï¼‰
- ğŸ§  é¡¶çº§OCRèƒ½åŠ›ï¼ˆè¯†åˆ«ç²ªä¾¿é¢œè‰²ã€æ€§çŠ¶ï¼‰
- ğŸ©º ä¸“å®¶çº§åŒ»å­¦æ¨ç†
- ğŸ¯ å›¾åƒç†è§£å“è¶Šï¼ˆç—…å˜ã€ä½“æ€ã€ç¯å¢ƒï¼‰

**å›¾ç‰‡è¦æ±‚**:
- æ ¼å¼ï¼šJPG/PNG
- å¤§å°ï¼š< 4MB
- æ•°é‡ï¼šæœ€å¤š4å¼ 
- Base64ç¼–ç ä¼ è¾“

---

### 3ï¸âƒ£ ERNIE 4.0 Turboï¼ˆå¤æ‚ç—…ä¾‹ä¸“å®¶ï¼‰

**ç”¨é€”**: å¤æ‚/ç–‘éš¾ç—…ä¾‹çº¯æ–‡æœ¬è¯Šæ–­  
**æˆæœ¬**: **0.6åˆ†/æ¬¡**ï¼ˆÂ¥0.006ï¼‰  
**é€‚ç”¨åœºæ™¯**:
- æ­»äº¡ç—…ä¾‹åˆ†æ
- æ‰¹é‡æ„ŸæŸ“ï¼ˆâ‰¥10åªï¼‰
- ç–‘éš¾æ‚ç—‡
- é‰´åˆ«è¯Šæ–­éœ€æ±‚

**é…ç½®ä»£ç **:
```javascript
'ernie-4.0-turbo': {
  provider: 'ç™¾åº¦æ–‡å¿ƒ',
  baseURL: 'https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/',
  endpoint: 'ernie-4.0-turbo-8k',
  model: 'ERNIE-4.0-Turbo-8K',
  apiKey: process.env.ERNIE_API_KEY,
  secretKey: process.env.ERNIE_SECRET_KEY,
  maxTokens: 8000,
  costPerKToken: 0.003,
  outputCostPerKToken: 0.009,
  estimatedCostPerCall: 0.006,
  maxRequestsPerDay: 100,
  supportVision: false
}
```

**ç‰¹ç‚¹**:
- ğŸ§  ä¸“å®¶çº§æ¨ç†èƒ½åŠ›
- ğŸ“š ä¸°å¯ŒåŒ»å­¦çŸ¥è¯†åº“
- ğŸ”¬ æ·±åº¦ç—…å› åˆ†æ
- ğŸ’° æˆæœ¬æä½

---

## ğŸ§­ æ™ºèƒ½è·¯ç”±ç­–ç•¥

### ä»»åŠ¡ç±»å‹è‡ªåŠ¨è¯†åˆ«

```javascript
function selectOptimalTaskType(task) {
  const hasImages = task.images && task.images.length > 0
  const complexity = evaluateDiagnosisComplexity(task)
  const urgency = evaluateUrgency(task)
  
  // 1ï¸âƒ£ æœ‰å›¾ç‰‡ â†’ ä¼˜å…ˆä½¿ç”¨è§†è§‰æ¨¡å‹
  if (hasImages) {
    return 'health_diagnosis_vision'  // ERNIE 4.5 VL
  }
  
  // 2ï¸âƒ£ å¤æ‚ç—…ä¾‹ â†’ ä½¿ç”¨ä¸“å®¶æ¨¡å‹
  if (complexity === 'high') {
    return 'complex_diagnosis'  // ERNIE 4.0 Turbo
  }
  
  // 3ï¸âƒ£ ç´§æ€¥æƒ…å†µ â†’ ä½¿ç”¨å¿«é€Ÿæ¨¡å‹
  if (urgency === 'high') {
    return 'urgent_diagnosis'  // SiliconFlowï¼ˆå…è´¹ï¼‰
  }
  
  // 4ï¸âƒ£ é»˜è®¤å¸¸è§„è¯Šæ–­ â†’ ä½¿ç”¨å…è´¹æ¨¡å‹
  return 'health_diagnosis'  // ERNIE-Speed-128K
}
```

### å¤æ‚åº¦è¯„ä¼°ç®—æ³•

```javascript
function evaluateDiagnosisComplexity(task) {
  // å¤æ‚å…³é”®è¯
  const complexKeywords = [
    'æ­»äº¡', 'æ‰¹é‡', 'å¤§é‡', 'çªç„¶', 'ç–‘éš¾', 'ä¸æ˜åŸå› ', 
    'åå¤', 'å¤šæ¬¡', 'é‰´åˆ«è¯Šæ–­', 'å¹¶å‘ç—‡', 'ä¼ æŸ“', 'å¿«é€Ÿæ‰©æ•£',
    'é‡ç—‡', 'æ€¥æ€§', 'ä¸¥é‡'
  ]
  
  // è¯„åˆ†æ ‡å‡†
  let score = 0
  if (hasComplexKeyword) score += 3
  if (symptomCount >= 5) score += 2
  if (affectedCount >= 10) score += 2
  if (affectedCount >= 50) score += 3
  
  // high: éœ€è¦ä¸“å®¶æ¨¡å‹
  // medium: å¯èƒ½éœ€è¦ä¸“å®¶æ¨¡å‹
  // low: å¸¸è§„æ¨¡å‹å³å¯
  return score >= 4 ? 'high' : (score >= 2 ? 'medium' : 'low')
}
```

---

## ğŸ’° æˆæœ¬æ§åˆ¶æœºåˆ¶

### å››çº§æ™ºèƒ½é™çº§ç­–ç•¥

```javascript
class DailyCostController {
  async selectOptimalModel(taskType, hasImages, isComplex, isUrgent) {
    const usage = await this.getTodayUsage()
    
    // 1ï¸âƒ£ é¢„ç®—å……è¶³ (0-70%)ï¼šä¼˜å…ˆæœ€ä½³æ¨¡å‹
    if (usage.percentage < 0.70) {
      if (hasImages) return 'ernie-4.5-vl'  // 2åˆ†/æ¬¡
      if (isComplex) return 'ernie-4.0-turbo'  // 0.6åˆ†/æ¬¡
      return 'ernie-speed-128k'  // å…è´¹
    }
    
    // 2ï¸âƒ£ é¢„ç®—é¢„è­¦ (70-90%)ï¼šè°¨æ…ä½¿ç”¨ä»˜è´¹æ¨¡å‹
    if (usage.percentage < 0.90) {
      if (hasImages && isComplex) {
        return 'ernie-4.5-vl'  // å¤æ‚å›¾ç‰‡è¯Šæ–­ä»ä½¿ç”¨è§†è§‰æ¨¡å‹
      }
      return 'ernie-speed-128k'  // å…¶ä»–é™çº§å…è´¹
    }
    
    // 3ï¸âƒ£ é¢„ç®—ä¸è¶³ (90-100%)ï¼šå¼ºåˆ¶é™çº§
    if (usage.remaining > 0.02) {
      if (isComplex && !hasImages) {
        return 'ernie-4.0-turbo'  // ä»…å¤æ‚æ–‡æœ¬å¯ç”¨
      }
    }
    
    // 4ï¸âƒ£ é¢„ç®—è€—å°½ï¼šå®Œå…¨å…è´¹
    return 'ernie-speed-128k'
  }
}
```

### æ¯æ—¥æˆæœ¬é¢„ç®—åˆ†é…

| é¢„ç®—é˜¶æ®µ | ä½¿ç”¨ç‡ | ç­–ç•¥ | é¢„æœŸè°ƒç”¨ |
|---------|--------|------|---------|
| **å……è¶³** | 0-70% | ä¼˜å…ˆä½¿ç”¨æœ€ä½³æ¨¡å‹ | å›¾ç‰‡è¯Šæ–­350æ¬¡ï¼ˆ7å…ƒï¼‰ |
| **é¢„è­¦** | 70-90% | è°¨æ…ä½¿ç”¨ï¼Œéƒ¨åˆ†é™çº§ | å›¾ç‰‡è¯Šæ–­50æ¬¡ï¼ˆ1å…ƒï¼‰<br>å¤æ‚è¯Šæ–­50æ¬¡ï¼ˆ0.3å…ƒï¼‰ |
| **ä¸è¶³** | 90-100% | å¼ºåˆ¶é™çº§ | å¤æ‚è¯Šæ–­30æ¬¡ï¼ˆ0.18å…ƒï¼‰<br>å¸¸è§„å…è´¹ |
| **è€—å°½** | 100% | å®Œå…¨å…è´¹æ¨¡å¼ | å…¨éƒ¨ä½¿ç”¨ERNIE-Speed-128K |

### å…¸å‹ä¸€å¤©çš„æˆæœ¬åˆ†å¸ƒï¼ˆ500æ¬¡è¯Šæ–­ï¼‰

```
å‡è®¾æ¯æ—¥500æ¬¡è¯Šæ–­è¯·æ±‚ï¼ˆå›¾ç‰‡+æ–‡æœ¬ä¸ºä¸»ï¼‰ï¼š

æ™ºèƒ½åˆ†é…ï¼š
â”œâ”€â”€ å‰350æ¬¡ (0-70%é¢„ç®—)
â”‚   â””â”€â”€ ERNIE 4.5 VL: 350æ¬¡ Ã— 2åˆ† = 700åˆ† (7å…ƒ)
â”‚
â”œâ”€â”€ ç¬¬351-450æ¬¡ (70-90%é¢„ç®—)  
â”‚   â”œâ”€â”€ å¤æ‚ç—…ä¾‹: ERNIE 4.5 VL Ã— 50æ¬¡ = 100åˆ† (1å…ƒ)
â”‚   â””â”€â”€ ä¸€èˆ¬ç—…ä¾‹: ERNIE 4.0 Turbo Ã— 50æ¬¡ = 30åˆ† (0.3å…ƒ)
â”‚
â”œâ”€â”€ ç¬¬451-500æ¬¡ (90-100%é¢„ç®—)
â”‚   â”œâ”€â”€ ç´§æ€¥ç—…ä¾‹: ERNIE 4.0 Turbo Ã— 30æ¬¡ = 18åˆ† (0.18å…ƒ)
â”‚   â””â”€â”€ å¸¸è§„ç—…ä¾‹: ERNIE-Speed-128K Ã— 20æ¬¡ = å…è´¹
â”‚
â””â”€â”€ è¶…è¿‡500æ¬¡
    â””â”€â”€ å…¨éƒ¨é™çº§: ERNIE-Speed-128K = å…è´¹

æ€»æˆæœ¬: â‰ˆ8.5å…ƒ/å¤© (æ§åˆ¶åœ¨10å…ƒä»¥å†…) âœ…
è§†è§‰è¯Šæ–­è¦†ç›–ç‡: 80% (400/500æ¬¡) âœ…
```

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### ç™¾åº¦æ–‡å¿ƒä¸€è¨€APIå¯†é’¥

åœ¨å¾®ä¿¡äº‘å¼€å‘æ§åˆ¶å°è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# ç™¾åº¦æ–‡å¿ƒä¸€è¨€APIå¯†é’¥
ERNIE_API_KEY=ä½ çš„API_KEY
ERNIE_SECRET_KEY=ä½ çš„SECRET_KEY
```

### è·å–APIå¯†é’¥æ­¥éª¤

1. è®¿é—®ç™¾åº¦AIå¼€æ”¾å¹³å°ï¼šhttps://ai.baidu.com/
2. ç™»å½•å¹¶è¿›å…¥"æ§åˆ¶å°"
3. åˆ›å»ºåº”ç”¨å¹¶è·å–API Keyå’ŒSecret Key
4. åœ¨"åƒå¸†å¤§æ¨¡å‹å¹³å°"å¼€é€šERNIEæ¨¡å‹æœåŠ¡
5. ç¡®è®¤ä»¥ä¸‹æ¨¡å‹å·²å¼€é€šï¼š
   - âœ… ERNIE-Speed-128Kï¼ˆå…è´¹ï¼‰
   - âœ… ERNIE 4.0 Turbo 8K
   - âœ… ERNIE 4.5 VL Preview

### éªŒè¯ç¯å¢ƒå˜é‡

åœ¨äº‘å‡½æ•°ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼š

```javascript
// éªŒè¯ç¯å¢ƒå˜é‡
if (!process.env.ERNIE_API_KEY || !process.env.ERNIE_SECRET_KEY) {
  throw new Error('ç¼ºå°‘ç™¾åº¦APIå¯†é’¥ç¯å¢ƒå˜é‡ï¼è¯·é…ç½®ERNIE_API_KEYå’ŒERNIE_SECRET_KEY')
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šæ›´æ–°äº‘å‡½æ•°ä»£ç 

```bash
# 1. æ›´æ–° ai-multi-model äº‘å‡½æ•°
cd cloudfunctions/ai-multi-model
npm install  # ç¡®ä¿axioså·²å®‰è£…
# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·å³é”®ä¸Šä¼ å¹¶éƒ¨ç½²

# 2. æ›´æ–° process-ai-diagnosis äº‘å‡½æ•°
cd cloudfunctions/process-ai-diagnosis
# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·å³é”®ä¸Šä¼ å¹¶éƒ¨ç½²
```

### æ­¥éª¤2ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. ç™»å½•å¾®ä¿¡äº‘å¼€å‘æ§åˆ¶å°
2. è¿›å…¥"ç¯å¢ƒ" â†’ "ç¯å¢ƒè®¾ç½®" â†’ "ç¯å¢ƒå˜é‡"
3. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š
   ```
   ERNIE_API_KEY = ä½ çš„ç™¾åº¦API_KEY
   ERNIE_SECRET_KEY = ä½ çš„ç™¾åº¦SECRET_KEY
   ```

### æ­¥éª¤3ï¼šæ•°æ®åº“ç´¢å¼•é…ç½®

ç¡®ä¿ `sys_ai_usage` é›†åˆå·²åˆ›å»ºç´¢å¼•ï¼š

```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ sys_ai_usage â†’ ç´¢å¼•

// ç´¢å¼•1ï¼šæ—¥æœŸæŸ¥è¯¢
{
  "date": 1,
  "modelId": 1
}

// ç´¢å¼•2ï¼šæˆæœ¬æŸ¥è¯¢
{
  "date": 1,
  "cost": -1
}
```

### æ­¥éª¤4ï¼šæµ‹è¯•éªŒè¯

#### æµ‹è¯•1ï¼šå…è´¹æ¨¡å‹è°ƒç”¨

```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å°æµ‹è¯•
wx.cloud.callFunction({
  name: 'ai-multi-model',
  data: {
    action: 'chat_completion',
    messages: [
      { role: 'user', content: 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ç‹®å¤´é¹…çš„å¸¸è§ç–¾ç—…' }
    ],
    taskType: 'health_diagnosis',  // åº”è¯¥ä½¿ç”¨ERNIE-Speed-128Kï¼ˆå…è´¹ï¼‰
    priority: 'balanced'
  },
  success: res => {
    console.log('å…è´¹æ¨¡å‹æµ‹è¯•æˆåŠŸ:', res)
    console.log('ä½¿ç”¨æ¨¡å‹:', res.result.modelUsed)
  }
})
```

#### æµ‹è¯•2ï¼šè§†è§‰æ¨¡å‹è°ƒç”¨ï¼ˆå›¾ç‰‡è¯Šæ–­ï¼‰

```javascript
wx.cloud.callFunction({
  name: 'ai-diagnosis',
  data: {
    symptoms: ['è…¹æ³»', 'ç²¾ç¥èé¡'],
    symptomsText: 'å°é¹…å‡ºç°ç™½è‰²ç²ªä¾¿ï¼Œè‚›é—¨å‘¨å›´ç²˜ç²ª',
    dayAge: 3,
    affectedCount: 5,
    images: ['cloud://your-image-file-id.png']  // äº‘å­˜å‚¨æ–‡ä»¶ID
  },
  success: res => {
    console.log('è§†è§‰è¯Šæ–­æµ‹è¯•æˆåŠŸ:', res)
    // åº”è¯¥ä½¿ç”¨ERNIE 4.5 VL
  }
})
```

#### æµ‹è¯•3ï¼šæˆæœ¬æ§åˆ¶éªŒè¯

```javascript
// æŸ¥è¯¢ä»Šæ—¥æˆæœ¬
wx.cloud.database().collection('sys_ai_usage')
  .where({
    date: new Date().toISOString().split('T')[0]
  })
  .get()
  .then(res => {
    const totalCost = res.data.reduce((sum, r) => sum + r.cost, 0)
    console.log(`ä»Šæ—¥å·²ç”¨æˆæœ¬: ${totalCost.toFixed(2)}å…ƒ`)
  })
```

---

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šå¸¸è§„æ–‡æœ¬è¯Šæ–­ï¼ˆå…è´¹ï¼‰

**ç”¨æˆ·è¾“å…¥**:
- ç—‡çŠ¶ï¼šé£Ÿæ¬²ä¸æŒ¯ã€ç²¾ç¥èé¡
- æ—¥é¾„ï¼š15å¤©
- å—å½±å“æ•°é‡ï¼š3åª

**ç³»ç»Ÿå¤„ç†**:
```
å¤æ‚åº¦è¯„ä¼°: low
ç´§æ€¥åº¦: low
å›¾ç‰‡: æ— 
â†’ é€‰æ‹©æ¨¡å‹: ERNIE-Speed-128Kï¼ˆå…è´¹ï¼‰
â†’ æˆæœ¬: 0å…ƒ
```

---

### åœºæ™¯2ï¼šå›¾ç‰‡è¯Šæ–­ï¼ˆ2åˆ†/æ¬¡ï¼‰

**ç”¨æˆ·è¾“å…¥**:
- ç—‡çŠ¶ï¼šè…¹æ³»ã€ç²ªä¾¿å¼‚å¸¸
- å›¾ç‰‡ï¼š2å¼ ç²ªä¾¿ç…§ç‰‡
- æ—¥é¾„ï¼š5å¤©
- å—å½±å“æ•°é‡ï¼š8åª

**ç³»ç»Ÿå¤„ç†**:
```
å¤æ‚åº¦è¯„ä¼°: medium
ç´§æ€¥åº¦: medium
å›¾ç‰‡: 2å¼ 
â†’ é€‰æ‹©æ¨¡å‹: ERNIE 4.5 VLï¼ˆè§†è§‰æ¨¡å‹ï¼‰
â†’ æˆæœ¬: 0.02å…ƒï¼ˆ2åˆ†ï¼‰

AIåˆ†æ:
1. å›¾ç‰‡è§‚å¯Ÿï¼šç™½è‰²æ°´æ ·ç²ªä¾¿ï¼Œè‚›é—¨å‘¨å›´ç²˜è¿
2. ç»“åˆæ—¥é¾„ï¼š3-7æ—¥é¾„é«˜å‘
3. ä¸»è¦è¯Šæ–­ï¼šé›é¹…ç™½ç—¢ï¼ˆæ²™é—¨æ°èŒæ„ŸæŸ“ï¼‰
4. ç½®ä¿¡åº¦ï¼š92%
5. æ²»ç–—æ–¹æ¡ˆï¼šæ°Ÿè‹¯å°¼è€ƒ + æ”¯æŒç–—æ³•
```

---

### åœºæ™¯3ï¼šå¤æ‚ç—…ä¾‹è¯Šæ–­ï¼ˆ0.6åˆ†/æ¬¡ï¼‰

**ç”¨æˆ·è¾“å…¥**:
- ç—‡çŠ¶ï¼šçªç„¶æ­»äº¡ã€æ‰¹é‡å‘ç—…ã€ç¥ç»ç—‡çŠ¶
- æ—¥é¾„ï¼š20å¤©
- å—å½±å“æ•°é‡ï¼š50åª
- å›¾ç‰‡ï¼šæ— 

**ç³»ç»Ÿå¤„ç†**:
```
å¤æ‚åº¦è¯„ä¼°: highï¼ˆå…³é”®è¯ï¼šçªç„¶æ­»äº¡ã€æ‰¹é‡ï¼‰
ç´§æ€¥åº¦: high
å›¾ç‰‡: æ— 
â†’ é€‰æ‹©æ¨¡å‹: ERNIE 4.0 Turboï¼ˆå¤æ‚è¯Šæ–­ä¸“å®¶ï¼‰
â†’ æˆæœ¬: 0.006å…ƒï¼ˆ0.6åˆ†ï¼‰

AIåˆ†æ:
1. ç—…æƒ…ç‰¹å¾ï¼šæ€¥æ€§ã€ç¾¤å‘ã€ç¥ç»ç—‡çŠ¶
2. ä¸»è¦è¯Šæ–­ï¼šé¹…å‰¯é»ç—…æ¯’ç—…ï¼ˆç–‘ä¼¼ï¼‰
3. é‰´åˆ«è¯Šæ–­ï¼š
   - å°é¹…ç˜Ÿï¼ˆ70%ï¼‰
   - æ–°åŸç–«ï¼ˆ60%ï¼‰
4. ç´§æ€¥å»ºè®®ï¼šç«‹å³éš”ç¦» + å®éªŒå®¤ç¡®è¯Š + ç´§æ€¥å…ç–«
```

---

### åœºæ™¯4ï¼šé¢„ç®—ä¸è¶³æ—¶çš„é™çº§å¤„ç†

**ç³»ç»ŸçŠ¶æ€**:
- ä»Šæ—¥é¢„ç®—ä½¿ç”¨ï¼š92%ï¼ˆ9.2å…ƒ/10å…ƒï¼‰
- å‰©ä½™é¢„ç®—ï¼š0.8å…ƒ

**ç”¨æˆ·è¯·æ±‚**:
- ç—‡çŠ¶ï¼šè½»å¾®è…¹æ³»
- å›¾ç‰‡ï¼š1å¼ ç²ªä¾¿ç…§ç‰‡

**ç³»ç»Ÿå¤„ç†**:
```
é¢„ç®—çŠ¶æ€: 92% (é¢„ç®—ä¸è¶³)
â†’ æ™ºèƒ½é™çº§: ERNIE-Speed-128Kï¼ˆå…è´¹ï¼Œå»é™¤å›¾ç‰‡ï¼‰
â†’ æˆæœ¬: 0å…ƒ

ç”¨æˆ·æç¤º:
"ä»Šæ—¥é¢„ç®—å³å°†ç”¨å°½ï¼Œå·²åˆ‡æ¢ä¸ºå…è´¹æ¨¡å¼ï¼ˆæ˜æ—¥0ç‚¹é‡ç½®ï¼‰ã€‚
å»ºè®®ï¼šå¯è¯¦ç»†æè¿°ç—‡çŠ¶ä»¥æé«˜çº¯æ–‡æœ¬è¯Šæ–­å‡†ç¡®æ€§ã€‚"
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šç™¾åº¦APIè®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `ç™¾åº¦APIè®¤è¯å¤±è´¥: invalid_client`

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
2. ç¡®è®¤API Keyå’ŒSecret Keyæ²¡æœ‰å¤šä½™ç©ºæ ¼
3. éªŒè¯ç™¾åº¦AIå¼€æ”¾å¹³å°è´¦æˆ·çŠ¶æ€
4. æ£€æŸ¥åº”ç”¨æ˜¯å¦å·²å®¡æ ¸é€šè¿‡

```javascript
// æµ‹è¯•Tokenè·å–
const axios = require('axios')

axios.post('https://aip.baidubce.com/oauth/2.0/token', null, {
  params: {
    grant_type: 'client_credentials',
    client_id: 'YOUR_API_KEY',
    client_secret: 'YOUR_SECRET_KEY'
  }
}).then(res => {
  console.log('Tokenè·å–æˆåŠŸ:', res.data.access_token)
}).catch(err => {
  console.error('Tokenè·å–å¤±è´¥:', err.response.data)
})
```

---

### é—®é¢˜2ï¼šå›¾ç‰‡ä¸Šä¼ å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `å›¾ç‰‡è¿‡å¤§: 5.23MBï¼ˆç™¾åº¦é™åˆ¶4MBï¼‰`

**è§£å†³æ–¹æ³•**:
å‰ç«¯å·²è‡ªåŠ¨å‹ç¼©è‡³50%è´¨é‡å’Œ1024x1024å°ºå¯¸ï¼Œå¦‚ä»ç„¶è¿‡å¤§ï¼š

```javascript
// è¿›ä¸€æ­¥å‹ç¼©å›¾ç‰‡
wx.compressImage({
  src: tempFilePath,
  quality: 30,  // é™ä½åˆ°30%
  compressedWidth: 800,
  compressedHeight: 800
})
```

---

### é—®é¢˜3ï¼šæˆæœ¬è®°å½•å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `sys_ai_usage é›†åˆä¸å­˜åœ¨`

**è§£å†³æ–¹æ³•**:
æ‰‹åŠ¨åˆ›å»ºé›†åˆï¼š

1. ç™»å½•äº‘å¼€å‘æ§åˆ¶å°
2. è¿›å…¥"æ•°æ®åº“"
3. æ–°å»ºé›†åˆï¼š`sys_ai_usage`
4. åˆ›å»ºç´¢å¼•ï¼š
   ```json
   {
     "date": 1,
     "modelId": 1
   }
   ```

---

### é—®é¢˜4ï¼šè¯Šæ–­ç»“æœä¸ºç©º

**å¯èƒ½åŸå› **:
- AIè¿”å›æ ¼å¼ä¸ç¬¦åˆJSONè§„èŒƒ
- ç½‘ç»œè¶…æ—¶
- æ¨¡å‹ä¸å¯ç”¨

**è§£å†³æ–¹æ³•**:

```javascript
// åœ¨ process-ai-diagnosis/index.js ä¸­å¢å¼ºé”™è¯¯å¤„ç†
try {
  const diagnosisData = JSON.parse(diagnosisContent)
  // éªŒè¯å¿…éœ€å­—æ®µ
  if (!diagnosisData.primaryDiagnosis) {
    throw new Error('ç¼ºå°‘ä¸»è¦è¯Šæ–­ä¿¡æ¯')
  }
} catch (parseError) {
  console.error('JSONè§£æå¤±è´¥:', parseError)
  // é™çº§ä¸ºæ–‡æœ¬æå–
  diagnosisData = {
    primaryDiagnosis: {
      disease: 'è¯Šæ–­ç»“æœè§£æå¤±è´¥',
      confidence: 0,
      reasoning: diagnosisContent  // ä¿å­˜åŸå§‹å†…å®¹
    }
  }
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç™¾åº¦Tokenç¼“å­˜ä¼˜åŒ–

```javascript
// Tokenç¼“å­˜æ—¶é—´ä¼˜åŒ–ï¼ˆæå‰5åˆ†é’Ÿåˆ·æ–°ï¼‰
this.baiduTokenExpireTime = Date.now() + (expiresIn - 300) * 1000
```

### 2. å¹¶å‘è¯·æ±‚ä¼˜åŒ–

```javascript
// æ‰¹é‡å¤„ç†å¤šä¸ªè¯Šæ–­ä»»åŠ¡
const results = await Promise.allSettled(
  tasks.map(task => processTask(task._id))
)
```

### 3. å›¾ç‰‡é¢„å¤„ç†ä¼˜åŒ–

```javascript
// å‰ç«¯å›¾ç‰‡å‹ç¼©å‚æ•°è°ƒä¼˜
const compressResult = await wx.compressImage({
  src: file.tempFilePath,
  quality: 50,  // å¹³è¡¡è´¨é‡ä¸å¤§å°
  compressedWidth: 1024,
  compressedHeight: 1024
})
```

### 4. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

```javascript
// ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
await db.collection('sys_ai_usage')
  .where({
    date: today,
    modelId: db.command.in(['ernie-4.5-vl', 'ernie-4.0-turbo'])
  })
  .orderBy('createTime', 'desc')  // åˆ©ç”¨ç´¢å¼•æ’åº
  .limit(100)
  .get()
```

### 5. æˆæœ¬ç»Ÿè®¡ç¼“å­˜

```javascript
// ç¼“å­˜ä»Šæ—¥æˆæœ¬ç»Ÿè®¡ï¼ˆ1åˆ†é’Ÿæœ‰æ•ˆï¼‰
let costCache = {
  data: null,
  expireTime: 0
}

async function getTodayUsage() {
  const now = Date.now()
  if (costCache.data && now < costCache.expireTime) {
    return costCache.data
  }
  
  const data = await fetchTodayUsage()
  costCache.data = data
  costCache.expireTime = now + 60000  // 1åˆ†é’Ÿç¼“å­˜
  
  return data
}
```

---

## ğŸ“Š ç›‘æ§ä¸ç»Ÿè®¡

### æ¯æ—¥æˆæœ¬æŠ¥è¡¨

åœ¨äº‘å¼€å‘æ§åˆ¶å°æˆ–ç®¡ç†å‘˜é¡µé¢å®ç°ï¼š

```javascript
// è·å–æ¯æ—¥æˆæœ¬ç»Ÿè®¡
async function getDailyCostStats() {
  const db = wx.cloud.database()
  const today = new Date().toISOString().split('T')[0]
  
  const stats = await db.collection('sys_ai_usage')
    .where({ date: today })
    .get()
  
  const summary = {
    totalCalls: stats.data.length,
    totalCost: stats.data.reduce((sum, r) => sum + r.cost, 0),
    byModel: {
      'ernie-4.5-vl': { calls: 0, cost: 0 },
      'ernie-4.0-turbo': { calls: 0, cost: 0 },
      'ernie-speed-128k': { calls: 0, cost: 0 }
    }
  }
  
  stats.data.forEach(record => {
    const model = summary.byModel[record.modelId]
    if (model) {
      model.calls++
      model.cost += record.cost
    }
  })
  
  return summary
}

// ç¤ºä¾‹è¾“å‡º
{
  totalCalls: 487,
  totalCost: 8.34,
  byModel: {
    'ernie-4.5-vl': { calls: 402, cost: 8.04 },
    'ernie-4.0-turbo': { calls: 35, cost: 0.21 },
    'ernie-speed-128k': { calls: 50, cost: 0 }
  }
}
```

### é¢„ç®—é¢„è­¦é€šçŸ¥

```javascript
// é¢„ç®—è¾¾åˆ°70%æ—¶å‘é€é€šçŸ¥
async function checkBudgetWarning() {
  const usage = await getTodayUsage()
  
  if (usage.percentage >= 0.7 && usage.percentage < 0.9) {
    await sendNotification({
      title: 'âš ï¸ AIè¯Šæ–­é¢„ç®—é¢„è­¦',
      content: `ä»Šæ—¥é¢„ç®—å·²ä½¿ç”¨${(usage.percentage * 100).toFixed(1)}%ï¼Œå‰©ä½™${usage.remaining.toFixed(2)}å…ƒ`,
      level: 'warning'
    })
  } else if (usage.percentage >= 0.9) {
    await sendNotification({
      title: 'ğŸš¨ AIè¯Šæ–­é¢„ç®—å‘Šæ€¥',
      content: `ä»Šæ—¥é¢„ç®—ä»…å‰©${usage.remaining.toFixed(2)}å…ƒï¼Œéƒ¨åˆ†åŠŸèƒ½å·²é™çº§`,
      level: 'critical'
    })
  }
}
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æˆæœ¬ä¼˜åŒ–ç­–ç•¥

- âœ… **80%çš„å¸¸è§„è¯Šæ–­ä½¿ç”¨å…è´¹æ¨¡å‹**ï¼ˆERNIE-Speed-128Kï¼‰
- âœ… **ä»…é‡è¦å›¾ç‰‡è¯Šæ–­ä½¿ç”¨è§†è§‰æ¨¡å‹**ï¼ˆERNIE 4.5 VLï¼‰
- âœ… **å¤æ‚ç—…ä¾‹é€‚åº¦ä½¿ç”¨ä¸“å®¶æ¨¡å‹**ï¼ˆERNIE 4.0 Turboï¼‰
- âœ… **é¢„ç®—ç´§å¼ æ—¶æ™ºèƒ½é™çº§**ï¼ˆç”¨æˆ·é€æ˜æç¤ºï¼‰

### 2. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

```javascript
// å‰ç«¯æ˜¾ç¤ºé¢„ç®—çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
if (result.degraded && result.userMessage) {
  wx.showModal({
    title: 'ğŸ’¡ è¯Šæ–­æ¨¡å¼è°ƒæ•´',
    content: result.userMessage,
    showCancel: false
  })
}

// æ˜¾ç¤ºå‰©ä½™é¢„ç®—ï¼ˆç®¡ç†å‘˜å¯è§ï¼‰
if (result.budgetInfo && isAdmin) {
  console.log(`ä»Šæ—¥å‰©ä½™é¢„ç®—: ${result.budgetInfo.remaining.toFixed(2)}å…ƒ`)
}
```

### 3. å›¾ç‰‡è´¨é‡è¦æ±‚

**æœ€ä½³å®è·µ**:
- ğŸ“· å…‰çº¿å……è¶³ï¼Œé¿å…æ¨¡ç³Š
- ğŸ¯ ç„¦ç‚¹æ¸…æ™°ï¼Œå¯¹å‡†ç›®æ ‡
- ğŸ“ è·ç¦»é€‚ä¸­ï¼ˆ10-30cmï¼‰
- ğŸ§¹ èƒŒæ™¯ç®€æ´ï¼Œé¿å…å¹²æ‰°

**ç¤ºä¾‹æç¤º**:
```
å›¾ç‰‡æ‹æ‘„å»ºè®®ï¼š
1. ç²ªä¾¿æ ·æœ¬ï¼šè¿‘è·ç¦»æ¸…æ™°æ‹æ‘„ï¼ŒåŒ…å«é¢œè‰²å’Œæ€§çŠ¶
2. ä½“æ€è§‚å¯Ÿï¼šå…¨èº«ç…§ï¼ŒåŒ…å«ç«™å§¿å’Œç²¾ç¥çŠ¶æ€
3. ç—…å˜éƒ¨ä½ï¼šç‰¹å†™æ¸…æ™°ï¼Œé¿å…è¿‡æ›æˆ–æ¬ æ›
```

### 4. è¯Šæ–­æ•°æ®ç•™å­˜

```javascript
// ä¿å­˜è¯Šæ–­å†å²ï¼ˆä¾¿äºåç»­åˆ†æï¼‰
await db.collection('health_ai_diagnosis').add({
  data: {
    ...diagnosisData,
    modelUsed: result.modelUsed,
    cost: result.cost || 0,
    budgetPercentage: result.budgetInfo?.percentage || 0,
    createdAt: new Date()
  }
})
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜å¿«é€Ÿç´¢å¼•

| é—®é¢˜ç±»å‹ | è§£å†³æ–¹æ¡ˆ | æ–‡æ¡£ä½ç½® |
|---------|---------|---------|
| APIè®¤è¯å¤±è´¥ | æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½® | [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥) |
| å›¾ç‰‡ä¸Šä¼ å¤±è´¥ | è°ƒæ•´å‹ç¼©å‚æ•° | [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥) |
| æˆæœ¬è¶…æ”¯ | è°ƒæ•´æ¯æ—¥é¢„ç®—é™åˆ¶ | [æˆæœ¬æ§åˆ¶](#æˆæœ¬æ§åˆ¶æœºåˆ¶) |
| è¯Šæ–­ç»“æœå¼‚å¸¸ | æŸ¥çœ‹JSONè§£æé€»è¾‘ | [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥) |

### è”ç³»æ–¹å¼

- ğŸ“§ æŠ€æœ¯æ”¯æŒé‚®ç®±: support@example.com
- ğŸ’¬ å¾®ä¿¡æŠ€æœ¯ç¾¤: [æ‰«ç åŠ å…¥]
- ğŸ“š é¡¹ç›®æ–‡æ¡£: `/docs/`

---

## ğŸ‰ æ€»ç»“

### ç³»ç»Ÿä¼˜åŠ¿

1. âœ… **æˆæœ¬å¯æ§**: æ¯æ—¥10å…ƒé¢„ç®—ï¼Œæ™ºèƒ½é™çº§ä¿éšœ
2. âœ… **ä½“éªŒä¼˜å…ˆ**: 70%é¢„ç®—å†…ä¿è¯æœ€ä½³è§†è§‰è¯Šæ–­
3. âœ… **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹
4. âœ… **ç”¨æˆ·é€æ˜**: æ¸…æ™°æç¤ºé™çº§åŸå› 
5. âœ… **é›¶åœæœ**: é¢„ç®—è€—å°½åä»å¯å…è´¹æœåŠ¡

### é¢„æœŸæ•ˆæœ

- ğŸ’° **æˆæœ¬**: çº¦8.5å…ƒ/å¤©ï¼ˆ500æ¬¡è¯Šæ–­ï¼‰
- ğŸ¯ **è¦†ç›–ç‡**: 80%å›¾ç‰‡è¯Šæ–­ä½¿ç”¨è§†è§‰æ¨¡å‹
- âš¡ **é€Ÿåº¦**: å¹³å‡å“åº”æ—¶é—´10-15ç§’
- ğŸ“ˆ **å‡†ç¡®ç‡**: å›¾ç‰‡+æ–‡æœ¬ç»¼åˆè¯Šæ–­å‡†ç¡®ç‡>85%

---

**é…ç½®å®Œæˆï¼** ğŸŠ

æ‚¨çš„AIè¯Šæ–­ç³»ç»Ÿç°å·²å®Œå…¨é…ç½®å®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹éƒ¨ç½²å’Œæµ‹è¯•äº†ï¼

