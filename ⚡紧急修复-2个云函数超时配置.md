# ⚡ 紧急修复 - 2个云函数超时配置

## 🎯 问题确认

✅ **云函数执行成功**（34秒完成）  
❌ **但云函数间调用超时**（默认30秒）  
❌ **前端显示失败**

---

## ✅ 解决方案（5分钟完成）

### 第1步：打开云开发控制台 ☁️

**在微信开发者工具中**：
```
顶部菜单栏 → 云开发 → 云开发控制台
```

会在浏览器打开：`https://console.cloud.tencent.com/tcb`

---

### 第2步：配置 `ai-multi-model` 超时 ⏰

```
1. 左侧菜单：云函数
2. 点击：ai-multi-model
3. 点击标签：函数配置
4. 找到：超时时间
5. 改为：120 秒
6. 点击：保存 ✅
```

**截图位置**：
```
函数配置
  基础配置
    ├── 超时时间: [120] 秒  ← 改这里
    ├── 内存: 256 MB
    └── 环境变量: (不动)
```

---

### 第3步：配置 `process-ai-diagnosis` 超时 ⏰

```
1. 返回云函数列表
2. 点击：process-ai-diagnosis
3. 点击标签：函数配置
4. 找到：超时时间
5. 改为：150 秒
6. 点击：保存 ✅
```

---

### 第4步：立即测试 🧪

**无需重新上传代码！配置立即生效！**

```
1. 打开小程序 AI诊断页面
2. 上传 1张图片
3. 提交诊断
4. 耐心等待 60-90秒
5. 成功！✅
```

---

## 📊 配置对照表

| 云函数 | 当前 | 改为 | 为什么 |
|--------|------|------|--------|
| **ai-multi-model** | 60秒 | **120秒** | GEMINI需要34-60秒 |
| **process-ai-diagnosis** | 60秒 | **150秒** | 调用上面的+处理 |

---

## 🎊 配置完成标志

### 在云函数列表中看到：

```
ai-multi-model
  基础信息
    超时时间: 120秒 ✅
    
process-ai-diagnosis
  基础信息
    超时时间: 150秒 ✅
```

---

## 📝 快速检查清单

- [ ] 打开云开发控制台
- [ ] `ai-multi-model` 超时改为 120秒
- [ ] `process-ai-diagnosis` 超时改为 150秒
- [ ] 两个都点击"保存"
- [ ] 测试上传1张图片
- [ ] 等待60-90秒
- [ ] 看到诊断结果 ✅

---

## 🔍 如何确认配置生效？

### 方法1：查看配置
```
云函数详情 → 函数配置 → 超时时间显示120秒/150秒
```

### 方法2：查看日志
```
测试后查看日志 → 执行时间34秒 → 没有超时错误 ✅
```

---

## ⚠️ 重要提示

### ✅ 需要做的
- 配置2个云函数的超时时间
- 都要点击"保存"
- 等待2分钟后测试

### ❌ 不需要做的
- ❌ 不需要重新上传代码
- ❌ 不需要修改代码
- ❌ 不需要重启开发者工具

---

## 🆘 找不到配置入口？

### 如果看不到"云开发"菜单

**方式1**：直接访问
```
浏览器打开: https://console.cloud.tencent.com/tcb
选择您的环境 → 云函数
```

**方式2**：小程序后台
```
https://mp.weixin.qq.com
→ 开发 → 云开发 → 云函数
```

---

## 📞 配置后仍失败？

**请提供**：
1. 云函数列表截图（显示超时配置）
2. 测试时的完整日志
3. 前端显示的错误信息

---

## ✨ 配置后的效果

**时间线（配置后）**：
```
00秒: 用户提交诊断
01秒: 调用 process-ai-diagnosis
02秒: 调用 ai-multi-model
03秒: 开始处理图片
05秒: 调用 GEMINI API
34秒: GEMINI返回结果 ✅
35秒: 解析并保存结果 ✅
36秒: 前端轮询获取结果 ✅
37秒: 显示诊断结果 ✅
```

**超时判断（配置后）**：
```
实际执行: 34秒
ai-multi-model超时: 120秒 ✅ (34 < 120)
process-ai-diagnosis超时: 150秒 ✅ (35 < 150)
结果: 成功！🎉
```

---

**立即打开云开发控制台配置！** 🚀

5分钟搞定，配置完立即生效！

