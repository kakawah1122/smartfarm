# 集合权限快速配置表

## 快速复制使用

### 规则1：仅创建者可读写（个人数据）
```json
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}
```
**适用集合**：
- task_batch_schedules
- task_completions
- task_records
- health_prevention_records
- health_treatment_records
- health_ai_diagnosis
- health_death_records
- finance_analysis_history
- file_dynamic_records

### 规则2：所有用户可读，仅创建者可写（公开数据）
```json
{
  "read": true,
  "write": "doc._openid == auth.openid"
}
```
**适用集合**：
- health_records
- finance_cost_records
- finance_revenue_records

### 规则3：所有用户可读，禁止写入（只读数据）
```json
{
  "read": true,
  "write": false
}
```
**适用集合**：
- finance_reports
- finance_summaries
- sys_overview_stats
- knowledge_articles
- prod_materials
- file_static_records

### 规则4：仅创建者可读，禁止写入（云函数写入）
```json
{
  "read": "doc._openid == auth.openid",
  "write": false
}
```
**适用集合**：
- wx_users
- user_notifications
- prod_inventory_logs
- task_templates

### 规则5：userId字段权限（生产模块）
```json
{
  "read": "doc.userId == auth.openid",
  "write": "doc.userId == auth.openid"
}
```
**适用集合**：
- prod_batch_entries
- prod_batch_exits
- prod_material_records

### 规则6：邀请关系权限
```json
{
  "read": "doc.inviter == auth.openid || doc.invitee == auth.openid",
  "write": false
}
```
**适用集合**：
- wx_user_invites

### 规则7：审批日志权限
```json
{
  "read": "doc._openid == auth.openid || auth.openid in doc.approvers",
  "write": false
}
```
**适用集合**：
- sys_approval_logs

### 规则8：所有用户不可读写（系统内部）
选择界面选项："所有用户不可读写"

**适用集合**：
- sys_audit_logs
- sys_ai_cache
- sys_ai_usage
- sys_cleanup_logs
- sys_configurations
- sys_permissions
- sys_storage_statistics

## 批量配置步骤

1. 登录微信云开发控制台
2. 进入数据库页面
3. 对每个集合：
   - 点击集合名称
   - 选择"权限设置"
   - 根据上表选择对应规则
   - 如果是自定义规则，复制粘贴JSON
   - 点击确定保存

## 索引快速配置

### 通用索引（所有集合）
```
索引名：_openid_createTime
字段1：_openid（升序）
字段2：createTime（降序）
```

### 状态索引（有status字段的集合）
```
索引名：status_createTime
字段1：status（升序）
字段2：createTime（降序）
```

### 批次索引（生产相关集合）
```
索引名：batchId_createTime
字段1：batchId（升序）
字段2：createTime（降序）
```

### 日期索引（记录类集合）
```
索引名：recordDate
字段1：recordDate（降序）
```

## 配置优先级

1. **第一批**（核心集合，立即配置）：
   - wx_users
   - prod_batch_entries
   - health_records
   - task_templates
   - finance_cost_records

2. **第二批**（常用集合）：
   - user_notifications
   - health_treatment_records
   - task_batch_schedules
   - finance_revenue_records

3. **第三批**（系统集合）：
   - sys_* 系列集合
   - knowledge_articles
   - file_* 系列集合

## 检查清单

配置完成后，请检查：
- [ ] 所有集合都已设置权限
- [ ] 每个集合至少有一个索引
- [ ] 核心集合有 _openid_createTime 索引
- [ ] 生产模块使用 userId 字段
- [ ] 系统集合设置为不可读写
