# 上线前检查清单

**检查日期**: 2025年1月  
**检查状态**: ✅ 合规审查修复已完成

---

## ✅ 合规性检查（已完成）

### 1. 日志规范 ✅
- [x] 创建统一的日志工具 `utils/logger.ts`
- [x] 所有 `console.log/warn` 已替换为 `logger.log/warn`（11个文件）
- [x] `console.error` 保持不变（用于错误追踪）
- [x] 生产环境日志控制机制已实现

### 2. 页面布局规范 ✅
- [x] `cured-records-list` 页面已改为Flex布局
- [x] `treatment-records-list` 页面已改为Flex布局
- [x] 所有页面使用 `height: 100vh` + `flex: 1`
- [x] 无 `min-height: calc(100vh - xxx)` 固定高度
- [x] 所有页面添加 `safe-area` 处理安全区域

### 3. 详情弹窗组件化 ✅
- [x] `cured-record-detail-popup` 组件已创建
- [x] 页面代码已迁移到组件
- [x] 实现延迟清空数据机制（300ms）
- [x] 符合项目规范命名和结构

### 4. TDesign组件规范 ✅
- [x] 所有组件按需在 `*.json` 中声明
- [x] 未发现未注册组件直接使用
- [x] 组件样式覆盖使用外部样式类

### 5. 数据库集合规范 ✅
- [x] 集合命名统一规范（模块前缀）
- [x] 所有云函数引用统一配置
- [x] 设计扁平化

### 6. 云函数规范 ✅
- [x] 使用 `switch-case` 模式，符合单一职责
- [x] 统一错误处理机制
- [x] 使用统一的集合配置

---

## 📋 功能测试清单

### 1. 日志功能测试
- [ ] **开发环境测试**
  ```typescript
  // 在控制台测试
  import { logger, setDebugEnabled } from './utils/logger'
  
  setDebugEnabled(true)
  logger.log('测试日志')  // 应该输出 [DEBUG]
  logger.warn('测试警告')  // 应该输出 [WARN]
  
  setDebugEnabled(false)
  logger.log('测试日志')  // 不应该输出
  logger.error('测试错误')  // 应该输出 [ERROR]（始终输出）
  ```

- [ ] **生产环境验证**
  - [ ] 确认生产环境默认不输出调试日志
  - [ ] 确认错误日志正常输出

### 2. 页面布局测试
- [ ] **cured-records-list 页面**
  - [ ] 在不同设备上测试（iPhone、Android）
  - [ ] 确认底部空白区域最小化
  - [ ] 确认安全区域正确处理
  - [ ] 确认滚动流畅

- [ ] **treatment-records-list 页面**
  - [ ] 在不同设备上测试
  - [ ] 确认布局正常
  - [ ] 确认滚动流畅

- [ ] **其他列表页面**
  - [ ] 检查是否有其他页面需要优化
  - [ ] 确认所有页面布局一致

### 3. 详情弹窗测试
- [ ] **cured-record-detail-popup 组件**
  - [ ] 测试弹窗打开动画
  - [ ] 测试弹窗关闭动画
  - [ ] 测试延迟清空数据（不应有闪烁）
  - [ ] 测试弹窗内容显示正确
  - [ ] 测试在不同设备上的显示

### 4. 功能回归测试
- [ ] **核心功能**
  - [ ] 登录/注册功能正常
  - [ ] 数据加载正常
  - [ ] 页面跳转正常
  - [ ] 表单提交正常

- [ ] **云函数调用**
  - [ ] 所有云函数调用正常
  - [ ] 错误处理正常
  - [ ] 加载状态显示正常

---

## 📦 包大小检查

### 检查步骤
1. 在微信开发者工具中编译项目
2. 查看编译后的包大小：
   - 主包大小：应 ≤ 2MB
   - 总包大小：应 ≤ 20MB（服务商代开发）

### 优化建议（如超出限制）
- [ ] 压缩图片资源
- [ ] 检查是否有冗余代码
- [ ] 考虑进一步拆分分包
- [ ] 使用代码分包异步化

---

## ⚙️ 配置检查

### 1. 订阅消息配置（可选）
- [ ] 在微信公众平台获取模板ID
- [ ] 更新 `app.ts` 中的 `subscriptionTemplates` 配置
- [ ] 测试订阅消息功能（如已启用）

### 2. 云开发环境配置
- [ ] 确认云开发环境ID正确
- [ ] 确认云函数已部署
- [ ] 确认数据库权限配置正确

### 3. 小程序配置
- [ ] 确认 `appid` 正确
- [ ] 确认 `project.config.json` 配置正确
- [ ] 确认 `sitemap.json` 配置正确

---

## 🔒 安全检查

### 1. 敏感信息检查
- [ ] 确认无硬编码的密钥、密码
- [ ] 确认无调试信息泄露
- [ ] 确认错误信息不暴露敏感信息

### 2. 权限检查
- [ ] 确认所有权限申请合理
- [ ] 确认权限说明清晰
- [ ] 确认 `requiredPrivateInfos` 配置正确

### 3. 数据安全
- [ ] 确认敏感数据加密传输（HTTPS）
- [ ] 确认本地存储不包含敏感信息
- [ ] 确认用户数据隐私保护

---

## 📱 兼容性测试

### 1. 基础库版本
- [ ] 确认最低基础库版本设置合理
- [ ] 测试在不同基础库版本下的表现

### 2. 设备兼容性
- [ ] iPhone（不同型号）
- [ ] Android（不同品牌和版本）
- [ ] 不同屏幕尺寸
- [ ] 横屏/竖屏切换

### 3. 微信版本兼容性
- [ ] 测试不同微信版本
- [ ] 确认新特性有降级方案

---

## 🚀 性能测试

### 1. 加载性能
- [ ] 首屏加载时间 < 3秒
- [ ] 分包加载正常
- [ ] 图片加载优化

### 2. 运行性能
- [ ] 页面滚动流畅
- [ ] 动画流畅（60fps）
- [ ] 无内存泄漏
- [ ] 无卡顿现象

### 3. 网络性能
- [ ] 云函数调用响应时间合理
- [ ] 数据加载优化（分页、懒加载）
- [ ] 错误重试机制正常

---

## 📝 文档检查

### 1. 代码文档
- [ ] 关键函数有注释
- [ ] 复杂逻辑有说明
- [ ] README 文档更新

### 2. 用户文档（如需要）
- [ ] 用户使用指南
- [ ] 常见问题解答
- [ ] 更新日志

---

## 🎯 上线前最后检查

### 1. Git 提交
- [x] 所有更改已提交
- [x] 提交信息清晰
- [ ] 代码已推送到远程仓库

### 2. 版本号
- [ ] 更新版本号（如需要）
- [ ] 更新版本说明

### 3. 审核材料准备
- [ ] 小程序介绍
- [ ] 功能截图
- [ ] 隐私政策（如需要）
- [ ] 用户协议（如需要）

---

## ✅ 检查完成确认

**检查人员**: _______________  
**检查日期**: _______________  
**检查结果**: 
- [ ] 通过，可以上线
- [ ] 需要修复问题（见下方）

**需要修复的问题**:
_________________________________
_________________________________
_________________________________

---

## 📞 问题反馈

如发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期行为
4. 实际行为
5. 设备/环境信息

---

**最后更新**: 2025年1月

