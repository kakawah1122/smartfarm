# 上线前待办清单

**创建日期**: 2025年1月  
**依据**: 微信小程序开发规范和最佳实践 + 项目开发规范  
**状态**: 待执行

---

## 📋 待办清单总览

### 完成度统计
- 🔴 **高优先级（阻塞上线）**: 0/9 (0%)
- 🟡 **中优先级（影响体验）**: 0/3 (0%)
- 🟢 **低优先级（后续优化）**: 0/4 (0%)
- **总体**: 0/16 (0%)

---

## 🔴 高优先级（阻塞上线）- 必须完成

### 1. 修复硬编码占位符电话号码 ⚠️

**文件**: `miniprogram/packageAI/ai-diagnosis/ai-diagnosis.ts`  
**位置**: 第1204行、第1209行  
**问题**: 使用了占位符电话号码 `400-xxx-xxxx`

**修复方案**（选择其一）:
```typescript
// 方案1: 替换为真实电话号码（推荐）
phoneNumber: '400-123-4567', // 替换为真实号码

// 方案2: 从配置中读取（更灵活）
const app = getApp()
const vetPhone = app.globalData.vetPhoneNumber || '400-123-4567'
phoneNumber: vetPhone

// 方案3: 移除该功能（如果不需要）
// 删除 contactVet 方法或改为其他实现方式
```

**符合规范**:
- ✅ 微信小程序安全规范：不包含占位符或测试数据
- ✅ 项目规范：配置数据应从配置中读取

**预计时间**: 10分钟

---

### 2. 功能测试：日志功能测试 ⚠️

**测试内容**:
- [ ] **开发环境测试**
  ```typescript
  // 在控制台测试
  import { logger, setDebugEnabled } from './utils/logger'
  
  setDebugEnabled(true)
  logger.log('测试日志')  // 应该输出 [DEBUG]
  logger.warn('测试警告')  // 应该输出 [WARN]
  
  setDebugEnabled(false)
  logger.log('测试日志')  // 不应该输出
  logger.error('测试错误')  // 应该输出 [ERROR]（始终输出）
  ```

- [ ] **生产环境验证**
  - [ ] 确认生产环境默认不输出调试日志
  - [ ] 确认错误日志正常输出

**符合规范**:
- ✅ 微信小程序最佳实践：生产环境日志控制
- ✅ 项目规范：日志与调试策略（9.4节）

**预计时间**: 30分钟

---

### 3. 功能测试：页面布局测试 ⚠️

**测试页面**:
- [ ] `cured-records-list` 页面
  - [ ] 在不同设备上测试（iPhone、Android）
  - [ ] 确认底部空白区域最小化
  - [ ] 确认安全区域正确处理
  - [ ] 确认滚动流畅

- [ ] `treatment-records-list` 页面
  - [ ] 在不同设备上测试
  - [ ] 确认布局正常
  - [ ] 确认滚动流畅

- [ ] `death-records-list` 页面
  - [ ] 在不同设备上测试
  - [ ] 确认布局正常
  - [ ] 确认滚动流畅

**符合规范**:
- ✅ 微信小程序最佳实践：页面布局规范
- ✅ 项目规范：页面布局规范（8节）

**预计时间**: 1-2小时

---

### 4. 功能测试：详情弹窗测试 ⚠️

**测试组件**:
- [ ] `cured-record-detail-popup` 组件
  - [ ] 测试弹窗打开动画
  - [ ] 测试弹窗关闭动画
  - [ ] 测试延迟清空数据（不应有闪烁）
  - [ ] 测试弹窗内容显示正确
  - [ ] 测试在不同设备上的显示

- [ ] `death-record-detail-popup` 组件
  - [ ] 测试弹窗打开动画
  - [ ] 测试弹窗关闭动画
  - [ ] 测试延迟清空数据（不应有闪烁）
  - [ ] 测试弹窗内容显示正确

**符合规范**:
- ✅ 微信小程序最佳实践：组件化开发
- ✅ 项目规范：详情弹窗组件复用规范（3节）

**预计时间**: 30分钟

---

### 5. 功能测试：功能回归测试 ⚠️

**测试内容**:
- [ ] **核心功能**
  - [ ] 登录/注册功能正常
  - [ ] 数据加载正常
  - [ ] 页面跳转正常
  - [ ] 表单提交正常

- [ ] **云函数调用**
  - [ ] 所有云函数调用正常
  - [ ] 错误处理正常
  - [ ] 加载状态显示正常

**符合规范**:
- ✅ 微信小程序最佳实践：功能完整性
- ✅ 项目规范：数据交互规范（7节）

**预计时间**: 2-3小时

---

### 6. 包大小检查：主包大小 ⚠️

**检查步骤**:
1. 在微信开发者工具中编译项目
2. 查看编译后的主包大小
3. 确认主包大小 ≤ 2MB

**符合规范**:
- ✅ 微信小程序规范：主包大小限制（≤ 2MB）
- ✅ 项目规范：主包/分包规范（9.1节）

**优化建议**（如超出限制）:
- 压缩图片资源
- 检查是否有冗余代码
- 考虑进一步拆分分包

**预计时间**: 30分钟

---

### 7. 包大小检查：总包大小 ⚠️

**检查步骤**:
1. 查看编译后的总包大小
2. 确认总包大小 ≤ 20MB（服务商代开发）

**符合规范**:
- ✅ 微信小程序规范：总包大小限制（≤ 20MB）
- ✅ 项目规范：主包/分包规范（9.1节）

**优化建议**（如超出限制）:
- 压缩图片资源
- 检查是否有冗余代码
- 考虑进一步拆分分包
- 使用代码分包异步化

**预计时间**: 30分钟

---

### 8. 配置检查：云开发环境配置 ⚠️

**检查内容**:
- [ ] 确认云开发环境ID正确（`cloud1-3gdruqkn67e1cbe2`）
- [ ] 确认云函数已部署
- [ ] 确认数据库权限配置正确
- [ ] 确认云存储权限配置正确

**符合规范**:
- ✅ 微信小程序云开发规范：环境配置
- ✅ 项目规范：云开发最佳实践（9.2节）

**预计时间**: 30分钟

---

### 9. 配置检查：小程序配置验证 ⚠️

**检查内容**:
- [ ] 确认 `appid` 正确（`wx68a4d75dd80665ec`）
- [ ] 确认 `project.config.json` 配置正确
- [ ] 确认 `sitemap.json` 配置正确
- [ ] 确认权限申请合理（`scope.userLocation`）
- [ ] 确认 `requiredPrivateInfos` 配置正确（`getLocation`）

**符合规范**:
- ✅ 微信小程序规范：小程序配置
- ✅ 项目规范：合规与上线要求（9节）

**预计时间**: 30分钟

---

## 🟡 中优先级（影响体验）- 建议完成

### 10. 订阅消息配置（可选）⚠️

**操作步骤**:
1. 登录微信公众平台
2. 进入：功能 -> 订阅消息 -> 公共模板库
3. 选择需要的模板并获取模板ID
4. 更新 `app.ts` 中的配置：

```typescript
subscriptionTemplates: [
  { tmplId: 'REAL_TEMPLATE_ID_1', title: '系统交互消息', description: '系统审批、任务通知等提醒' },
  { tmplId: 'REAL_TEMPLATE_ID_2', title: '生产进度提醒', description: '生产计划、排行榜等动态提醒' }
]
```

**符合规范**:
- ✅ 微信小程序规范：订阅消息配置
- ✅ 项目规范：合规与上线要求（9节）

**注意**: 此配置不影响上线，但需要在启用订阅消息功能前完成。

**预计时间**: 30分钟

---

### 11. 检查其他页面弹窗 ⚠️

**评估页面**:
- [ ] `price-management` - 价格详情弹窗
- [ ] `reimbursement-list` - 报销详情弹窗
- [ ] `vaccine-records-list` - 疫苗记录详情弹窗
- [ ] `medication-records-list` - 用药记录详情弹窗

**评估标准**:
- 如果弹窗代码超过100行 → 建议组件化
- 如果弹窗在2+个页面使用 → 必须组件化
- 如果弹窗代码简单且只在一个页面使用 → 可以保留

**符合规范**:
- ✅ 微信小程序最佳实践：组件化开发
- ✅ 项目规范：详情弹窗组件复用规范（3节）

**预计时间**: 1-2小时

---

### 12. 性能监控 ⚠️

**操作步骤**:
1. 在关键组件中使用 `setUpdatePerformanceListener`
2. 监控 setData 更新性能
3. 分析性能瓶颈
4. 持续优化

**示例代码**:
```typescript
Component({
  attached() {
    this.setUpdatePerformanceListener({withDataPaths: true}, (res) => {
      console.log('更新性能统计:', res)
    })
  }
})
```

**符合规范**:
- ✅ 微信小程序最佳实践：性能监控
- ✅ 项目规范：性能优化要求

**预计时间**: 1小时

---

## 🟢 低优先级（后续优化）- 可选

### 13. TypeScript 类型优化

**优化内容**:
- [ ] 逐步减少 `any` 类型使用（701处）
- [ ] 优先修复关键业务逻辑的类型定义
- [ ] 定义具体类型接口

**符合规范**:
- ✅ TypeScript 最佳实践：类型安全
- ✅ 项目规范：TypeScript 编码规范（6节）

**预计时间**: 持续优化

---

### 14. 代码优化：setData 调用优化

**优化内容**:
- [ ] 检查其他页面的 setData 调用
- [ ] 优化大对象更新为数据路径形式
- [ ] 合并连续的 setData 调用

**符合规范**:
- ✅ 微信小程序最佳实践：setData 优化
- ✅ 项目规范：性能优化要求

**预计时间**: 持续优化

---

### 15. 资源优化：压缩图片资源

**优化内容**:
- [ ] 压缩图片资源
- [ ] 使用 WebP 格式（如支持）
- [ ] 优化图片尺寸

**符合规范**:
- ✅ 微信小程序最佳实践：资源优化
- ✅ 项目规范：性能优化要求

**预计时间**: 1-2小时（如需要）

---

### 16. 代码分包：进一步拆分分包

**优化内容**:
- [ ] 如包大小超出限制，考虑进一步拆分分包
- [ ] 使用代码分包异步化
- [ ] 优化分包加载策略

**符合规范**:
- ✅ 微信小程序最佳实践：分包加载
- ✅ 项目规范：主包/分包规范（9.1节）

**预计时间**: 2-3小时（如需要）

---

## 📊 时间估算

### 高优先级任务
- 修复硬编码电话号码: 10分钟
- 功能测试: 4-6小时
- 包大小检查: 1小时
- 配置检查: 1小时
- **总计**: 6-8小时（1天）

### 中优先级任务
- 订阅消息配置: 30分钟
- 检查其他页面弹窗: 1-2小时
- 性能监控: 1小时
- **总计**: 2.5-3.5小时（0.5天）

### 低优先级任务
- TypeScript 类型优化: 持续优化
- setData 调用优化: 持续优化
- 资源优化: 1-2小时（如需要）
- 代码分包: 2-3小时（如需要）

---

## ✅ 完成标准

### 高优先级任务完成标准
- ✅ 所有硬编码占位符已修复
- ✅ 所有功能测试通过
- ✅ 包大小符合限制
- ✅ 所有配置正确

### 中优先级任务完成标准
- ✅ 订阅消息配置完成（如需要）
- ✅ 其他页面弹窗评估完成
- ✅ 性能监控已设置

### 低优先级任务完成标准
- ✅ 持续优化，不影响上线

---

## 📝 注意事项

### 1. 测试环境
- 使用微信开发者工具进行测试
- 在真机上测试关键功能
- 测试不同设备（iPhone、Android）

### 2. 性能要求
- 主包大小 ≤ 2MB
- 总包大小 ≤ 20MB
- setData 调用频率 ≤ 20次/秒
- setData 数据量 ≤ 256KB

### 3. 安全要求
- 不包含硬编码密钥、密码
- 不包含占位符数据
- 错误信息不暴露敏感信息

### 4. 规范要求
- 符合微信小程序开发规范
- 符合项目开发规范
- 符合 TDesign 组件规范

---

## 🎯 执行顺序建议

### 第一阶段（必须完成）
1. 修复硬编码电话号码（10分钟）
2. 包大小检查（1小时）
3. 配置检查（1小时）
4. 功能测试（4-6小时）

### 第二阶段（建议完成）
1. 订阅消息配置（30分钟）
2. 检查其他页面弹窗（1-2小时）
3. 性能监控（1小时）

### 第三阶段（后续优化）
1. TypeScript 类型优化（持续）
2. setData 调用优化（持续）
3. 资源优化（如需要）
4. 代码分包（如需要）

---

## 📞 问题反馈

如发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期行为
4. 实际行为
5. 设备/环境信息

---

**最后更新**: 2025年1月

