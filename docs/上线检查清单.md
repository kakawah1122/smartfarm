# 微信小程序上线检查清单

## 一、代码检查 ✅

- [x] TypeScript类型错误已修复
- [x] console.log/error已规范化为logger
- [x] 云函数使用统一集合配置
- [x] TDesign组件正确引入
- [x] 分包和预加载配置完成

## 二、云函数部署检查

请在微信开发者工具中，依次右键上传以下云函数：

### 核心模块
- [ ] `login` - 登录
- [ ] `register` - 注册
- [ ] `user-core` - 用户核心
- [ ] `user-management` - 用户管理
- [ ] `user-approval` - 用户审批

### 生产管理模块
- [ ] `production-dashboard` - 生产仪表盘
- [ ] `production-entry` - 入栏管理
- [ ] `production-exit` - 出栏管理
- [ ] `production-material` - 物料管理

### 健康管理模块
- [ ] `health-abnormal` - 异常记录
- [ ] `health-cost` - 成本计算
- [ ] `health-death` - 死亡记录
- [ ] `health-overview` - 健康概览
- [ ] `health-prevention` - 预防管理
- [ ] `health-records` - 健康记录
- [ ] `health-treatment` - 治疗记录

### 财务管理模块
- [ ] `finance-management` - 财务管理

### AI模块
- [ ] `ai-diagnosis` - AI诊断
- [ ] `ai-learning-cases` - AI学习案例
- [ ] `ai-multi-model` - 多模型AI
- [ ] `process-ai-diagnosis` - AI诊断处理

### 其他模块
- [ ] `breeding-todo` - 养殖待办
- [ ] `dynamic-file-manager` - 文件管理
- [ ] `knowledge-management` - 知识库
- [ ] `lifecycle-management` - 生命周期管理
- [ ] `weather` - 天气服务
- [ ] `get-temp-urls` - 临时链接

## 三、数据库集合检查

在云开发控制台检查以下集合是否存在（不存在则创建）：

### 用户模块
- [ ] `wx_users`
- [ ] `wx_user_invites`
- [ ] `user_notifications`
- [ ] `user_notification_settings`

### 生产模块
- [ ] `prod_batch_entries`
- [ ] `prod_batch_exits`
- [ ] `prod_materials`
- [ ] `prod_material_records`
- [ ] `production_batches`
- [ ] `feed_usage_records`

### 健康模块
- [ ] `health_records`
- [ ] `health_prevention_records`
- [ ] `health_treatment_records`
- [ ] `health_ai_diagnosis`
- [ ] `health_death_records`
- [ ] `health_alerts`

### 财务模块
- [ ] `finance_cost_records`
- [ ] `finance_reports`
- [ ] `finance_analysis_history`

### 系统模块
- [ ] `sys_audit_logs`
- [ ] `sys_configurations`
- [ ] `knowledge_articles`
- [ ] `ai_learning_cases`

## 四、数据库权限设置

按照项目规则设置各集合权限：

| 集合 | 权限设置 |
|-----|---------|
| `wx_users` | 所有用户可读，仅创建者可读写 |
| `health_records` | 所有用户可读，仅创建者可读写 |
| `finance_reports` | 自定义: `{"read": true, "write": false}` |
| `sys_audit_logs` | 所有用户不可读写 |

## 五、微信公众平台配置

### 5.1 基本信息
- [ ] 小程序名称
- [ ] 小程序简介（120字以内）
- [ ] 小程序头像（圆形，建议144×144）
- [ ] 服务类目选择

### 5.2 开发设置
- [ ] 服务器域名配置（如有外部API）
- [ ] 业务域名配置（如有webview）

### 5.3 隐私政策（重要！）
在「设置 → 功能设置 → 用户隐私保护指引」中填写：

**收集的用户信息：**
- 用户昵称和头像（用于展示用户信息）
- 位置信息（用于获取天气数据）

**信息使用目的：**
- 展示用户个人信息
- 提供本地化天气服务
- 记录养殖生产数据

## 六、提交审核前最终检查

- [ ] 所有页面功能正常
- [ ] 所有云函数已上传并测试
- [ ] 数据库集合权限正确
- [ ] 无违规内容
- [ ] 无测试数据/调试代码残留
- [ ] 隐私政策已配置

## 七、审核注意事项（个人账号）

1. **类目限制**：个人账号不能选择需要资质的类目
2. **功能限制**：不能使用支付功能、部分敏感API
3. **内容要求**：不能涉及商业运营、金融服务等

## 八、提交审核

1. 在微信开发者工具点击「上传」
2. 填写版本号和项目备注
3. 登录微信公众平台 → 版本管理
4. 点击「提交审核」
5. 填写审核说明（可选）
6. 等待审核（通常1-7天）

## 九、审核通过后

1. 在「版本管理」中点击「发布」
2. 选择全量发布或灰度发布
3. 发布后约30分钟生效

---

**最后更新**: 2025年11月27日
