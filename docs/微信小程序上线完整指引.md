# 微信小程序上线完整指引

> **鹅数通** 小程序上线完整操作指南  
> 更新时间：2024年11月  
> 适用于：使用云开发的微信小程序  
> **账号类型：个人主体（非企业）** ⭐

---

## ⚠️ 个人小程序特别说明

由于您使用的是**个人账号**（非企业），以下是个人小程序的特点和限制：

### ✅ 个人小程序优点
- 注册简单，无需企业资质和认证费用
- 审核相对宽松，适合个人项目
- 支持云开发、订阅消息等核心功能
- 适合工具类、信息展示类、个人学习类应用

### ⚠️ 个人小程序限制
- ❌ **不支持微信支付**（本项目未使用，无影响 ✅）
- ❌ **不支持获取手机号**（`getPhoneNumber` API，本项目未使用，无影响 ✅）
- ❌ **服务类目受限**，只能选择部分类目（见下文推荐）
- ❌ **不支持"附近的小程序"功能**
- ❌ **不支持插件发布**（但可以使用其他插件）
- ⚠️ **命名限制**：不能使用企业、公司、组织等主体字眼

### 📋 适合您的服务类目（重要）

根据「鹅数通」养殖管理的功能特点，推荐选择以下类目：

**首选类目：**
- **工具 → 信息查询** ✅（推荐，适合数据查询和管理）
- **工具 → 效率** ✅（适合待办、管理类功能）

**备选类目：**
- **工具 → 备忘录**（适合记录类功能）
- **生活服务 → 综合生活服务**（需确认是否对个人开放）

### 🔍 本项目兼容性检查结果
经检查，您的项目**完全兼容个人小程序**：
- ✅ 未使用微信支付
- ✅ 未使用获取手机号功能
- ✅ 主要功能为数据管理和信息查询
- ✅ 符合个人小程序服务范围

---

## 目录

1. [上线前准备工作](#一上线前准备工作)
2. [小程序后台配置](#二小程序后台配置)
3. [版本管理与提审](#三版本管理与提审)
4. [审核与发布](#四审核与发布)
5. [上线后运营](#五上线后运营)
6. [附录：项目特定检查清单](#附录项目特定检查清单)

---

## 一、上线前准备工作

### 1.1 代码质量检查

#### ✅ 已完成项
- [x] 统一日志策略（使用 `logger` 工具）
- [x] 页面布局规范化（Flexbox + 安全区域）
- [x] 详情弹窗组件化（`cured-record-detail-popup`、`death-record-detail-popup`）
- [x] `setData` 性能优化（数据路径形式）
- [x] 跨页面数据同步机制（`global-sync.ts` 工具）
- [x] 主包大小检查（≤2MB）✅
- [x] 总包大小检查（≤20MB）✅
- [x] 云开发环境配置验证 ✅
- [x] 小程序配置验证（appid、权限）✅

#### ⏳ 待完成项
- [ ] 功能测试：页面布局测试（cured-records-list, treatment-records-list, death-records-list）
- [ ] 功能测试：详情弹窗测试（cured-record-detail-popup, death-record-detail-popup）
- [ ] 功能测试：功能回归测试（登录、数据加载、页面跳转、表单提交、云函数调用）
- [ ] 订阅消息配置（可选）：在微信公众平台获取模板ID并更新 `app.ts` 配置
- [ ] 其他页面弹窗组件化评估（price-management、reimbursement-list 等）
- [ ] 性能监控（可选）：使用 `setUpdatePerformanceListener` 监控 `setData` 性能

#### 📝 代码检查清单

```bash
# 1. 检查是否有未处理的 TODO 或 FIXME
grep -r "TODO\|FIXME" miniprogram/

# 2. 检查是否有 console.log（应该使用 logger）
grep -r "console\.log\|console\.warn" miniprogram/ --exclude-dir=node_modules

# 3. 检查 TypeScript 编译错误
# 在开发者工具中查看编译错误

# 4. 检查 WXML 语法错误
# 在开发者工具中查看编译错误

# 5. 检查云函数是否正常部署
# 在云开发控制台查看云函数列表和版本
```

---

### 1.2 功能测试清单

#### 核心功能测试
- [ ] **用户登录**：微信授权登录、手机号授权、登录状态持久化
- [ ] **健康管理**：
  - [ ] 鹅群健康状态展示
  - [ ] 治疗记录的创建、编辑、删除
  - [ ] 治愈记录的创建、编辑、删除
  - [ ] 死亡记录的创建、编辑、删除
  - [ ] 健康数据实时同步和更新
  - [ ] 详情弹窗的打开、关闭、数据展示
- [ ] **养殖待办**：
  - [ ] 待办任务列表展示
  - [ ] 任务完成状态切换
  - [ ] 跨页面任务状态同步（返回首页后任务状态应正确更新）
- [ ] **AI 功能**：
  - [ ] AI 疾病诊断（图片上传、分析结果）
  - [ ] AI 财务分析
  - [ ] AI 鹅价识别
- [ ] **价格管理**：
  - [ ] 鹅价列表展示
  - [ ] 鹅价添加、编辑、删除
- [ ] **报销管理**：
  - [ ] 报销记录列表
  - [ ] 报销申请、审核
- [ ] **数据统计**：
  - [ ] 首页数据汇总展示
  - [ ] 图表和可视化

#### 兼容性测试
- [ ] **iOS 测试**（iOS 13+）
- [ ] **Android 测试**（Android 7.0+）
- [ ] **不同屏幕尺寸测试**（小屏、中屏、大屏、刘海屏）
- [ ] **不同微信版本测试**（建议最低支持微信 8.0+）

#### 异常场景测试
- [ ] 网络断开或弱网环境
- [ ] 云函数调用失败
- [ ] 数据库查询超时
- [ ] 图片上传失败
- [ ] 用户拒绝授权

---

### 1.3 性能优化验证

#### 包大小检查
```bash
# 在微信开发者工具中：
# 1. 点击「详情」
# 2. 查看「基本信息」中的「代码包大小」
# 
# 要求：
# - 主包 ≤ 2MB ✅（当前约 1.8MB）
# - 总包 ≤ 20MB ✅（当前约 8.3MB）
```

#### 性能指标
- [ ] 首屏加载时间 < 3秒
- [ ] 页面切换流畅（无明显卡顿）
- [ ] `setData` 调用频率合理（避免短时间内频繁调用）
- [ ] 图片资源加载优化（懒加载、压缩）

#### 云开发资源配额
- [ ] 检查云函数调用次数配额
- [ ] 检查云数据库读写配额
- [ ] 检查云存储容量和下载配额
- [ ] 必要时升级套餐或购买资源包

---

### 1.4 隐私保护准备

#### 用户隐私保护指引（必须）
根据微信小程序最新规定，必须在小程序中提供《用户隐私保护指引》和《服务协议》。

**需要在小程序后台配置的隐私信息类型：**
- [ ] **用户信息**：`openid`（用于标识用户身份）
- [ ] **手机号码**：`getPhoneNumber`（用于用户登录和绑定）
- [ ] **位置信息**：`getLocation`（如果使用了位置功能）
- [ ] **相册/相机**：`chooseImage`（用于上传图片，如疾病照片）
- [ ] **设备信息**：`getSystemInfo`（用于适配不同设备）

**创建隐私协议：**
1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入「设置」→「基本设置」→「服务内容声明」
3. 填写《用户隐私保护指引》（必填）
4. 填写《用户服务协议》（必填）

**隐私协议内容要点：**
- 收集的用户信息类型及用途
- 信息存储位置和安全措施
- 用户权利（查看、修改、删除）
- 第三方服务说明（如云开发）
- 联系方式

**代码中的隐私弹窗处理：**
从微信基础库 2.32.3 开始，小程序需要弹出隐私同意弹窗。确保在 `app.json` 中配置了 `__usePrivacyCheck__: true`（已配置）。

---

### 1.5 云开发环境配置

#### 云开发环境确认
```typescript
// miniprogram/app.ts
wx.cloud.init({
  env: 'your-env-id', // ⚠️ 确认环境ID正确
  traceUser: true
})
```

#### 云函数部署检查
- [ ] 所有云函数已部署到**正式环境**
- [ ] 云函数版本是最新的
- [ ] 云函数环境变量已正确配置（如有）

**部署云函数：**
```bash
# 在微信开发者工具中：
# 1. 右键点击云函数目录（如 cloudfunctions/login/）
# 2. 选择「上传并部署：云端安装依赖」
# 3. 等待部署完成
# 4. 在「云开发控制台」→「云函数」中确认版本
```

#### 云数据库权限配置
- [ ] 检查数据库集合的**权限设置**（建议：「仅创建者可读写」或「自定义安全规则」）
- [ ] 确保敏感数据通过**云函数**进行权限校验，而不是直接客户端操作

**数据库集合权限设置：**
1. 登录「云开发控制台」
2. 进入「数据库」→ 选择集合
3. 点击「权限设置」
4. 建议设置为「仅创建者可读写」或通过云函数进行权限控制

#### 云存储权限配置
- [ ] 检查云存储的**权限设置**
- [ ] 确保图片等资源可以被正常访问

---

## 二、小程序后台配置

### 2.1 基本信息设置

登录[微信公众平台](https://mp.weixin.qq.com/)，进入小程序管理后台。

#### 小程序名称、头像、简介
1. 进入「设置」→「基本设置」→「基本信息」
2. 设置小程序名称：**鹅数通**（示例，需符合微信命名规范）
3. 上传小程序头像（建议尺寸：144px × 144px）
4. 填写小程序简介（120字以内）

**命名注意事项（个人小程序特别注意）：**
- ✅ **个人小程序可以使用的命名**：「XXX工具」、「XXX助手」、「XXX管家」等
- ❌ **个人小程序不可使用**：企业、公司、集团、有限公司等企业/组织主体字眼
- ❌ 不得含有营销、广告性质词汇（如「最好」、「第一」、「官方」）
- ❌ 不得侵犯他人商标权、名誉权
- ❌ 不得含有国家机关、事业单位等名称（除非有授权）
- 💡 **建议名称**：「鹅数通」、「鹅数通工具」、「鹅数通助手」都是可以的

#### 服务类目（个人小程序重点关注）⭐

**个人小程序可选类目有限**，请务必选择正确的类目，否则会被驳回！

1. 进入「设置」→「基本设置」→「服务类目」
2. **个人小程序推荐类目（针对鹅数通项目）**：
   - ✅ **首选**：「工具 → 信息查询」（最适合，适合数据查询和管理）
   - ✅ **备选1**：「工具 → 效率」（适合待办、管理类功能）
   - ✅ **备选2**：「工具 → 备忘录」（适合记录类功能）

3. **个人小程序不可选类目（会被驳回）**：
   - ❌ 「工具 → 企业管理」（需要企业资质）
   - ❌ 「电商平台」相关（需要企业营业执照）
   - ❌ 「金融」相关（需要金融牌照）
   - ❌ 「医疗」相关（需要医疗机构许可证）
   - ❌ 「教育」相关（部分类目需要办学许可证）

**类目选择注意事项（个人小程序）：**
- ⚠️ **必须与实际功能一致**：审核时会重点检查功能是否超出类目范围
- ⚠️ **个人无需提供资质证明**：但功能必须在允许范围内
- 💡 **建议只选1-2个类目**：类目越少，审核越快
- 📌 **类目一年只能修改3次**：请谨慎选择

---

### 2.2 服务器域名配置

小程序只能与配置过的服务器域名通信。由于本项目使用**微信云开发**，大部分接口无需配置域名，但如果有外部API调用（如第三方服务），需要配置。

#### 配置步骤
1. 进入「开发」→「开发管理」→「开发设置」→「服务器域名」
2. 配置以下域名（如有）：
   - **request 合法域名**：HTTPS 请求域名（如天气API、第三方服务）
   - **socket 合法域名**：WebSocket 连接域名（如实时通信）
   - **uploadFile 合法域名**：上传文件域名（云开发已包含，一般无需额外配置）
   - **downloadFile 合法域名**：下载文件域名（云开发已包含，一般无需额外配置）

**域名要求：**
- 必须是 HTTPS 协议（SSL证书有效）
- 域名需备案
- 不支持 IP 地址和端口号

**云开发默认域名（无需配置）：**
- `https://api.weixin.qq.com`（微信官方API）
- `https://servicewechat.com`（云开发域名）

#### 本项目外部域名检查
```bash
# 检查代码中是否有外部API调用
grep -r "wx.request\|wx.downloadFile\|wx.uploadFile" miniprogram/ | grep -v "wx.cloud"
```

如果有外部API，需要将域名添加到服务器域名配置中。

---

### 2.3 业务域名配置（可选）

如果小程序需要通过 `web-view` 组件打开外部网页，需要配置业务域名。

#### 配置步骤
1. 进入「设置」→「基本设置」→「业务域名」
2. 点击「添加」，输入域名
3. 下载校验文件，上传到域名根目录
4. 点击「保存」

**本项目是否需要：**
- 如果不使用 `web-view`，则无需配置
- 检查代码：`grep -r "web-view" miniprogram/`

---

### 2.4 隐私设置配置

#### 配置步骤
1. 进入「设置」→「基本设置」→「服务内容声明」
2. 填写《用户隐私保护指引》
3. 填写《用户服务协议》
4. 进入「设置」→「基本设置」→「用户隐私保护指引」
5. 勾选小程序使用的隐私接口（**个人小程序实际使用**）：
   - [x] 获取用户信息（`wx.getUserProfile`）
   - [ ] ~~获取手机号码~~（`button.open-type="getPhoneNumber"`）❌ **个人小程序不支持，本项目未使用**
   - [x] 选择图片（`wx.chooseImage` 或 `wx.chooseMedia`）
   - [x] 获取位置信息（`wx.getLocation`，如有）
   - [x] 获取设备信息（`wx.getSystemInfo`）

---

### 2.5 权限配置（个人小程序）

#### 小程序权限集（个人小程序可用）
1. 进入「开发」→「开发管理」→「接口设置」
2. 确认以下权限已开通（个人小程序实际可用）：
   - [x] **用户信息**：`scope.userInfo`（✅ 个人小程序支持）
   - [ ] ~~**手机号**~~：`getPhoneNumber`（❌ **个人小程序不支持**，需企业认证）
   - [x] **相册**：`scope.writePhotosAlbum`（✅ 个人小程序支持，如需保存图片到相册）
   - [x] **位置信息**：`scope.userLocation`（✅ 个人小程序支持，如需获取地理位置）
   - [x] **订阅消息**：`subscribeMessage`（✅ 个人小程序支持，用于推送通知）

#### 个人小程序不支持的功能
以下功能仅企业认证小程序可用，个人小程序**不支持**：
- ❌ 微信支付（`wx.requestPayment`）
- ❌ 获取手机号（`getPhoneNumber`）
- ❌ 附近的小程序
- ❌ 插件发布
- ❌ 客服能力（需要企业认证）

#### 订阅消息模板配置（可选但推荐）
1. 进入「功能」→「订阅消息」
2. 点击「选用」，从模板库中选择合适的模板：
   - **养殖提醒**（如喂食、用药提醒）
   - **数据更新通知**（如健康数据变化）
   - **待办任务提醒**
3. 获取模板ID，更新 `miniprogram/app.ts`：

```typescript
// miniprogram/app.ts
globalData: {
  subscriptionTemplates: [
    'your-template-id-1', // 养殖提醒
    'your-template-id-2', // 数据更新通知
    'your-template-id-3', // 待办任务提醒
  ]
}
```

---

### 2.6 体验版和测试账号

#### 添加体验成员
1. 进入「成员管理」→「体验成员」
2. 添加测试人员的微信号
3. 体验成员可以扫码体验小程序

#### 生成体验版二维码
1. 在微信开发者工具中上传代码后
2. 登录小程序后台
3. 进入「管理」→「版本管理」→「开发版本」
4. 点击「生成体验版」
5. 生成二维码，分享给测试人员

---

## 三、版本管理与提审

### 3.1 使用开发者工具上传代码

#### 上传步骤
1. 在微信开发者工具中，确保项目编译无错误
2. 点击工具栏的「上传」按钮
3. 填写版本号（如 `1.0.0`）和项目备注（如 `首次发布版本`）
4. 点击「上传」

**版本号规范：**
- 遵循语义化版本号：`主版本号.次版本号.修订号`
- 例如：`1.0.0`（首次发布）→ `1.0.1`（小修复）→ `1.1.0`（新功能）→ `2.0.0`（重大更新）

**上传注意事项：**
- 确保 `app.json` 中的 `appid` 正确
- 确保云函数已部署到正式环境
- 上传前先在开发版本中充分测试

---

### 3.2 提交审核

#### 提交审核步骤
1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入「管理」→「版本管理」
3. 找到刚上传的「开发版本」
4. 点击「提交审核」

#### 填写审核信息

**1. 选择审核类型**
- [x] 功能页面审核（默认）

**2. 配置功能页面**
至少配置一个功能页面作为审核入口：
- **页面路径**：`pages/index/index`（首页）
- **页面标题**：「鹅数通 - 养殖管理」
- **页面截图**：上传首页截图（建议尺寸：750px × 1334px）
- **功能描述**：「养殖数据管理、健康记录、待办任务等功能的首页入口」

可以添加更多功能页面：
- **健康管理**：`pages/health/health`
- **养殖待办**：`pages/breeding-todo/breeding-todo`
- **AI诊断**：`packageAI/ai-diagnosis/ai-diagnosis`

**3. 服务类目确认**
确认选择的服务类目与实际功能一致。

**4. 版本描述**
填写本次更新的内容（如首次发布，填写「小程序首次发布，提供养殖数据管理、健康记录、AI诊断等功能」）。

**5. 隐私相关**
- 勾选「已阅读并同意《微信小程序平台服务条款》和《微信小程序平台运营规范》」
- 确认已填写《用户隐私保护指引》

**6. 测试账号（可选）**
如果小程序需要登录才能使用，需要提供测试账号：
- 测试手机号
- 测试密码或说明

---

### 3.3 审核要点和注意事项

#### 审核时间
- 一般为 **1-7 个工作日**
- 法定节假日审核时间会延长
- 如有紧急需求，可申请「加急审核」（有次数限制）

#### 审核重点
微信审核团队会重点检查以下内容：

**1. 功能完整性**
- 小程序能正常打开和使用
- 核心功能可正常操作
- 无明显 bug 和闪退

**2. 服务类目一致性**
- 小程序实际功能与所选服务类目一致
- 不得超出类目范围提供服务

**3. 用户隐私保护**
- 必须有《用户隐私保护指引》和《服务协议》
- 收集用户信息前必须明确告知并获得同意
- 不得强制用户授权与核心功能无关的信息

**4. 内容合规**
- 不含违法违规内容（色情、暴力、赌博等）
- 不含虚假宣传和诱导分享
- 不侵犯他人知识产权

**5. 页面规范**
- 页面标题清晰，导航明确
- 无白屏、空白页面
- 无明显UI错误

**6. 网络请求规范**
- 所有网络请求使用 HTTPS
- 域名已配置到服务器域名列表

---

## 四、审核与发布

### 4.1 审核流程说明

#### 审核状态
- **审核中**：微信团队正在审核
- **审核通过**：可以发布
- **审核不通过**：需要根据驳回原因修改后重新提交

#### 审核通过通知
- 微信会发送模板消息到管理员微信
- 同时会发送邮件通知到注册邮箱

---

### 4.2 常见驳回原因及解决方案

#### 1. 服务类目不符
**驳回原因：**
> 你好，你的小程序提供 [具体功能] 服务，应选择 [正确类目]，请重新选择服务类目后提审。

**解决方案：**
- 进入「设置」→「基本设置」→「服务类目」
- 修改或添加正确的类目
- 如需资质类目，准备并上传相关证明文件
- 重新提交审核

---

#### 2. 缺少用户隐私保护指引
**驳回原因：**
> 你好,你的小程序收集用户信息,但未在《小程序用户隐私保护指引》中说明收集用户信息的目的、方式和范围。

**解决方案：**
- 进入「设置」→「基本设置」→「服务内容声明」
- 完善《用户隐私保护指引》
- 确保列出所有收集的信息类型及用途
- 重新提交审核

---

#### 3. 小程序页面内容空白
**驳回原因：**
> 你好，你的小程序页面内容为空或无法正常使用，请完善后重新提交审核。

**解决方案：**
- 检查是否需要登录才能查看内容（提供测试账号）
- 检查云开发环境ID是否正确
- 检查网络请求是否正常
- 确保审核人员能正常访问所有功能页面

---

#### 4. 强制关注公众号
**驳回原因：**
> 你好，你的小程序存在强制或诱导用户关注公众号的行为，违反《微信小程序平台运营规范》，请修改后重新提交审核。

**解决方案：**
- 删除强制关注公众号的逻辑
- 关注公众号应为可选项，不能影响小程序核心功能使用

---

#### 5. 涉及支付但未提供支付资质
**驳回原因：**
> 你好，你的小程序涉及支付功能，需提供相关资质，请补充后重新提交审核。

**解决方案：**
- 如有支付功能，需开通「微信支付」
- 提供营业执照、经营许可证等资质
- 确保支付流程合规

---

#### 6. 小程序名称不规范
**驳回原因：**
> 你好，你的小程序名称含有 [具体词汇]，不符合命名规范，请修改后重新提交审核。

**解决方案：**
- 进入「设置」→「基本设置」→「基本信息」
- 修改小程序名称（注意：一年只能修改2次）
- 确保名称不含营销、广告性质词汇
- 重新提交审核

---

### 4.3 审核通过后的发布操作

#### 发布步骤
1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入「管理」→「版本管理」
3. 找到「审核版本」（显示「审核通过」）
4. 点击「发布」按钮
5. 确认发布

**发布后：**
- 小程序立即上线，用户可以搜索和使用
- 可以在「线上版本」中查看当前发布的版本

#### 版本回退（如有问题）
如果发布后发现严重问题，可以紧急回退：
1. 进入「管理」→「版本管理」→「线上版本」
2. 点击「版本回退」
3. 选择要回退到的历史版本
4. 确认回退

**注意：**
- 版本回退次数有限（每年 10 次）
- 回退后需要重新提审最新版本

---

## 五、上线后运营

### 5.1 数据监控

#### 小程序数据助手
1. 在微信中搜索「小程序数据助手」
2. 绑定小程序
3. 实时查看以下数据：
   - 访问次数（PV）
   - 访问人数（UV）
   - 新增用户数
   - 分享次数
   - 页面访问路径

#### 微信公众平台数据分析
1. 登录微信公众平台
2. 进入「统计」→「数据分析」
3. 查看详细数据：
   - **概览**：访问趋势、用户画像
   - **访问分析**：访问页面排行、访问来源
   - **用户画像**：性别、年龄、地区分布
   - **留存分析**：次日留存、7日留存

---

### 5.2 用户反馈处理

#### 收集用户反馈
- 在小程序中添加「意见反馈」入口
- 使用云开发的数据库存储反馈信息
- 定期查看和处理用户反馈

#### 客服消息
1. 进入「功能」→「客服消息」
2. 开通客服功能
3. 在小程序中添加客服按钮：
```xml
<button open-type="contact">联系客服</button>
```

---

### 5.3 版本迭代和热更新

#### 版本迭代流程
1. **开发新功能** → 在开发分支测试
2. **上传代码** → 生成开发版本
3. **内部测试** → 生成体验版，测试人员测试
4. **提交审核** → 审核通过后发布
5. **监控数据** → 收集用户反馈，准备下一版本

#### 小程序热更新机制
小程序会在以下时机自动检查更新：
- 小程序启动时（冷启动）
- 小程序从后台切换到前台时

**主动触发更新（推荐）：**
在 `app.ts` 中实现自动更新逻辑：

```typescript
// miniprogram/app.ts
App({
  onLaunch() {
    this.checkUpdate()
  },
  
  checkUpdate() {
    const updateManager = wx.getUpdateManager()
    
    updateManager.onCheckForUpdate((res) => {
      if (res.hasUpdate) {
        console.log('发现新版本')
      }
    })
    
    updateManager.onUpdateReady(() => {
      wx.showModal({
        title: '更新提示',
        content: '新版本已经准备好，是否重启应用？',
        success: (res) => {
          if (res.confirm) {
            // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启
            updateManager.applyUpdate()
          }
        }
      })
    })
    
    updateManager.onUpdateFailed(() => {
      // 新版本下载失败
      wx.showToast({
        title: '新版本下载失败',
        icon: 'none'
      })
    })
  }
})
```

---

## 附录：项目特定检查清单

### A. 云开发环境检查

- [ ] **环境ID正确**：`miniprogram/app.ts` 中的 `env` 参数已设置为正式环境ID
- [ ] **云函数已部署**：所有云函数已部署到正式环境
- [ ] **数据库权限设置**：敏感数据集合已设置权限（建议「仅创建者可读写」）
- [ ] **云存储权限设置**：图片等资源可正常访问
- [ ] **资源配额充足**：云函数调用、数据库读写、存储容量配额充足

---

### B. 代码规范检查

- [ ] **日志使用规范**：生产环境无 `console.log`，使用 `logger` 工具
- [ ] **错误处理**：所有 `async/await` 包裹在 `try-catch` 中
- [ ] **TypeScript类型**：关键业务逻辑避免使用 `any` 类型
- [ ] **页面布局**：所有列表页面使用 Flexbox + `safe-area` 布局
- [ ] **组件化**：详情弹窗已组件化，遵循项目规范

---

### C. 性能优化检查

- [ ] **`setData` 优化**：使用数据路径形式，避免更新整个对象
- [ ] **`setData` 频率**：避免在短时间内频繁调用（使用防抖或节流）
- [ ] **背景页面更新**：避免在页面处于后台时频繁调用 `setData`
- [ ] **图片懒加载**：长列表图片使用 `lazy-load`
- [ ] **分包加载**：合理使用分包和 `lazyCodeLoading`

---

### D. 功能完整性检查

- [ ] **登录功能**：用户可正常登录，登录状态持久化
- [ ] **健康管理**：治疗、治愈、死亡记录的 CRUD 功能正常
- [ ] **养殖待办**：任务列表、完成状态切换、跨页面同步正常
- [ ] **AI功能**：AI诊断、财务分析、鹅价识别功能正常
- [ ] **数据统计**：首页数据汇总、图表展示正常
- [ ] **实时数据同步**：健康管理页面的实时监听和更新正常

---

### E. 兼容性和异常处理检查

- [ ] **iOS兼容性**：在 iOS 设备上测试所有核心功能
- [ ] **Android兼容性**：在 Android 设备上测试所有核心功能
- [ ] **网络异常处理**：弱网或断网时有友好提示
- [ ] **云函数失败处理**：云函数调用失败时有错误提示
- [ ] **授权拒绝处理**：用户拒绝授权时有引导提示

---

### F. 隐私和安全检查

- [ ] **隐私协议**：《用户隐私保护指引》和《服务协议》已填写
- [ ] **隐私接口声明**：小程序后台已勾选使用的隐私接口
- [ ] **敏感信息保护**：代码中无硬编码的环境ID、密钥等敏感信息
- [ ] **数据加密**：敏感数据传输使用 HTTPS，存储时加密处理

---

### G. 提审前最后检查

- [ ] **版本号**：`app.json` 中的 `version` 已更新
- [ ] **环境切换**：确认代码使用正式环境（非测试环境）
- [ ] **测试账号**：准备测试手机号和说明（如需登录）
- [ ] **页面截图**：准备首页和主要功能页面的截图
- [ ] **功能描述**：准备审核用的功能描述文字
- [ ] **服务类目**：确认服务类目与实际功能一致
- [ ] **团队沟通**：通知团队成员即将提审，准备应对审核反馈

---

## 总结

**恭喜！如果您已完成以上所有检查，您的小程序已具备上线条件。**

**上线步骤回顾：**
1. ✅ 完成代码质量检查和功能测试
2. ✅ 配置小程序后台（基本信息、服务类目、隐私设置等）
3. ✅ 上传代码并提交审核
4. ✅ 等待审核通过（1-7个工作日）
5. ✅ 审核通过后点击发布
6. ✅ 监控数据，收集用户反馈，准备迭代

**重要提醒：**
- 上线后持续监控数据和用户反馈
- 及时修复bug和优化体验
- 定期更新功能，保持小程序活跃度
- 遵守微信小程序平台运营规范，避免违规操作

**参考资料：**
- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信小程序平台运营规范](https://developers.weixin.qq.com/miniprogram/product/operation.html)
- [微信小程序审核指南](https://developers.weixin.qq.com/community/develop/article/doc/000e06cdc8848047fdd7d96c656813)
- [云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)

---

**如有疑问，请参考微信官方文档或在微信开放社区提问。祝您的小程序顺利上线！🎉**

