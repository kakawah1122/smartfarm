# é¢„é˜²ç®¡ç†ä¸é¦–é¡µé›†æˆæ–¹æ¡ˆ

> **è®¾è®¡ç›®æ ‡**ï¼šåœ¨ä¿ç•™é¦–é¡µæé†’åŠŸèƒ½çš„åŒæ—¶ï¼Œå°†é¢„é˜²ç®¡ç†æ‰“é€ ä¸ºå®Œæ•´çš„ä»»åŠ¡ç®¡ç†ä¸­å¿ƒ  
> **è®¾è®¡æ—¥æœŸ**ï¼š2025-10-30  
> **ç‰ˆæœ¬**ï¼šv3.0

---

## ğŸ¯ è®¾è®¡ç†å¿µ

### æ ¸å¿ƒåŸåˆ™
1. **é¦–é¡µ = æé†’ä¸­å¿ƒ**ï¼šå¿«é€Ÿæµè§ˆï¼Œä¸»åŠ¨æé†’
2. **é¢„é˜²ç®¡ç† = å·¥ä½œä¸­å¿ƒ**ï¼šæ·±åº¦æ“ä½œï¼Œå…¨é¢ç®¡ç†
3. **æ— ç¼è¡”æ¥**ï¼šä¸¤è€…æ•°æ®åŒæ­¥ï¼Œæ“ä½œäº’é€š

---

## ğŸ“± æ–¹æ¡ˆCï¼šæ™ºèƒ½åˆ†å±‚ + æ·±åº¦é›†æˆï¼ˆæ¨èï¼‰

### ä¸€ã€é¦–é¡µæ”¹é€ 

#### 1.1 ä»Šæ—¥å¾…åŠå¡ç‰‡ï¼ˆè½»é‡çº§ï¼‰

**æ˜¾ç¤ºè§„åˆ™ï¼š**
- ä»…æ˜¾ç¤º **é¢„é˜²ç±»** ç´§æ€¥ä»»åŠ¡ï¼ˆé€¾æœŸ + ä»Šæ—¥ï¼‰
- æœ€å¤šæ˜¾ç¤º **3æ¡**ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åºï¼š
  1. ğŸ”´ é€¾æœŸä»»åŠ¡ï¼ˆæŒ‰é€¾æœŸå¤©æ•°å€’åºï¼‰
  2. ğŸŸ¡ ä»Šæ—¥ä»»åŠ¡ï¼ˆæŒ‰æ‰¹æ¬¡æ—¥é¾„å€’åºï¼‰
  3. ğŸŸ¢ æ˜æ—¥ä»»åŠ¡ï¼ˆä»…å½“ä»Šæ—¥æ— ä»»åŠ¡æ—¶æ˜¾ç¤ºï¼‰

**äº¤äº’è®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ é¢„é˜²å¾…åŠ (3)      [å…¨éƒ¨ç®¡ç† >]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”´ é€¾æœŸ 2å¤©                          â”‚
â”‚  ğŸ“¦ æ‰¹æ¬¡001 Â· ç¬¬15å¤©                  â”‚
â”‚  ğŸ’‰ æ–°æ”¯äºŒè”è‹—æ¥ç§                    â”‚
â”‚                          [å»å®Œæˆ >]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¡ ä»Šæ—¥                              â”‚
â”‚  ğŸ“¦ æ‰¹æ¬¡002 Â· ç¬¬7å¤©                   â”‚
â”‚  ğŸ§¼ æ èˆæ¶ˆæ¯’                          â”‚
â”‚                          [å»å®Œæˆ >]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ æ˜æ—¥                              â”‚
â”‚  ğŸ“¦ æ‰¹æ¬¡001 Â· ç¬¬20å¤©                  â”‚
â”‚  ğŸ’‰ ç¦½æµæ„Ÿç–«è‹—æ¥ç§                    â”‚
â”‚                          [æŸ¥çœ‹è¯¦æƒ…]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»è¡Œä¸ºï¼š**
- **å•ä¸ªä»»åŠ¡å¡ç‰‡**ï¼šè·³è½¬åˆ°å¯¹åº”çš„å®Œæˆé¡µé¢ï¼ˆç–«è‹—/æ¶ˆæ¯’/ç”¨è¯è®°å½•ï¼‰
- **"å…¨éƒ¨ç®¡ç† >"**ï¼šè·³è½¬åˆ°é¢„é˜²ç®¡ç†é¡µé¢çš„"ä»Šæ—¥å¾…åŠ"æ ‡ç­¾
- **"å»å®Œæˆ"æŒ‰é’®**ï¼šç›´æ¥è¿›å…¥ä»»åŠ¡å®Œæˆæµç¨‹

#### 1.2 æ•°æ®æ¥æº

**äº‘å‡½æ•°è°ƒç”¨ï¼š**
```typescript
// pages/index/index.ts
async loadTodayPreventionTasks() {
  const result = await wx.cloud.callFunction({
    name: 'health-management',
    data: {
      action: 'getTodayPreventionTasks',  // æ–°å¢æ¥å£
      limit: 3,  // ä»…è·å–å‰3æ¡
      batchId: 'all'
    }
  })
  
  if (result.result.success) {
    this.setData({
      todayPreventionTasks: result.result.data.tasks
    })
  }
}
```

**äº‘å‡½æ•°å®ç°ï¼š**
```javascript
// è·å–ä»Šæ—¥é¢„é˜²å¾…åŠï¼ˆé¦–é¡µç”¨ï¼‰
async function getTodayPreventionTasks(event, wxContext) {
  const { limit = 3, batchId } = event
  const openid = wxContext.OPENID
  const today = new Date().toISOString().split('T')[0]
  
  // æƒé™éªŒè¯
  const hasPermission = await checkPermission(openid, 'health', 'view', batchId)
  if (!hasPermission) {
    return { success: false, errorCode: 'PERMISSION_DENIED', message: 'æƒé™ä¸è¶³' }
  }
  
  // æŸ¥è¯¢ä»Šæ—¥å’Œé€¾æœŸä»»åŠ¡
  const tasksResult = await db.collection(COLLECTIONS.TASK_BATCH_SCHEDULES)
    .where({
      category: 'health',
      completed: false,
      targetDate: _.lte(today)  // ä»Šæ—¥åŠä¹‹å‰
    })
    .orderBy('targetDate', 'asc')
    .limit(limit)
    .get()
  
  const tasks = tasksResult.data.map(task => ({
    taskId: task._id,
    taskName: task.taskName,
    taskType: task.taskType,
    batchNumber: task.batchNumber,
    dayAge: task.dayAge,
    targetDate: task.targetDate,
    isOverdue: task.targetDate < today,
    overdueDays: task.targetDate < today ? 
      Math.floor((new Date(today) - new Date(task.targetDate)) / (24 * 60 * 60 * 1000)) : 0,
    priority: task.targetDate < today ? 'high' : 
              task.targetDate === today ? 'medium' : 'low'
  }))
  
  return {
    success: true,
    data: {
      tasks,
      totalCount: tasks.length,
      hasMore: tasks.length >= limit
    }
  }
}
```

---

### äºŒã€é¢„é˜²ç®¡ç†é¡µé¢æ”¹é€ ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰

#### 2.1 æ–°å¢ï¼šå…¨å‘¨æœŸç”˜ç‰¹å›¾

**è®¾è®¡ç›®æ ‡ï¼š**
- å¯è§†åŒ–å±•ç¤ºæ•´ä¸ªå…»æ®–å‘¨æœŸï¼ˆ1-60å¤©ï¼‰çš„æ‰€æœ‰é¢„é˜²è®¡åˆ’
- ç›´è§‚çœ‹åˆ°å“ªäº›ä»»åŠ¡å·²å®Œæˆã€å“ªäº›å¾…å®Œæˆã€å“ªäº›é€¾æœŸ

**UIè®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—“ï¸ å…¨å‘¨æœŸé¢„é˜²è®¡åˆ’ï¼ˆæ‰¹æ¬¡001ï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¥é¾„    ä»»åŠ¡                    çŠ¶æ€    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬1å¤©   å¼€é£Ÿç”¨è¯               âœ… å·²å®Œæˆâ”‚
â”‚  ç¬¬3å¤©   é¦–æ¬¡æ¶ˆæ¯’               âœ… å·²å®Œæˆâ”‚
â”‚  ç¬¬7å¤©   æ–°æ”¯äºŒè”è‹—             âœ… å·²å®Œæˆâ”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ç¬¬15å¤©  æ èˆæ¶ˆæ¯’               ğŸ”´ é€¾æœŸ2å¤©â”‚
â”‚  ç¬¬20å¤©  ç¦½æµæ„Ÿç–«è‹—             ğŸŸ¡ ä»Šæ—¥   â”‚
â”‚  ç¬¬28å¤©  ç¬¬äºŒæ¬¡æ¶ˆæ¯’             â³ è®¡åˆ’ä¸­â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ç¬¬35å¤©  å¼ºåŒ–å…ç–«               â³ è®¡åˆ’ä¸­â”‚
â”‚  ç¬¬42å¤©  æ èˆæ¶ˆæ¯’               â³ è®¡åˆ’ä¸­â”‚
â”‚  ç¬¬50å¤©  å‡ºæ å‰ä½“æ£€             â³ è®¡åˆ’ä¸­â”‚
â”‚                                         â”‚
â”‚  è¿›åº¦ï¼š3/10 å·²å®Œæˆ (30%)         â—â—â—â—‹â—‹â—‹â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æ–¹å¼ï¼š**
```typescript
// packageHealth/prevention-timeline/prevention-timeline.ts
Page({
  data: {
    timelineData: []  // æ—¶é—´çº¿æ•°æ®
  },
  
  async loadTimeline() {
    const result = await wx.cloud.callFunction({
      name: 'health-management',
      data: {
        action: 'getPreventionTimeline',
        batchId: this.data.currentBatchId
      }
    })
    
    if (result.result.success) {
      this.setData({
        timelineData: result.result.data.timeline
      })
    }
  }
})
```

#### 2.2 æ–°å¢ï¼šæ‰¹æ¬¡å¯¹æ¯”è§†å›¾

**è®¾è®¡ç›®æ ‡ï¼š**
- å¯¹æ¯”å¤šä¸ªæ‰¹æ¬¡çš„é¢„é˜²è¿›åº¦
- å‘ç°é—®é¢˜æ‰¹æ¬¡ï¼ŒåŠæ—¶å¹²é¢„

**UIè®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š æ‰¹æ¬¡é¢„é˜²å¯¹æ¯”                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‰¹æ¬¡     æ¥ç§ç‡   æˆæœ¬    å®Œæˆåº¦       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  001     100%    Â¥450    â—â—â—â—â—â— 60%   â”‚
â”‚  002     85%     Â¥380    â—â—â—â—â—‹â—‹ 40%   â”‚
â”‚  003     90%     Â¥420    â—â—â—â—â—â—‹ 50%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3 é¡µé¢ç»“æ„ä¼˜åŒ–

**æ ‡ç­¾é¡µé‡æ–°ç»„ç»‡ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä»Šæ—¥å¾…åŠ] [å…¨å‘¨æœŸ] [ç»Ÿè®¡] [è®°å½•]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ä»Šæ—¥å¾…åŠã€‘æ ‡ç­¾
- ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨ï¼ˆä¸é¦–é¡µæ•°æ®åŒæ­¥ï¼‰
- é€¾æœŸä»»åŠ¡åˆ—è¡¨
- å¿«æ·å®Œæˆå…¥å£

ã€å…¨å‘¨æœŸã€‘æ ‡ç­¾
- ç”˜ç‰¹å›¾/æ—¶é—´çº¿è§†å›¾
- æ‰¹æ¬¡é€‰æ‹©å™¨
- ä»»åŠ¡ç­›é€‰ï¼ˆç–«è‹—/æ¶ˆæ¯’/ç”¨è¯ï¼‰

ã€ç»Ÿè®¡ã€‘æ ‡ç­¾
- å››å®«æ ¼ç»Ÿè®¡å¡ç‰‡
- æ‰¹æ¬¡å¯¹æ¯”
- è¶‹åŠ¿å›¾è¡¨

ã€è®°å½•ã€‘æ ‡ç­¾
- æ‰§è¡Œè®°å½•åˆ—è¡¨
- ç­›é€‰å’Œæœç´¢
- å¯¼å‡ºåŠŸèƒ½
```

---

### ä¸‰ã€æ•°æ®æµè½¬

#### 3.1 é¦–é¡µ â†’ é¢„é˜²ç®¡ç†

**åœºæ™¯1ï¼šç‚¹å‡»"å…¨éƒ¨ç®¡ç†"**
```typescript
// pages/index/index.ts
onViewAllPreventionTasks() {
  wx.navigateTo({
    url: '/pages/health/health?tab=prevention&focus=today'
  })
}

// pages/health/health.ts
onLoad(options: any) {
  if (options.tab === 'prevention' && options.focus === 'today') {
    this.setData({
      activeTab: 'prevention',
      preventionSubTab: 'today'  // å®šä½åˆ°"ä»Šæ—¥å¾…åŠ"æ ‡ç­¾
    })
  }
}
```

**åœºæ™¯2ï¼šç‚¹å‡»å•ä¸ªä»»åŠ¡"å»å®Œæˆ"**
```typescript
// pages/index/index.ts
onCompleteTask(e: any) {
  const task = e.currentTarget.dataset.task
  const url = this.getTaskCompletionUrl(task)
  wx.navigateTo({ url })
}

getTaskCompletionUrl(task: any) {
  const baseParams = `taskId=${task.taskId}&batchId=${task.batchId}&fromHome=true`
  
  switch (task.taskType) {
    case 'vaccine':
      return `/packageHealth/vaccine-record/vaccine-record?${baseParams}`
    case 'medication':
      return `/packageHealth/medication-record/medication-record?${baseParams}`
    case 'disinfection':
      return `/packageHealth/disinfection-record/disinfection-record?${baseParams}`
  }
}
```

#### 3.2 é¢„é˜²ç®¡ç† â†’ å®Œæˆ â†’ è¿”å›

**å®Œæˆä»»åŠ¡åçš„è¿”å›é€»è¾‘ï¼š**
```typescript
// packageHealth/vaccine-record/vaccine-record.ts
async onSubmit() {
  // æäº¤è®°å½•
  const result = await wx.cloud.callFunction({
    name: 'health-management',
    data: {
      action: 'completePreventionTask',
      taskId: this.data.taskId,
      preventionData: {...}
    }
  })
  
  if (result.result.success) {
    wx.showToast({ title: 'å®ŒæˆæˆåŠŸ', icon: 'success' })
    
    // æ ¹æ®æ¥æºè¿”å›ä¸åŒé¡µé¢
    if (this.data.fromHome) {
      // ä»é¦–é¡µè¿›å…¥ï¼Œè¿”å›é¦–é¡µå¹¶åˆ·æ–°
      wx.navigateBack()
      // å‘é€äº‹ä»¶é€šçŸ¥é¦–é¡µåˆ·æ–°
      const eventChannel = this.getOpenerEventChannel()
      eventChannel.emit('taskCompleted', { taskId: this.data.taskId })
    } else {
      // ä»é¢„é˜²ç®¡ç†è¿›å…¥ï¼Œè¿”å›é¢„é˜²ç®¡ç†
      wx.navigateBack()
    }
  }
}
```

---

### å››ã€äº‘å‡½æ•°æ–°å¢æ¥å£

#### 4.1 getTodayPreventionTasks

**ç”¨é€”**ï¼šé¦–é¡µè·å–ç®€åŒ–çš„ä»Šæ—¥å¾…åŠ

**å‚æ•°**ï¼š
- `limit`: è¿”å›æ•°é‡ï¼ˆé»˜è®¤3ï¼‰
- `batchId`: æ‰¹æ¬¡ç­›é€‰ï¼ˆå¯é€‰ï¼‰

**è¿”å›**ï¼š
```json
{
  "success": true,
  "data": {
    "tasks": [
      {
        "taskId": "xxx",
        "taskName": "æ–°æ”¯äºŒè”è‹—",
        "taskType": "vaccine",
        "batchNumber": "001",
        "dayAge": 15,
        "targetDate": "2025-10-28",
        "isOverdue": true,
        "overdueDays": 2,
        "priority": "high"
      }
    ],
    "totalCount": 3,
    "hasMore": false
  }
}
```

#### 4.2 getPreventionTimeline

**ç”¨é€”**ï¼šè·å–å…¨å‘¨æœŸé¢„é˜²æ—¶é—´çº¿

**å‚æ•°**ï¼š
- `batchId`: æ‰¹æ¬¡IDï¼ˆå¿…éœ€ï¼‰

**è¿”å›**ï¼š
```json
{
  "success": true,
  "data": {
    "timeline": [
      {
        "dayAge": 1,
        "date": "2025-10-01",
        "tasks": [
          {
            "taskName": "å¼€é£Ÿç”¨è¯",
            "taskType": "medication",
            "status": "completed",
            "completedDate": "2025-10-01"
          }
        ]
      },
      {
        "dayAge": 15,
        "date": "2025-10-15",
        "tasks": [
          {
            "taskName": "æ èˆæ¶ˆæ¯’",
            "taskType": "disinfection",
            "status": "overdue",
            "overdueDays": 2
          }
        ]
      }
    ],
    "progress": {
      "total": 10,
      "completed": 3,
      "percentage": 30
    }
  }
}
```

---

## ğŸ¨ UI/UX ä¼˜åŒ–å»ºè®®

### 1. é¦–é¡µå¾…åŠå¡ç‰‡

**é¢œè‰²ç³»ç»Ÿï¼š**
- ğŸ”´ **é€¾æœŸ**ï¼š`#EF4444`ï¼ˆçº¢è‰²ï¼‰
- ğŸŸ¡ **ä»Šæ—¥**ï¼š`#F59E0B`ï¼ˆæ©™è‰²ï¼‰
- ğŸŸ¢ **æœªæ¥**ï¼š`#10B981`ï¼ˆç»¿è‰²ï¼‰

**ä¼˜å…ˆçº§æ’åºï¼š**
1. é€¾æœŸå¤©æ•°å¤š â†’ é€¾æœŸå¤©æ•°å°‘
2. ä»Šæ—¥ä»»åŠ¡ï¼ˆæŒ‰æ‰¹æ¬¡æ—¥é¾„å¤§ â†’ å°ï¼‰
3. æ˜æ—¥ä»»åŠ¡

**ç©ºçŠ¶æ€è®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ é¢„é˜²å¾…åŠ        [å…¨éƒ¨ç®¡ç† >]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸ‰                           â”‚
â”‚     ä»Šæ—¥æ— é¢„é˜²ä»»åŠ¡                    â”‚
â”‚    æ‰€æœ‰è®¡åˆ’ä»»åŠ¡å‡å·²å®Œæˆ                â”‚
â”‚                                       â”‚
â”‚    [æŸ¥çœ‹å…¨å‘¨æœŸè®¡åˆ’]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. é¢„é˜²ç®¡ç†å…¨å‘¨æœŸè§†å›¾

**äº¤äº’å¢å¼ºï¼š**
- âœ… **ç‚¹å‡»æ—¶é—´çº¿èŠ‚ç‚¹**ï¼šå±•å¼€ä»»åŠ¡è¯¦æƒ…
- âœ… **é•¿æŒ‰èŠ‚ç‚¹**ï¼šå¿«æ·æ“ä½œèœå•ï¼ˆå®Œæˆ/æ¨è¿Ÿ/åˆ é™¤ï¼‰
- âœ… **ä¸‹æ‹‰ç­›é€‰**ï¼šæŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå…¨éƒ¨/å·²å®Œæˆ/å¾…å®Œæˆ/é€¾æœŸï¼‰
- âœ… **æœç´¢**ï¼šæŒ‰ä»»åŠ¡åç§°æœç´¢

**è§†è§‰ä¼˜åŒ–ï¼š**
- ä½¿ç”¨ä¸åŒé¢œè‰²æ ‡è®°ä¸åŒçŠ¶æ€
- å·²å®Œæˆä»»åŠ¡ç½®ç°
- é€¾æœŸä»»åŠ¡é—ªçƒæé†’
- å½“å‰æ—¥æœŸé«˜äº®æ˜¾ç¤º

---

## ğŸ“Š æ•°æ®ç¼“å­˜ç­–ç•¥

### é¦–é¡µç¼“å­˜ï¼ˆçŸ­å‘¨æœŸï¼‰

```typescript
// pages/index/index.ts
async loadTodayPreventionTasks() {
  const cacheKey = 'home_prevention_tasks'
  const cache = wx.getStorageSync(cacheKey)
  
  // ç¼“å­˜5åˆ†é’Ÿ
  if (cache && Date.now() - cache.timestamp < 5 * 60 * 1000) {
    this.setData({ todayPreventionTasks: cache.data })
    return
  }
  
  // é‡æ–°åŠ è½½
  const result = await wx.cloud.callFunction({...})
  
  wx.setStorageSync(cacheKey, {
    data: result.result.data.tasks,
    timestamp: Date.now()
  })
}
```

### é¢„é˜²ç®¡ç†ç¼“å­˜ï¼ˆä¸­å‘¨æœŸï¼‰

```typescript
// pages/health/health.ts
async loadPreventionTimeline() {
  const cacheKey = `prevention_timeline_${this.data.currentBatchId}`
  const cache = wx.getStorageSync(cacheKey)
  
  // ç¼“å­˜15åˆ†é’Ÿ
  if (cache && Date.now() - cache.timestamp < 15 * 60 * 1000) {
    this.setData({ timelineData: cache.data })
    return
  }
  
  // é‡æ–°åŠ è½½
  const result = await wx.cloud.callFunction({...})
  
  wx.setStorageSync(cacheKey, {
    data: result.result.data.timeline,
    timestamp: Date.now()
  })
}
```

---

## âœ… å®æ–½æ­¥éª¤

### Phase 1ï¼šé¦–é¡µä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] åˆ›å»º `getTodayPreventionTasks` äº‘å‡½æ•°æ¥å£
- [ ] é¦–é¡µæ·»åŠ è½»é‡çº§å¾…åŠå¡ç‰‡
- [ ] å®ç°è·³è½¬é€»è¾‘

### Phase 2ï¼šé¢„é˜²ç®¡ç†å¢å¼ºï¼ˆ3-5å¤©ï¼‰
- [ ] åˆ›å»º `getPreventionTimeline` äº‘å‡½æ•°æ¥å£
- [ ] å®ç°å…¨å‘¨æœŸæ—¶é—´çº¿è§†å›¾
- [ ] æ·»åŠ æ‰¹æ¬¡å¯¹æ¯”åŠŸèƒ½
- [ ] ä¼˜åŒ–æ ‡ç­¾é¡µç»“æ„

### Phase 3ï¼šæ•°æ®è”åŠ¨ï¼ˆ1-2å¤©ï¼‰
- [ ] å®Œå–„æ•°æ®æµè½¬é€»è¾‘
- [ ] å®ç°ç¼“å­˜ç­–ç•¥
- [ ] æ·»åŠ äº‹ä»¶é€šçŸ¥æœºåˆ¶

### Phase 4ï¼šæµ‹è¯•ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] UI/UX ä¼˜åŒ–

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å | æå‡ |
|------|------|--------|------|
| é¦–é¡µåŠ è½½é€Ÿåº¦ | 800ms | 300ms | 62% â†‘ |
| ä»»åŠ¡æŸ¥æ‰¾æ•ˆç‡ | 3æ­¥æ“ä½œ | 1æ­¥ç›´è¾¾ | 66% â†‘ |
| ç”¨æˆ·æ»¡æ„åº¦ | - | - | é¢„æœŸæå‡ |
| ä»»åŠ¡å®Œæˆç‡ | - | - | é¢„æœŸæå‡ |

---

## ğŸ“š æ€»ç»“

### ä¸ºä»€ä¹ˆé€‰æ‹©æ–¹æ¡ˆCï¼Ÿ

1. **ä¿ç•™é¦–é¡µä»·å€¼**ï¼šé¦–é¡µä½œä¸ºæé†’ä¸­å¿ƒï¼Œè®©ç”¨æˆ·ç¬¬ä¸€æ—¶é—´çœ‹åˆ°ç´§æ€¥ä»»åŠ¡
2. **é¢„é˜²ç®¡ç†ä¸“ä¸šåŒ–**ï¼šæ‰“é€ å®Œæ•´çš„é¢„é˜²å·¥ä½œå°ï¼Œæ»¡è¶³æ·±åº¦ç®¡ç†éœ€æ±‚
3. **é¿å…åŠŸèƒ½å‰²è£‚**ï¼šä¿æŒç³»ç»Ÿä¸€è‡´æ€§ï¼ˆç”Ÿäº§ã€è´¢åŠ¡ç­‰æ¨¡å—ä¹Ÿæœ‰é¦–é¡µå…¥å£ï¼‰
4. **æ¸è¿›å¼æ”¹è¿›**ï¼šä¸ç ´åç°æœ‰ç”¨æˆ·ä¹ æƒ¯ï¼Œé€æ­¥ä¼˜åŒ–ä½“éªŒ

### å…³é”®è®¾è®¡åŸåˆ™

- **é¦–é¡µ = å¿«**ï¼š3ç§’å†…çœ‹åˆ°æœ€é‡è¦çš„ä¿¡æ¯
- **é¢„é˜²ç®¡ç† = å…¨**ï¼šå®Œæ•´çš„åŠŸèƒ½å’Œæ•°æ®
- **æ“ä½œ = é¡º**ï¼šæ— ç¼è¡”æ¥ï¼Œæµç•…æ“ä½œ

---

**è®¾è®¡è´Ÿè´£äºº**ï¼šé¹…æ•°é€šäº§å“å›¢é˜Ÿ  
**æŠ€æœ¯è´Ÿè´£äºº**ï¼šé¹…æ•°é€šå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2025-10-30

