#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 运行代码质量检查
echo "🔍 运行代码质量检查..."

# 1. 代码规范检查
echo "\n📝 检查代码规范..."
npm run check:code 2>&1 | tail -5
if [ $? -ne 0 ]; then
  echo "❌ 代码规范检查失败，请修复后再提交"
  exit 1
fi

# 2. TypeScript检查
echo "\n📝 检查TypeScript..."
npm run check:ts 2>&1 | tail -5
if [ $? -ne 0 ]; then
  echo "⚠️ TypeScript存在问题，建议修复"
  # 不阻止提交，只是警告
fi

# 3. 样式检查（只检查严重问题）
echo "\n📝 检查样式规范..."
ERROR_COUNT=$(npm run check:style 2>&1 | grep "错误总数:" | awk '{print $2}')
if [ "$ERROR_COUNT" -gt "1100" ]; then
  echo "⚠️ 样式错误过多（$ERROR_COUNT个），建议优化"
  # 不阻止提交，只是警告
fi

echo "\n✅ 代码检查通过，继续提交..."
