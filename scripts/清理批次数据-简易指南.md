# 清理批次数据 - 简易操作指南

> 最简单的方法：直接在云开发控制台删除集合数据

---

## 📋 需要清理的集合（按顺序操作）

### 1️⃣ 入栏记录
**集合名称**：`prod_batch_entries`

**操作步骤**：
1. 打开微信开发者工具
2. 点击"**云开发**" → "**数据库**"
3. 选择 `prod_batch_entries` 集合
4. 点击右上角"**高级操作**" → "**清空集合**"
5. 确认删除

---

### 2️⃣ 批次信息
**集合名称**：`production_batches`

**操作步骤**：
- 选择 `production_batches` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

### 3️⃣ 任务（重要！）⭐
**集合名称**：`task_batch_schedules`

**操作步骤**：
- 选择 `task_batch_schedules` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

### 4️⃣ 健康记录
**集合名称**：`health_records`

**操作步骤**：
- 选择 `health_records` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

### 5️⃣ 预防记录
**集合名称**：`health_prevention_records`

**操作步骤**：
- 选择 `health_prevention_records` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

### 6️⃣ 治疗记录
**集合名称**：`health_treatment_records`

**操作步骤**：
- 选择 `health_treatment_records` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

### 7️⃣ 死亡记录
**集合名称**：`health_death_records`

**操作步骤**：
- 选择 `health_death_records` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

### 8️⃣ 出栏记录
**集合名称**：`prod_batch_exits`

**操作步骤**：
- 选择 `prod_batch_exits` 集合
- 点击"**高级操作**" → "**清空集合**"
- 确认删除

---

## ✅ 验证清理结果

清理完成后，逐个检查上述集合，确认数据条数为 **0**。

---

## 🚀 重新创建批次

清理完成后，在小程序中重新创建批次：

### 步骤1：新增入栏记录

1. 在小程序中打开"**生产管理**"页面
2. 点击"**新增入栏记录**"按钮
3. 填写批次信息：
   - **批次编号**：可自动生成（如 `E251103001`）
   - **入栏日期**：选择今天或近期日期（如 `2025-11-03`）
   - **入栏数量**：填写数量（如 `1000`）
   - **品种**：选择品种（如 `四川白鹅`）
   - **来源**：填写来源（如 `XX孵化场`）
   - **单价**：填写单价（如 `8.5`）
   - **经办人**：填写经办人姓名
   - **备注**：可选

4. 点击"**保存**"按钮

### 步骤2：系统自动创建

保存成功后，系统会自动：
- ✅ 创建批次记录
- ✅ 创建初始健康检查记录
- ✅ 生成完整的预防管理任务（约50个任务）
  - 疫苗接种任务
  - 用药管理任务
  - 营养管理任务
  - 健康检查任务

### 步骤3：验证任务创建

1. 进入"**健康管理**"页面
2. 点击"**预防管理**"标签
3. 切换到"**进行中**"子标签
4. 应该能看到：
   - ✅ 今日任务列表（按批次分组）
   - ✅ 任务详情（任务名称、日龄、描述等）
   - ✅ 顶部统计数据（疫苗次数、覆盖率、预防成本）

---

## 📊 预期结果

创建批次后，在"健康管理 → 预防管理 → 进行中"页面应该显示：

```
📊 统计卡片
疫苗次数: 0 次
覆盖率: 0%
预防成本: ¥0

📋 任务列表
批次: E251103001 (3个任务)
- 开口药第1天 (日龄1) 今天
- 营养管理 (日龄1) 今天
- 健康检查 (日龄1) 今天

...更多任务
```

---

## 🔍 常见问题

### Q1：清理后数据还在？
**A**：检查是否点击了"清空集合"而不是"删除记录"。"清空集合"会删除所有数据。

### Q2：创建批次后没有任务？
**A**：检查：
1. 云函数 `production-entry` 是否正常部署
2. 查看控制台是否有错误日志
3. 检查 `task_batch_schedules` 集合是否有数据

### Q3：任务显示但没有"今日任务"？
**A**：检查：
1. 入栏日期是否选择的是今天或近期
2. 任务的 `targetDate` 是否正确
3. 任务的 `completed` 是否为 `false`
4. 任务的 `category` 是否是中文（"疫苗接种"等）

---

## ⚠️ 注意事项

1. **数据无法恢复**：清空集合后，数据将彻底删除，无法恢复。如果是生产环境，建议先备份。

2. **权限配置**：清理后，数据库权限配置仍然保留，无需重新配置。

3. **云函数**：清理数据不影响云函数，无需重新部署。

4. **缓存清理**：清理后，建议：
   - 关闭小程序
   - 清除缓存（开发者工具 → 清除缓存）
   - 重新编译运行

---

## 📞 需要帮助？

如果按照以上步骤操作后仍有问题，请提供：
- 控制台错误日志
- 数据库集合截图
- 小程序页面截图

---

**最后更新**：2025-11-03  
**维护者**：AI Assistant

