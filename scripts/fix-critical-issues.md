# 紧急修复方案 - 2024年11月20日

## 问题清单

1. ✅ 预防管理任务显示错误（显示getU）- 已修复
2. ❌ 生产页面物料记录不显示
3. ❌ 生产页面概览卡片数据不更新
4. ❌ 健康页面成本显示精度问题（20000.0018）
5. ❌ 防疫用药和疫苗追踪卡片不更新

## 问题根因

1. **任务显示错误**：loadUpcomingTasks使用了错误的action 'getUpcomingTasks'，应该用'getWeeklyTodos'
2. **物料记录问题**：可能是云函数返回数据格式问题
3. **概览卡片问题**：production-dashboard云函数可能返回空数据
4. **成本精度问题**：JavaScript浮点数计算精度问题
5. **卡片不更新**：数据加载但UI没有正确绑定

## 修复方案

### 1. 任务显示问题（已完成）
- 修改loadUpcomingTasks使用CloudApi.getWeeklyTodos
- 正确处理返回的数据格式

### 2. 物料记录问题
- 检查production-material云函数是否正常返回数据
- 确保数据格式化正确

### 3. 成本精度问题
- 使用toFixed(2)格式化所有成本数字
- 避免浮点数直接相加

### 4. 数据更新问题
- 检查setData是否正确执行
- 确保数据绑定路径正确
