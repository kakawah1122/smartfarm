# AI识别自学习系统说明

## 📚 系统概述

通过用户标记正确数量，不断积累学习案例，提升AI识别准确率。

## 🎯 核心优势

### 1. **快速精准** ⚡
- 简化提示词逻辑，减少token消耗
- 优化输出格式，提高识别速度
- Temperature设为0.1，降低随机性

### 2. **自我学习** 🧠
- 用户标记正确数量
- 系统记录识别偏差
- Few-shot Learning自动改进

### 3. **越用越准** 📈
- 积累相似场景案例
- 动态加载到提示词
- 识别策略自适应调整

## 🔄 工作流程

```
用户拍照 → AI识别 → 显示结果
    ↓
询问是否准确？
    ├─ 准确 → 完成
    └─ 不准确 → 用户输入正确数量
         ↓
    保存学习案例（图片+场景特征+AI结果+正确数量）
         ↓
    下次识别时，加载相似案例到提示词
         ↓
    AI根据案例调整识别策略
         ↓
    准确率提升 ✨
```

## 📊 案例库结构

### 保存的数据
```javascript
{
  imageFileID: "cloud://xxx",        // 图片ID
  aiCount: 25,                       // AI识别数量
  correctCount: 28,                  // 正确数量
  accuracy: 0.89,                    // 准确率 (89%)
  deviation: -3,                     // 偏差（AI偏低3只）
  sceneFeatures: {                   // 场景特征
    lighting: "good",
    crowding: "moderate",
    imageQuality: "good"
  },
  operator: "张三",
  createTime: Date,
  used: false
}
```

## 🚀 使用方法

### 用户端操作

1. **拍照识别**
   - 点击"AI智能盘点"
   - 拍照或选择照片
   - 等待识别结果

2. **修正结果**（可选）
   - 识别完成后，会询问"是否准确？"
   - 如果不准确，点击"修正"
   - 输入实际数量（例如：28）
   - 系统自动保存学习案例

3. **查看改进**
   - 随着使用次数增加
   - 识别准确率会逐步提升
   - 特别是相似场景（光线、密度）

### 系统自动操作

1. **加载学习案例**
   ```
   识别前，系统会：
   - 分析当前场景（光线、密度）
   - 查询相似场景的历史案例（准确率>90%）
   - 将案例加入提示词
   ```

2. **Few-shot Learning**
   ```
   提示词中会加入：
   
   【学习案例参考】
   案例1：moderate密度场景，光线good，AI识别25只，实际28只。教训：识别偏低，可能遗漏个体
   案例2：moderate密度场景，光线excellent，AI识别32只，实际30只。教训：识别偏高，需要更严格
   
   根据这些案例，调整你的识别策略。
   ```

3. **自适应调整**
   - AI会根据历史偏差自动调整
   - 例如：过去识别偏低 → 更注意遮挡区域
   - 例如：过去识别偏高 → 更严格过滤假阳性

## 📈 效果预期

### 短期（1-10次标记）
- 准确率提升：5-10%
- 相似场景效果明显

### 中期（10-50次标记）
- 准确率提升：10-20%
- 覆盖多种场景

### 长期（50+次标记）
- 准确率提升：20-30%
- 接近人工计数水平
- 稳定性显著提高

## 💡 最佳实践

### 1. **多场景标记**
尽量在不同场景下标记：
- 光线：晴天、阴天、傍晚
- 密度：稀疏、中等、密集
- 角度：高处俯视、平视、近距离

### 2. **准确标记**
- 仔细数实际数量
- 不确定时可以多数几遍
- 标记的准确性直接影响学习效果

### 3. **持续使用**
- 每次盘点后都确认或修正
- 积累足够案例（建议30+个）
- 系统会自动选择最相关的案例

## 🔧 技术实现

### 云函数

1. **ai-multi-model** - AI识别核心
   - 简化提示词，提高速度
   - 加载学习案例（Few-shot）
   - 调用千问VL-Max模型

2. **ai-learning-cases** - 学习案例库
   - save_case：保存标记案例
   - get_similar_cases：获取相似案例
   - get_stats：统计学习效果

### 数据表

**ai_learning_cases**
- 存储所有标记案例
- 按场景特征索引
- 支持相似度查询

## 🎓 原理说明

### Few-shot Learning（少样本学习）

与传统模型训练不同，我们使用**提示词工程**实现学习：

**传统方式**（需要大量数据和算力）
```
收集10000+张图片 → 标注 → 训练模型 → 部署
时间：数周-数月
成本：高昂
```

**Few-shot方式**（轻量级、灵活）
```
用户标记几十个案例 → 保存到数据库 → 下次识别时加入提示词
时间：即时生效
成本：极低（只用API）
```

**核心思想**
> 人类学习新事物时，不需要看10000个例子，只需要几个例子就能理解规律。
> 现代大语言模型（如千问）也具备这种能力。

## 📝 数据库索引建议

```javascript
// ai_learning_cases 集合
db.collection('ai_learning_cases').createIndex({
  'sceneFeatures.crowding': 1,
  'accuracy': -1,
  'createTime': -1
})
```

## 🚨 注意事项

1. **隐私保护**
   - 图片存储在用户的云存储空间
   - 不会上传到第三方
   - 案例库仅供自己使用

2. **成本控制**
   - 每次识别会加载2个学习案例
   - token增加约200-300
   - 成本增加可忽略不计

3. **数据清理**
   - 定期清理准确率低的案例（<75%）
   - 保留高质量案例（>90%）
   - 建议保留最近100个案例

## 📚 扩展功能（未来）

1. **团队共享学习**
   - 多个养殖户共享案例库
   - 加速学习速度

2. **场景自动分类**
   - 自动识别场景类型
   - 针对性加载案例

3. **学习报告**
   - 显示AI进步曲线
   - 分析常见错误模式

## 🎉 总结

通过API Key方式实现的**自学习系统**：
- ✅ 快速（简化提示词）
- ✅ 准确（持续学习改进）
- ✅ 灵活（无需重新训练模型）
- ✅ 低成本（仅用API，无训练费用）
- ✅ 即时生效（标记后立即改进）

**一句话概括**：用户每次修正，AI就变得更聪明！🧠✨

