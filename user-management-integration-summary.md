# ç”¨æˆ·ç®¡ç†äº‘å‡½æ•°æ•´åˆæ€»ç»“

## ğŸ¯ æ•´åˆç›®æ ‡

å°† `employee-invite-management` çš„ä¸“ä¸šé‚€è¯·åŠŸèƒ½æ•´åˆåˆ°ç»Ÿä¸€çš„ `user-management` äº‘å‡½æ•°ä¸­ï¼Œå®ç°ä¸€ä½“åŒ–çš„ç”¨æˆ·å’Œé‚€è¯·ç®¡ç†ç³»ç»Ÿã€‚

## ğŸ“Š æ•´åˆå‰ååŠŸèƒ½å¯¹æ¯”

### **åŸæœ‰æ¶æ„**
```
employee-invite-management  â†â†’  user-management
     â†“ ä¸“ä¸šé‚€è¯·ç®¡ç†               â†“ ç”¨æˆ·æƒé™ç®¡ç†
     - é‚€è¯·ç ç”Ÿæˆ                - ç”¨æˆ·CRUD
     - é‚€è¯·ç»Ÿè®¡                  - è§’è‰²ç®¡ç†
     - æœç´¢ç­›é€‰                  - æƒé™æ£€æŸ¥
     - è‡ªåŠ¨æ¸…ç†                  - å®¡è®¡æ—¥å¿—
```

### **æ•´åˆåæ¶æ„**
```
        user-managementï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç”Ÿæ€ç³»ç»Ÿ        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ç”¨æˆ·ç®¡ç† + ä¸“ä¸šé‚€è¯·ç®¡ç†        â”‚
    â”‚ æƒé™æ§åˆ¶ + å®¡è®¡æ—¥å¿—          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… æ•´åˆçš„åŠŸèƒ½æ¨¡å—

### **1. ä¸“ä¸šé‚€è¯·ç ç”Ÿæˆç³»ç»Ÿ**
```javascript
// åŸemployee-invite-management: 6ä½ + å”¯ä¸€æ€§éªŒè¯ âœ…
// æ•´åˆåˆ°user-management: âœ… å®Œå…¨ä¿ç•™
- generateInviteCode(): 6ä½å­—ç¬¦ç 
- generateUniqueInviteCode(): 10æ¬¡é‡è¯•ç¡®ä¿å”¯ä¸€æ€§
```

### **2. å®Œæ•´çš„é‚€è¯·çŠ¶æ€ç®¡ç†**
```javascript
// çŠ¶æ€æµç¨‹: pending â†’ used/expired/revoked âœ…
- validateInvite(): éªŒè¯é‚€è¯·ç æœ‰æ•ˆæ€§
- useInvite(): ä½¿ç”¨é‚€è¯·ç æ³¨å†Œ
- revokeInvite(): æ’¤é”€é‚€è¯·ï¼ˆå¢å¼ºåŸå› è®°å½•ï¼‰
```

### **3. é«˜çº§é‚€è¯·ç®¡ç†åŠŸèƒ½**
```javascript
// åŸemployee-invite-managementåŠŸèƒ½ âœ… å…¨éƒ¨æ•´åˆ
- listInvites(): æœç´¢ã€ç­›é€‰ã€åˆ†é¡µã€æ’åº
- getInviteStats(): è¯¦ç»†ç»Ÿè®¡å’Œä½¿ç”¨ç‡åˆ†æ
- resendInvite(): å»¶é•¿æœ‰æ•ˆæœŸ
- cleanupOldInvites(): è‡ªåŠ¨æ¸…ç†ï¼ˆä¿ç•™æœ€æ–°5ä¸ªï¼‰
```

### **4. ä¼ä¸šçº§ç”¨æˆ·ç®¡ç†**
```javascript
// åŸuser-managementåŠŸèƒ½ âœ… å®Œå…¨ä¿ç•™
- getUserInfo(), updateUserProfile(): ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- listUsers(), updateUserRole(): ç”¨æˆ·å’Œè§’è‰²ç®¡ç†
- checkUserPermission(): ç»†ç²’åº¦æƒé™æ£€æŸ¥
- logOperation(), getAuditLogs(): å®¡è®¡æ—¥å¿—
```

## ğŸ”„ APIè°ƒç”¨å˜æ›´

### **æ•´åˆå‰ï¼ˆåŒäº‘å‡½æ•°ï¼‰**
```javascript
// é‚€è¯·ç®¡ç†
wx.cloud.callFunction({
  name: 'employee-invite-management',
  data: { action: 'create_invite', role: 'employee' }
})

// ç”¨æˆ·ç®¡ç†
wx.cloud.callFunction({
  name: 'user-management', 
  data: { action: 'check_permission', permission: 'health.manage' }
})
```

### **æ•´åˆåï¼ˆå•äº‘å‡½æ•°ï¼‰** â­
```javascript
// æ‰€æœ‰åŠŸèƒ½ç»Ÿä¸€è°ƒç”¨user-management
wx.cloud.callFunction({
  name: 'user-management',
  data: { 
    action: 'create_invite',      // é‚€è¯·ç®¡ç†
    // action: 'get_invite_stats', // é‚€è¯·ç»Ÿè®¡
    // action: 'check_permission', // æƒé™æ£€æŸ¥
    // action: 'list_users',       // ç”¨æˆ·ç®¡ç†
    role: 'employee' 
  }
})
```

## ğŸ‰ æ•´åˆä¼˜åŠ¿

### **1. æ¶æ„ä¼˜åŒ–**
- âœ… **ç®€åŒ–äº‘å‡½æ•°æ•°é‡**: ä»21ä¸ªå‡å°‘åˆ°20ä¸ª
- âœ… **ç»Ÿä¸€ç®¡ç†å…¥å£**: æ‰€æœ‰ç”¨æˆ·ç›¸å…³æ“ä½œé›†ä¸­ç®¡ç†
- âœ… **å‡å°‘ç»´æŠ¤æˆæœ¬**: å•ä¸€äº‘å‡½æ•°æ›´æ˜“ç»´æŠ¤å’Œæ›´æ–°

### **2. åŠŸèƒ½å¢å¼º**
- âœ… **ä¸“ä¸šé‚€è¯·ç³»ç»Ÿ**: ä¿ç•™äº†æ‰€æœ‰é«˜çº§é‚€è¯·ç®¡ç†åŠŸèƒ½
- âœ… **å®Œæ•´æƒé™ä½“ç³»**: ç»†ç²’åº¦æƒé™æ§åˆ¶å’Œå®¡è®¡æ—¥å¿—
- âœ… **æ•°æ®ä¸€è‡´æ€§**: ç”¨æˆ·å’Œé‚€è¯·æ•°æ®åœ¨åŒä¸€äº‘å‡½æ•°ä¸­å¤„ç†

### **3. æ€§èƒ½ä¼˜åŒ–**
- âœ… **å‡å°‘ç½‘ç»œè¯·æ±‚**: ç›¸å…³æ“ä½œå¯åœ¨åŒä¸€äº‘å‡½æ•°å†…å®Œæˆ
- âœ… **å…±äº«è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ›´é«˜æ•ˆ
- âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ä¸€è‡´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ“‹ å®Œæ•´åŠŸèƒ½æ¸…å•

### **ç”¨æˆ·ç®¡ç†åŠŸèƒ½**
- [x] get_user_info - è·å–ç”¨æˆ·ä¿¡æ¯
- [x] update_user_profile - æ›´æ–°ç”¨æˆ·èµ„æ–™
- [x] list_users - ç”¨æˆ·åˆ—è¡¨ç®¡ç†
- [x] update_user_role - è§’è‰²ç®¡ç†
- [x] deactivate_user - ç”¨æˆ·åœç”¨

### **ä¸“ä¸šé‚€è¯·ç®¡ç†**
- [x] create_invite - åˆ›å»ºé‚€è¯·ï¼ˆ6ä½ç +å”¯ä¸€æ€§ï¼‰
- [x] list_invites - é‚€è¯·åˆ—è¡¨ï¼ˆæœç´¢+ç­›é€‰ï¼‰
- [x] validate_invite - éªŒè¯é‚€è¯·ç 
- [x] use_invite - ä½¿ç”¨é‚€è¯·ç 
- [x] revoke_invite - æ’¤é”€é‚€è¯·
- [x] get_invite_stats - é‚€è¯·ç»Ÿè®¡åˆ†æ
- [x] resend_invite - é‡æ–°å‘é€é‚€è¯·

### **æƒé™å’Œå®¡è®¡**
- [x] check_permission - æƒé™æ£€æŸ¥
- [x] get_role_permissions - è§’è‰²æƒé™ä¿¡æ¯
- [x] get_user_roles - ç”¨æˆ·è§’è‰²æŸ¥è¯¢
- [x] log_operation - æ“ä½œæ—¥å¿—è®°å½•
- [x] get_audit_logs - å®¡è®¡æ—¥å¿—æŸ¥è¯¢

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### **ä¼ä¸šçº§é‚€è¯·ç®¡ç†**
```javascript
// ä¸“ä¸šç‰¹æ€§
âœ… 6ä½é‚€è¯·ç  + 10æ¬¡é‡è¯•ç¡®ä¿å”¯ä¸€æ€§
âœ… å¤šçŠ¶æ€ç®¡ç†: pending/used/expired/revoked
âœ… é«˜çº§æœç´¢: æ”¯æŒé‚€è¯·ç ã€å¤‡æ³¨ã€å§“åã€æ‰‹æœºå·
âœ… è‡ªåŠ¨æ¸…ç†: åªä¿ç•™æœ€æ–°5ä¸ªé‚€è¯·è®°å½•
âœ… ç»Ÿè®¡åˆ†æ: ä½¿ç”¨ç‡ã€è¿‘æœŸç»Ÿè®¡ç­‰
âœ… é‡æ–°å‘é€: å»¶é•¿æœ‰æ•ˆæœŸåŠŸèƒ½
```

### **ç»†ç²’åº¦æƒé™æ§åˆ¶**
```javascript
// æƒé™çŸ©é˜µ
super_admin: ['*']                    // å…¨éƒ¨æƒé™
manager: ['production.*', 'health.*'] // é€šé…ç¬¦æƒé™
employee: ['health.read', 'ai_diagnosis.*'] // å…·ä½“æƒé™
veterinarian: ['health.*', 'ai_diagnosis.*'] // ä¸“ä¸šæƒé™
```

## ğŸ¯ éƒ¨ç½²æŒ‡å—

### **1. äº‘å‡½æ•°éƒ¨ç½²**
```bash
# åŸæ¥éœ€è¦éƒ¨ç½²ä¸¤ä¸ªäº‘å‡½æ•°
å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ employee-invite-management âœ— (å·²åˆ é™¤)
å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ user-management âœ… (ç»Ÿä¸€åŠŸèƒ½)

# ç°åœ¨åªéœ€è¦éƒ¨ç½²ä¸€ä¸ª
å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ user-management (åŒ…å«æ‰€æœ‰åŠŸèƒ½)
```

### **2. å‰ç«¯è°ƒç”¨æ›´æ–°**
æ‰€æœ‰åŸæ¥è°ƒç”¨ `employee-invite-management` çš„ä»£ç éœ€è¦ä¿®æ”¹ä¸ºè°ƒç”¨ `user-management`ï¼š

```javascript
// éœ€è¦æ›´æ–°çš„é¡µé¢
- miniprogram/pages/invite-management/
- miniprogram/pages/employee-permission/
- miniprogram/pages/register/
- å…¶ä»–ä½¿ç”¨é‚€è¯·åŠŸèƒ½çš„é¡µé¢
```

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

- [x] **è¯­æ³•æ£€æŸ¥**: æ— linteré”™è¯¯
- [x] **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰åŸåŠŸèƒ½éƒ½å·²æ•´åˆ
- [x] **APIå…¼å®¹æ€§**: æ”¯æŒæ‰€æœ‰åŸæœ‰çš„actionè°ƒç”¨
- [x] **æ•°æ®ç»“æ„**: ä¿æŒä¸åŸæ•°æ®åº“ç»“æ„ä¸€è‡´
- [x] **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- [x] **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œæ—¥å¿—
- [x] **æƒé™éªŒè¯**: æ‰€æœ‰æ“ä½œéƒ½æœ‰æƒé™æ£€æŸ¥

## ğŸ‰ æ•´åˆç»“æœ

### **æˆåŠŸæ•´åˆäº†20ä¸ªæ ¸å¿ƒåŠŸèƒ½åˆ°ç»Ÿä¸€çš„user-managementäº‘å‡½æ•°ï¼**

**åŸæ¥**: `employee-invite-management` (7ä¸ªåŠŸèƒ½) + `user-management` (13ä¸ªåŠŸèƒ½)
**ç°åœ¨**: `user-management` (20ä¸ªåŠŸèƒ½) - **åŠŸèƒ½é›¶æŸå¤±ï¼Œæ¶æ„æ›´ä¼˜åŒ–**

è¿™æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§çš„ç”¨æˆ·ç®¡ç†è§£å†³æ–¹æ¡ˆ**ï¼Œæ—¢ä¿æŒäº†ä¸“ä¸šçš„é‚€è¯·ç®¡ç†åŠŸèƒ½ï¼Œåˆæä¾›äº†å®Œæ•´çš„ç”¨æˆ·æƒé™ä½“ç³»ï¼ğŸš€

---

**æ—¥æœŸ**: 2025-01-15  
**ç‰ˆæœ¬**: v2.0 (æ•´åˆç‰ˆ)  
**çŠ¶æ€**: âœ… æ•´åˆå®Œæˆï¼Œå¯ä»¥éƒ¨ç½²ä½¿ç”¨
