# 🧪 物料管理系统测试指南

## ✅ 已完成的优化：

### 🚀 **移除所有模拟数据**
- ✅ 修复 `purchase-form.ts` - 采购表单使用真实云函数
- ✅ 修复 `material-use-form.ts` - 物料使用表单使用真实云函数  
- ✅ 修复 `inventory-detail.ts` - 库存详情页使用真实数据
- ✅ 修复 `production.ts` - 生产概览使用真实数据

---

## 🧪 **测试流程：**

### 第一步：清空现有数据（可选）
```javascript
// 在微信开发者工具控制台执行
wx.cloud.callFunction({
  name: 'production-material',
  data: { action: 'list_materials' }
}).then(res => {
  console.log('当前物料数据:', res.result.data.materials)
})
```

### 第二步：测试物料采购功能
1. **进入生产管理页面**
2. **点击物料管理Tab**
3. **点击"采购入库"按钮**
4. **填写采购表单：**
   - 物料名称：`优质鹅用饲料`
   - 规格：`25kg/袋`
   - 单位：`袋`
   - 数量：`50`
   - 单价：`45.5`
   - 供应商：`正大饲料公司`
   - 类别：`饲料`
5. **提交表单**
6. **查看成功提示**

### 第三步：测试第二个物料
**填写采购表单：**
- 物料名称：`禽用疫苗`
- 规格：`10ml/支`
- 单位：`支`
- 数量：`100`
- 单价：`15.0`
- 供应商：`兽药公司`
- 类别：`药品`

### 第四步：验证概览显示
1. **回到生产管理页面**
2. **查看物料管理Tab概览：**
   - 饲料库存应显示：约1.25吨（50袋 × 25kg）
   - 药品库存应显示：充足状态

### 第五步：验证详情页面
1. **点击物料管理区域**
2. **进入物料库存详情页面**
3. **应该显示：**
   - 优质鹅用饲料：50袋
   - 禽用疫苗：100支
   - 显示正确的供应商信息

### 第六步：测试物料使用功能
1. **回到生产管理页面**
2. **点击"物料领用"按钮**
3. **选择物料并使用：**
   - 选择：优质鹅用饲料
   - 使用数量：10袋
   - 用途：日常喂养
   - 提交使用申请

### 第七步：验证库存更新
1. **再次查看物料库存详情**
2. **优质鹅用饲料应显示：40袋**（50-10=40）
3. **概览数据应相应更新**

---

## 🔍 **调试命令：**

### 查看所有物料
```javascript
wx.cloud.callFunction({
  name: 'production-material',
  data: { action: 'list_materials' }
}).then(res => console.log('物料列表:', res.result))
```

### 查看概览统计
```javascript
wx.cloud.callFunction({
  name: 'production-dashboard',
  data: { action: 'getOverviewStats' }
}).then(res => console.log('概览统计:', res.result))
```

### 清空所有物料（重新测试时使用）
```javascript
// 先获取所有物料ID
wx.cloud.callFunction({
  name: 'production-material',
  data: { action: 'list_materials' }
}).then(res => {
  const materials = res.result.data.materials
  // 逐个删除
  materials.forEach(material => {
    wx.cloud.callFunction({
      name: 'production-material',
      data: {
        action: 'delete_material',
        materialId: material._id
      }
    }).then(() => console.log('删除完成:', material.name))
  })
})
```

---

## 🎯 **预期结果：**

### ✅ **采购功能**
- 能成功提交采购表单
- 新物料自动添加到库存
- 库存数量正确记录

### ✅ **概览显示**
- 主页面正确显示饲料库存（吨）
- 主页面正确显示药品库存状态
- 数据实时更新

### ✅ **详情页面**
- 显示所有物料的详细信息
- 库存数量、供应商、日期等信息准确
- 支持搜索和筛选功能

### ✅ **使用功能**
- 能选择现有物料进行使用
- 库存数量正确减少
- 概览数据同步更新

---

## 🐛 **可能的问题和解决方案：**

### 问题1：云函数调用失败
**解决方案：** 确保所有云函数都已重新部署

### 问题2：数据不更新
**解决方案：** 检查控制台日志，确认云函数返回的数据格式

### 问题3：概览显示为0
**解决方案：** 确认物料的 `currentStock` 字段有正确的数值

---

## 📞 **测试完成后请反馈：**
1. ✅ 采购功能是否正常？
2. ✅ 概览显示是否正确？  
3. ✅ 详情页面是否显示真实数据？
4. ✅ 物料使用功能是否正常？
5. ✅ 库存更新是否实时？

**现在整个物料管理系统完全使用真实数据，可以正常使用了！** 🎉
