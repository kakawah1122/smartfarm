# ⚡ 立即修复 - API Key配置

## 🎯 问题

```
日志显示：API Key前6位: undefined
错误：401 "令牌已过期或验证不正确"
```

---

## ✅ 解决方案（3步，5分钟）

### 第1步：打开云开发控制台 ☁️

```
微信开发者工具 → 顶部菜单"云开发" → "云开发控制台"
```

---

### 第2步：配置环境变量 🔧

```
左侧菜单：云函数
→ 点击：ai-multi-model
→ 点击标签：函数配置
→ 找到：环境变量
→ 点击：编辑
→ 添加：
   键：GLM4_API_KEY
   值：您的智谱AI API Key（完整的）
→ 点击：保存 ✅
```

**API Key格式示例**：
```
79909699e2a14bcf.xxxxxxxxxxxxxxxxxxxxxx
↑ 数字开头，包含点号
```

---

### 第3步：重新上传云函数 📤

```
右键 cloudfunctions/ai-multi-model
→ "上传并部署：云端安装依赖"
→ 等待完成
→ 等待2分钟（配置生效）
→ 测试 ✅
```

---

## 🔍 如何验证成功

**重新测试后查看日志**：

**成功**：
```
====== 调用智谱AI ======
API Key前6位: 799096  ← 显示数字 ✅
模型: glm-4v-flash
图片处理完成
API调用成功
```

**失败**：
```
API Key前6位: undefined  ← 还是undefined
```

如果还是失败：
1. 检查环境变量名称是否完全一致：`GLM4_API_KEY`（大小写敏感）
2. 检查API Key是否完整复制
3. 确认已重新上传云函数

---

## 💡 其他API Key（可选）

**如果需要更高成功率，也配置这个**：

```
键：siliconflow_API_KEY
值：您的SiliconFlow API Key
```

这样如果智谱AI失败，会自动切换到SiliconFlow备选模型。

---

## 📝 快速检查清单

- [ ] 打开云开发控制台
- [ ] ai-multi-model → 函数配置 → 环境变量
- [ ] 添加 `GLM4_API_KEY`
- [ ] API Key完整复制（包含点号）
- [ ] 保存
- [ ] 重新上传 ai-multi-model
- [ ] 等待2分钟
- [ ] 测试

---

**现在就去配置吧！** 🚀

5分钟搞定！

