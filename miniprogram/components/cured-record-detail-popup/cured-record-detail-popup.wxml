<!-- æ²»æ„ˆè®°å½•è¯¦æƒ…å¼¹çª—ç»„ä»¶ -->
<bottom-popup
  visible="{{visible}}"
  title="æ²»ç–—è¯¦æƒ…"
  show-close="{{true}}"
  show-actions="{{true}}"
  confirm-text="ç¡®å®š"
  bind:close="onClose"
  bind:confirm="onClose"
  bind:visiblechange="onVisibleChange"
>
  <view wx:if="{{record}}" class="record-detail-content">
    <!-- è¯Šæ–­ä¿¡æ¯ -->
    <view class="detail-section">
      <view class="section-title">è¯Šæ–­ä¿¡æ¯</view>
      <view class="info-card">
        <view class="info-row" wx:if="{{record.treatmentNumber}}">
          <text class="info-label">æ²»ç–—ç¼–å·ï¼š</text>
          <text class="info-value">{{record.treatmentNumber}}</text>
        </view>
        <view class="divider-line"></view>
        <view class="info-row">
          <text class="info-label">è¯Šæ–­ç»“æœï¼š</text>
          <text class="info-value">{{record.diagnosis.confirmed || record.diagnosis.preliminary}}</text>
        </view>
        <view class="divider-line"></view>
        <view class="info-row">
          <text class="info-label">é¹…ç¾¤æ‰¹æ¬¡ï¼š</text>
          <text class="info-value">{{record.batchNumber || record.batchId}}</text>
        </view>
        <view class="divider-line"></view>
        <view class="info-row">
          <text class="info-label">æ²»ç–—ç±»å‹ï¼š</text>
          <text class="info-value">{{record.treatmentType === 'medication' ? 'è¯ç‰©æ²»ç–—' : 'è§‚å¯Ÿè®°å½•'}}</text>
        </view>
        <view class="divider-line"></view>
        <view class="info-row">
          <text class="info-label">æ²»ç–—æ—¥æœŸï¼š</text>
          <text class="info-value">{{record.treatmentDate}}</text>
        </view>
      </view>
    </view>

    <!-- æ²»æ„ˆç»“æœ -->
    <view class="detail-section">
      <view class="section-title">æ²»æ„ˆç»“æœ</view>
      <view class="cure-summary">
        <view class="cure-stat-item primary">
          <text class="stat-label">æ²»æ„ˆæ•°é‡</text>
          <text class="stat-value">{{record.outcome.curedCount}} åª</text>
        </view>
        <view class="cure-stat-item" wx:if="{{record.outcome.totalTreated > record.outcome.curedCount}}">
          <text class="stat-label">æ€»æ²»ç–—æ•°</text>
          <text class="stat-value">{{record.outcome.totalTreated}} åª</text>
        </view>
      </view>
    </view>

    <!-- æ²»æ„ˆæˆæœ¬ -->
    <view class="detail-section">
      <view class="section-title">æ²»æ„ˆæˆæœ¬</view>
      <view class="cost-grid">
        <view class="cost-item">
          <text class="cost-label">æ²»æ„ˆæ€»æˆæœ¬</text>
          <text class="cost-value primary">Â¥{{record.formattedCuredCost}}</text>
        </view>
        <view class="cost-item" wx:if="{{record.formattedMedicationCost > 0}}">
          <text class="cost-label">è¯ç‰©æˆæœ¬</text>
          <text class="cost-value">Â¥{{record.formattedMedicationCost}}</text>
        </view>
        <view class="cost-item">
          <text class="cost-label">å•åªæˆæœ¬</text>
          <text class="cost-value">Â¥{{record.formattedCostPerAnimal}}</text>
        </view>
      </view>
    </view>

    <!-- æ²»ç–—æ–¹æ¡ˆ -->
    <view class="detail-section" wx:if="{{record.treatmentPlan.primary}}">
      <view class="section-title">æ²»ç–—æ–¹æ¡ˆ</view>
      <view class="plan-card">
        <text class="plan-text">{{record.treatmentPlan.primary}}</text>
      </view>
    </view>

    <!-- ç”¨è¯è®°å½• -->
    <view class="detail-section" wx:if="{{record.medications && record.medications.length > 0}}">
      <view class="section-title">ç”¨è¯è®°å½•</view>
      <view class="medication-list">
        <view class="medication-item" wx:for="{{record.medications}}" wx:key="index">
          <view class="med-icon">ğŸ’Š</view>
          <view class="med-info">
            <text class="med-name">{{item.name}}</text>
            <text class="med-spec">{{item.quantity}}{{item.unit}}</text>
            <text class="med-dosage" wx:if="{{item.dosage}}">{{item.dosage}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</bottom-popup>

