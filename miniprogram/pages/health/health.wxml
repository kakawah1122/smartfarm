<!--health.wxml-->
<view class="page-container">
  <!-- æ–°å¼å¯¼èˆªæ  -->
  <navigation-bar 
    title="å¥åº·ç®¡ç†"
    show-back="{{true}}"
    show-menu="{{true}}"
    show-record="{{false}}"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <!-- Tab åˆ‡æ¢ -->
  <t-tabs value="{{activeTab}}" bind:change="onTabChange" theme="line" class="health-tabs">
    <t-tab-panel value="record" label="å¥åº·è®°å½•"></t-tab-panel>
    <t-tab-panel value="vaccine" label="ç–«è‹—ç®¡ç†"></t-tab-panel>
    <t-tab-panel value="ai" label="AIè¯Šç–—"></t-tab-panel>
  </t-tabs>

  <scroll-view class="scroll-container" scroll-y style="padding-top: {{totalNavHeight + 120}}rpx;">
    <!-- å¥åº·è®°å½• -->
    <view wx:if="{{activeTab === 'record'}}" class="tab-content">
      <!-- å¥åº·æ¦‚è§ˆ -->
      <view class="stats-section">
        <view class="card-header">
          <text class="card-title">ğŸ¥ é¹…ç¾¤å¥åº·æ¦‚è§ˆ</text>
        </view>
        <t-grid column="3" theme="card" class="health-stats">
          <t-grid-item>
            <view class="stat-item stat-success">
              <view class="stat-icon">âœ…</view>
              <view class="stat-value">{{healthStats.healthRate}}%</view>
              <view class="stat-label">å¥åº·ç‡</view>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="stat-item stat-warning">
              <view class="stat-icon">âš ï¸</view>
              <view class="stat-value">{{healthStats.abnormal}}</view>
              <view class="stat-label">å¼‚å¸¸ä¸ªä½“</view>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="stat-item stat-primary">
              <view class="stat-icon">ğŸ“‹</view>
              <view class="stat-value">{{healthStats.records}}</view>
              <view class="stat-label">æœ¬æœˆè®°å½•</view>
            </view>
          </t-grid-item>
        </t-grid>
      </view>

      <!-- æ·»åŠ æŒ‰é’® -->
      <view class="action-section">
        <t-button theme="primary" size="large" block icon="add" bind:tap="addHealthRecord">
          æ–°å¢å¥åº·è®°å½•
        </t-button>
      </view>

      <!-- å¥åº·è®°å½•åˆ—è¡¨ -->
      <view class="list-section">
        <view class="card list-card">
          <view class="card-header">
            <text class="card-title">æœ€è¿‘å¥åº·è®°å½•</text>
          </view>
          <t-cell-group>
            <t-cell wx:for="{{healthRecords}}" wx:key="id" 
                    bind:click="viewHealthRecord" 
                    data-item="{{item}}"
                    title="{{item.location}}"
                    description="{{item.symptoms}}"
                    note="{{item.date}} {{item.time}} â€¢ {{item.operator}}"
                    left-icon="{{item.statusIcon}}"
                    arrow>
              <view slot="right" class="record-meta">
                <t-tag theme="{{item.severity}}" size="small">{{item.priorityText}}</t-tag>
                <text class="record-status">{{item.status}}</text>
              </view>
              <view slot="note" class="record-info">
                <text class="record-date">{{item.date}} {{item.time}} â€¢ {{item.operator}}</text>
                <text class="treatment-text">{{item.treatment}}</text>
              </view>
            </t-cell>
          </t-cell-group>
        </view>
      </view>
    </view>

    <!-- ç–«è‹—ç®¡ç† -->
    <view wx:if="{{activeTab === 'vaccine'}}" class="tab-content">
      <!-- ç–«è‹—æé†’ -->
      <view class="reminder-section">
        <view class="card">
          <view class="card-header">
            <text class="card-title">â° ç–«è‹—æ¥ç§æé†’</text>
          </view>
          <t-notice-bar theme="warning" content="æœ‰{{vaccineReminders.length}}é¡¹ç–«è‹—è®¡åˆ’å³å°†åˆ°æœŸ" />
          <view class="reminder-list">
            <t-cell-group style="margin-top: 24rpx;">
              <t-cell wx:for="{{vaccineReminders}}" wx:key="id"
                      left-icon="ğŸ’‰"
                      title="{{item.name}} - {{item.location}}"
                      description="é¢„è®¡æ¥ç§æ—¶é—´ï¼š{{item.scheduledDate}}"
                      arrow />
            </t-cell-group>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-section">
        <t-row gutter="24">
          <t-col span="12">
            <t-button theme="primary" block size="large" icon="add" bind:tap="addVaccinePlan">
              æ·»åŠ ç–«è‹—è®¡åˆ’
            </t-button>
          </t-col>
          <t-col span="12">
            <t-button theme="success" block size="large" icon="check" bind:tap="recordVaccination">
              è®°å½•æ¥ç§
            </t-button>
          </t-col>
        </t-row>
      </view>

      <!-- ç–«è‹—è®°å½• -->
      <view class="list-section">
        <view class="card list-card">
          <view class="card-header">
            <text class="card-title">ç–«è‹—æ¥ç§è®°å½•</text>
          </view>
          <t-cell-group>
            <t-cell wx:for="{{vaccineRecords}}" wx:key="id"
                    bind:click="viewVaccineRecord"
                    data-item="{{item}}"
                    left-icon="ğŸ’‰"
                    title="{{item.name}}"
                    description="{{item.location}} â€¢ {{item.quantity}}åªé¹…"
                    note="{{item.date}} â€¢ {{item.operator}}"
                    arrow>
              <view slot="right" class="vaccine-status">
                <t-tag theme="{{item.status === 'å·²å®Œæˆ' ? 'success' : 'primary'}}" size="small">{{item.status}}</t-tag>
                <text class="next-date">{{item.nextDate ? 'ä¸‹æ¬¡ï¼š' + item.nextDate : 'è®¡åˆ’ï¼š' + item.plannedDate}}</text>
              </view>
            </t-cell>
          </t-cell-group>
        </view>
      </view>
    </view>

    <!-- AIè¯Šç–— -->
    <view wx:if="{{activeTab === 'ai'}}" class="tab-content">
      <!-- AIåŠ©æ‰‹ä»‹ç» -->
      <view class="intro-section">
        <view class="card">
          <view class="card-header">
            <text class="card-title">ğŸ¤– AIæ™ºèƒ½è¯Šç–—åŠ©æ‰‹</text>
            <text class="card-subtitle">ä¸“ä¸šçš„é¹…ç—…è¯Šæ–­ä¸æ²»ç–—å»ºè®®</text>
          </view>
          <t-notice-bar theme="warning" content="âš ï¸ é‡è¦æé†’ï¼šAIå»ºè®®ä»…ä¾›å‚è€ƒï¼Œè¯·ç»“åˆä¸“ä¸šå…½åŒ»è¯Šæ–­è¿›è¡Œæ²»ç–—å†³ç­–" />
        </view>
      </view>

      <!-- ç—‡çŠ¶è¾“å…¥ -->
      <view class="input-section">
        <view class="card">
          <view class="card-header">
            <text class="card-title">ç—‡çŠ¶æè¿°</text>
          </view>
          <t-textarea placeholder="è¯·è¯¦ç»†æè¿°é¹…ç¾¤ç—‡çŠ¶ï¼Œå¦‚ï¼šç²¾ç¥çŠ¶æ€ã€é£Ÿæ¬²æƒ…å†µã€æ’ä¾¿çŠ¶å†µã€ä½“æ¸©å˜åŒ–ç­‰..." 
                      value="{{symptomInput}}" 
                      bind:change="onSymptomInput"
                      maxlength="500"
                      autosize />
          <view class="symptom-tags">
            <t-tag wx:for="{{commonSymptoms}}" wx:key="id" 
                   theme="{{item.selected ? 'primary' : 'light'}}" 
                   size="small" 
                   bind:tap="toggleSymptom" 
                   data-id="{{item.id}}">
              {{item.name}}
            </t-tag>
          </view>
          <t-button theme="primary" size="large" block bind:tap="getAIAdvice" disabled="{{!symptomInput}}" style="margin-top: 24rpx;">
            è·å–AIå»ºè®®
          </t-button>
        </view>
      </view>

      <!-- AIå»ºè®®ç»“æœ -->
      <view wx:if="{{aiAdvice}}" class="advice-section">
        <view class="card">
          <view class="card-header">
            <text class="card-title">AIè¯Šç–—å»ºè®®</text>
          </view>
          <t-cell-group>
            <t-cell title="åˆæ­¥è¯Šæ–­" description="{{aiAdvice.diagnosis}}" left-icon="ğŸ”" />
            <t-cell title="å»ºè®®æªæ–½" left-icon="ğŸ’Š">
              <view slot="description" class="treatment-list">
                <text wx:for="{{aiAdvice.treatments}}" wx:key="index" class="treatment-item">
                  {{index + 1}}. {{item}}
                </text>
              </view>
            </t-cell>
          </t-cell-group>
          <view class="advice-actions">
            <t-button theme="success" size="small" bind:tap="adoptAdvice">é‡‡çº³å»ºè®®</t-button>
            <t-button theme="light" size="small" bind:tap="saveAdvice">ä¿å­˜è®°å½•</t-button>
          </view>
        </view>
      </view>

      <!-- å†å²å’¨è¯¢è®°å½• -->
      <view class="history-section">
        <view class="card list-card">
          <view class="card-header">
            <text class="card-title">å†å²å’¨è¯¢è®°å½•</text>
          </view>
          <t-cell-group>
            <t-cell wx:for="{{consultationHistory}}" wx:key="id"
                    bind:click="viewConsultation"
                    data-item="{{item}}"
                    left-icon="ğŸ’¬"
                    title="ç—‡çŠ¶å’¨è¯¢"
                    description="{{item.symptoms}}"
                    note="{{item.date}}"
                    arrow>
              <view slot="right" class="consultation-status">
                <t-tag theme="{{item.adopted ? 'success' : 'primary'}}" size="small">
                  {{item.adopted ? 'å·²é‡‡çº³' : 'å¤„ç†ä¸­'}}
                </t-tag>
              </view>
              <view slot="note" class="consultation-detail">
                <text class="question">{{item.symptoms}}</text>
                <view class="ai-response">
                  <text class="diagnosis">ğŸ¤– è¯Šæ–­ï¼š{{item.diagnosis}}</text>
                  <text class="treatment">å»ºè®®ï¼š{{item.mainTreatment}}</text>
                </view>
              </view>
            </t-cell>
          </t-cell-group>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view style="height: 120rpx;"></view>
  </scroll-view>
</view>