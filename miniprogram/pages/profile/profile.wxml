<!--profile.wxml-->
<view class="page-container">
  <!-- æ–°å¼å¯¼èˆªæ  -->
  <navigation-bar 
    title="ä¸ªäººä¸­å¿ƒ"
    show-back="{{true}}"
    show-menu="{{true}}"
    show-record="{{false}}"
    bind:back="goBack"
    bind:menu="onSettingsTap"
  />
  
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-section">
    <view class="user-card">
      <view class="user-info">
        <view class="user-avatar">ğŸ‘¤</view>
        <view class="user-details">
          <text class="user-name">{{userInfo.name}}</text>
          <text class="user-role">{{userInfo.role}} â€¢ {{userInfo.farm}}</text>
        </view>
      </view>
      <t-grid column="3" class="user-stats">
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value">{{userInfo.experience}}</text>
            <text class="stat-label">ç®¡ç†å¹´é™</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value">{{userInfo.currentStock}}</text>
            <text class="stat-label">å½“å‰å­˜æ </text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value">{{userInfo.healthRate}}%</text>
            <text class="stat-label">å¥åº·ç‡</text>
          </view>
        </t-grid-item>
      </t-grid>
    </view>
  </view>

  <scroll-view class="scroll-container" scroll-y style="padding-top: {{totalNavHeight + 240}}rpx;">
    <!-- è´¢åŠ¡æ¦‚è§ˆ -->
    <view class="card finance-overview">
      <view class="card-header">
        <text class="card-title">ğŸ’° æœ¬æœˆè´¢åŠ¡æ¦‚è§ˆ</text>
        <text class="view-detail" bind:tap="viewFinanceDetail">è¯¦ç»†æŠ¥è¡¨</text>
      </view>
      <t-grid column="3" class="finance-stats">
        <t-grid-item>
          <view class="finance-item success">
            <text class="finance-label">æ€»æ”¶å…¥</text>
            <text class="finance-value">Â¥{{financeOverview.income}}ä¸‡</text>
            <text class="finance-trend up">â†‘ +{{financeOverview.incomeGrowth}}%</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="finance-item danger">
            <text class="finance-label">æ€»æ”¯å‡º</text>
            <text class="finance-value">Â¥{{financeOverview.expense}}ä¸‡</text>
            <text class="finance-trend up">â†‘ +{{financeOverview.expenseGrowth}}%</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="finance-item primary">
            <text class="finance-label">å‡€åˆ©æ¶¦</text>
            <text class="finance-value">Â¥{{financeOverview.profit}}ä¸‡</text>
            <text class="finance-trend up">â†‘ +{{financeOverview.profitGrowth}}%</text>
          </view>
        </t-grid-item>
      </t-grid>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="card menu-card">
      <view class="card-header">
        <text class="card-title">åŠŸèƒ½èœå•</text>
      </view>
      <t-cell-group>
        <t-cell 
          wx:for="{{menuItems}}" 
          wx:key="id"
          title="{{item.title}}" 
          description="{{item.description}}" 
          left-icon="{{item.icon}}"
          arrow
          bind:click="navigateToMenu"
          data-item="{{item}}">
          <view wx:if="{{item.badge}}" slot="right" class="menu-badge">
            <t-tag theme="danger" size="small">{{item.badge}}</t-tag>
          </view>
        </t-cell>
      </t-cell-group>
    </view>

    <!-- å¾…å¤„ç†äº‹é¡¹ -->
    <view class="card pending-card">
      <view class="card-header">
        <text class="card-title">å¾…å¤„ç†äº‹é¡¹</text>
      </view>
      <t-cell-group>
        <t-cell 
          wx:for="{{pendingItems}}" 
          wx:key="id"
          title="{{item.title}}"
          description="{{item.description}}"
          left-icon="{{item.priority === 'danger' ? 'ğŸš¨' : (item.priority === 'warning' ? 'âš ï¸' : 'â„¹ï¸')}}"
          arrow
          bind:click="handlePendingItem"
          data-item="{{item}}">
          <view slot="right">
            <t-tag theme="{{item.priority}}" size="small">{{item.status}}</t-tag>
          </view>
        </t-cell>
      </t-cell-group>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <view class="card stats-card">
      <view class="card-header">
        <text class="card-title">ğŸ“Š å…»æ®–åœºæ•°æ®ç»Ÿè®¡</text>
      </view>
      <t-grid column="2" class="stats-grid">
        <t-grid-item>
          <view class="stat-card blue">
            <view class="stat-header">
              <text class="stat-label">æ€»å­˜æ é‡</text>
              <text class="stat-icon">ğŸ“ˆ</text>
            </view>
            <text class="stat-number">{{farmStats.totalStock}}</text>
            <text class="stat-change">è¾ƒä¸Šæœˆ +{{farmStats.stockChange}}</text>
          </view>
        </t-grid-item>
        
        <t-grid-item>
          <view class="stat-card green">
            <view class="stat-header">
              <text class="stat-label">æˆæ´»ç‡</text>
              <text class="stat-icon">âœ…</text>
            </view>
            <text class="stat-number">{{farmStats.survivalRate}}%</text>
            <text class="stat-change">ä¿æŒç¨³å®š</text>
          </view>
        </t-grid-item>
        
        <t-grid-item>
          <view class="stat-card orange">
            <view class="stat-header">
              <text class="stat-label">å‘˜å·¥æ•°é‡</text>
              <text class="stat-icon">ğŸ‘¥</text>
            </view>
            <text class="stat-number">{{farmStats.staffCount}}</text>
            <text class="stat-change">ç®¡ç†å‘˜{{farmStats.adminCount}} å‘˜å·¥{{farmStats.employeeCount}}</text>
          </view>
        </t-grid-item>
        
        <t-grid-item>
          <view class="stat-card purple">
            <view class="stat-header">
              <text class="stat-label">æœ¬æœˆåˆ©æ¶¦</text>
              <text class="stat-icon">ğŸ’°</text>
            </view>
            <text class="stat-number">Â¥{{farmStats.monthlyProfit}}ä¸‡</text>
            <text class="stat-change">è¾ƒä¸Šæœˆ +{{farmStats.profitGrowth}}%</text>
          </view>
        </t-grid-item>
      </t-grid>
    </view>

    <!-- å…¶ä»–è®¾ç½® -->
    <view class="card settings-card">
      <t-cell-group>
        <t-cell title="ä¸ªäººä¿¡æ¯" left-icon="user" arrow bind:click="editProfile" />
        <t-cell title="æ¶ˆæ¯é€šçŸ¥" left-icon="notification" arrow bind:click="notificationSettings" />
        <t-cell title="éšç§è®¾ç½®" left-icon="lock" arrow bind:click="privacySettings" />
        <t-cell title="å¸®åŠ©ä¸åé¦ˆ" left-icon="help-circle" arrow bind:click="helpAndFeedback" />
        <t-cell title="å…³äºæˆ‘ä»¬" left-icon="info-circle" arrow bind:click="aboutUs" />
      </t-cell-group>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
      <t-button theme="danger" size="large" block bind:tap="logout">é€€å‡ºç™»å½•</t-button>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view style="height: 120rpx;"></view>
  </scroll-view>
</view>
