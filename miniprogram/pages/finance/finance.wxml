<view class="page-container">
  <!-- æ–°å¼å¯¼èˆªæ  -->
  <navigation-bar 
    title="è´¢åŠ¡ç®¡ç†"
    show-back="{{true}}"
    show-menu="{{true}}"
    show-record="{{false}}"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <scroll-view class="scroll-container" scroll-y>
    <!-- è´¢åŠ¡æ¦‚è§ˆå¡ç‰‡ -->
    <view class="card overview-card">
      <view class="card-content">
        <view class="overview-header">
          <text class="overview-title">æœ¬æœˆè´¢åŠ¡æ¦‚è§ˆ</text>
          <t-dropdown-menu bind:change="onMonthChange">
            <t-dropdown-item 
              value="{{selectedMonth}}" 
              options="{{monthOptions}}" 
              label="{{selectedMonth}}"
            />
          </t-dropdown-menu>
        </view>
        
        <!-- æ”¶æ”¯å¯¹æ¯” -->
        <view class="comparison-section">
          <view class="comparison-header">
            <text class="comparison-label">æ”¶æ”¯å¯¹æ¯”</text>
            <text class="growth-rate">+{{overview.growthRate}}% â†—</text>
          </view>
          <view class="comparison-data">
            <view class="data-item">
              <text class="data-value success">Â¥{{overview.income}}ä¸‡</text>
              <text class="data-label">æ€»æ”¶å…¥</text>
            </view>
            <view class="data-item">
              <text class="data-value danger">Â¥{{overview.expense}}ä¸‡</text>
              <text class="data-label">æ€»æ”¯å‡º</text>
            </view>
            <view class="data-item">
              <text class="data-value primary">Â¥{{overview.profit}}ä¸‡</text>
              <text class="data-label">å‡€åˆ©æ¶¦</text>
            </view>
          </view>
        </view>

        <!-- æˆæœ¬æ„æˆ -->
        <view class="cost-grid">
          <view class="cost-item orange">
            <text class="cost-label">é¥²æ–™æˆæœ¬</text>
            <text class="cost-value">Â¥{{overview.feedCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.feedPercent}}%</text>
          </view>
          <view class="cost-item purple">
            <text class="cost-label">äººå·¥æˆæœ¬</text>
            <text class="cost-value">Â¥{{overview.laborCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.laborPercent}}%</text>
          </view>
          <view class="cost-item yellow">
            <text class="cost-label">åŒ»ç–—è´¹ç”¨</text>
            <text class="cost-value">Â¥{{overview.medicalCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.medicalPercent}}%</text>
          </view>
          <view class="cost-item gray">
            <text class="cost-label">å…¶ä»–è´¹ç”¨</text>
            <text class="cost-value">Â¥{{overview.otherCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.otherPercent}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- AIæ™ºèƒ½å»ºè®® -->
    <view class="card ai-card">
      <view class="card-content">
        <view class="ai-header">
          <view class="ai-icon">
            <text>ğŸ¤–</text>
          </view>
          <view class="ai-info">
            <text class="ai-title">AIæ™ºèƒ½å»ºè®®</text>
            <text class="ai-subtitle">åŸºäºè´¢åŠ¡æ•°æ®çš„å…»æ®–ä¼˜åŒ–å»ºè®®</text>
          </view>
        </view>
        
        <view class="ai-content">
          <view class="suggestion-item" wx:for="{{aiSuggestions}}" wx:key="id">
            <view class="suggestion-icon {{item.type}}">
              <text>{{item.icon}}</text>
            </view>
            <view class="suggestion-content">
              <text class="suggestion-title">{{item.title}}</text>
              <text class="suggestion-desc">{{item.description}}</text>
            </view>
          </view>
          
          <t-button theme="primary" size="medium" block bind:tap="getDetailedReport">
            è·å–è¯¦ç»†åˆ†ææŠ¥å‘Š
          </t-button>
        </view>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢ -->
    <t-tabs value="{{activeTab}}" bind:change="onTabChange" theme="line" class="finance-tabs">
      <t-tab-panel label="æ”¶æ”¯æ˜ç»†" value="records" />
      <t-tab-panel label="è´¢åŠ¡æŠ¥è¡¨" value="reports" />
      <t-tab-panel label="å®¡æ‰¹ç®¡ç†" value="approval" />
    </t-tabs>

    <!-- æ”¶æ”¯æ˜ç»†é¡µé¢ -->
    <view wx:if="{{activeTab === 'records'}}" class="tab-content">
      <!-- ç­›é€‰æ¡ä»¶ -->
      <view class="filter-section">
        <t-row gutter="24">
          <t-col span="12">
            <t-dropdown-menu bind:change="onTypeFilterChange">
              <t-dropdown-item 
                value="{{filters.type}}" 
                options="{{typeOptions}}" 
                label="{{filters.type}}"
              />
            </t-dropdown-menu>
          </t-col>
          <t-col span="12">
            <t-dropdown-menu bind:change="onPeriodFilterChange">
              <t-dropdown-item 
                value="{{filters.period}}" 
                options="{{periodOptions}}" 
                label="{{filters.period}}"
              />
            </t-dropdown-menu>
          </t-col>
        </t-row>
      </view>

      <!-- äº¤æ˜“è®°å½• -->
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">æœ€è¿‘äº¤æ˜“è®°å½•</text>
          </view>
          <t-cell-group class="records-list">
            <t-cell 
              wx:for="{{filteredRecords}}" 
              wx:key="id"
              title="{{item.title}}"
              description="{{item.description}}"
              note="{{item.date}}"
              left-icon="{{item.icon}}"
              arrow
              bind:click="viewRecordDetail"
              data-item="{{item}}"
            >
              <view slot="right" class="record-amount">
                <text class="amount-value {{item.type}}">{{item.type === 'income' ? '+' : '-'}}Â¥{{item.amount}}</text>
                <text class="amount-type">{{item.autoGenerated ? 'è‡ªåŠ¨ç”Ÿæˆ' : 'æ‰‹åŠ¨å½•å…¥'}}</text>
              </view>
              <view slot="note" class="record-meta">
                <text class="record-time">{{item.date}}</text>
                <t-tag theme="{{item.statusTheme}}" size="small">{{item.status}}</t-tag>
              </view>
            </t-cell>
          </t-cell-group>
        </view>
      </view>
    </view>

    <!-- è´¢åŠ¡æŠ¥è¡¨é¡µé¢ -->
    <view wx:if="{{activeTab === 'reports'}}" class="tab-content">
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">è´¢åŠ¡æŠ¥è¡¨</text>
          </view>
          
          <!-- è¶‹åŠ¿å›¾å ä½ -->
          <view class="chart-section">
            <text class="chart-header">æ”¶æ”¯è¶‹åŠ¿å›¾</text>
            <view class="chart-placeholder">
              <text class="chart-text">ğŸ“Š å›¾è¡¨å ä½åŒºåŸŸ</text>
            </view>
          </view>

          <!-- åŒæ¯”åˆ†æ -->
          <view class="analysis-grid">
            <view class="analysis-item success">
              <text class="analysis-title">åŒæ¯”å¢é•¿</text>
              <text class="analysis-value">+{{reports.yearGrowth}}%</text>
              <text class="analysis-desc">è¾ƒå»å¹´åŒæœŸ</text>
            </view>
            <view class="analysis-item primary">
              <text class="analysis-title">åˆ©æ¶¦ç‡</text>
              <text class="analysis-value">{{reports.profitRate}}%</text>
              <text class="analysis-desc">è¾ƒä¸Šæœˆæå‡</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®¡æ‰¹ç®¡ç†é¡µé¢ -->
    <view wx:if="{{activeTab === 'approval'}}" class="tab-content">
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">å¾…å®¡æ‰¹äº‹é¡¹</text>
          </view>
          
          <t-swipe-cell-group class="approval-list">
            <t-swipe-cell 
              wx:for="{{approvalItems}}" 
              wx:key="id"
              right="{{[{text: 'æ‹’ç»', theme: 'danger'}, {text: 'é€šè¿‡', theme: 'success'}]}}"
              bind:action="onApprovalAction"
              data-item="{{item}}"
            >
              <t-cell 
                title="{{item.applicant}} - {{item.title}}"
                description="{{item.description}}"
                note="æäº¤æ—¶é—´ï¼š{{item.submitTime}}"
                left-icon="{{item.icon}}"
              >
                <view slot="right" class="approval-amount">
                  <text>Â¥{{item.amount}}</text>
                </view>
              </t-cell>
            </t-swipe-cell>
          </t-swipe-cell-group>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="card">
      <view class="card-content">
        <view class="card-header">
          <text class="card-title">å¿«æ·æ“ä½œ</text>
        </view>
        <t-row gutter="24" class="actions-grid">
          <t-col span="12">
            <t-button theme="primary" block size="large" icon="add" bind:tap="addManualRecord">
              æ‰‹åŠ¨è®°è´¦
            </t-button>
          </t-col>
          <t-col span="12">
            <t-button theme="light" block size="large" icon="download" bind:tap="exportReport">
              å¯¼å‡ºæŠ¥è¡¨
            </t-button>
          </t-col>
        </t-row>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view style="height: 120rpx;"></view>
  </scroll-view>
</view>
