"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// finance.ts
const navigation_1 = require("../../utils/navigation");
const pageConfig = {
    data: {
        selectedMonth: '2024å¹´3æœˆ',
        monthOptions: [
            { label: '2024å¹´3æœˆ', value: '2024å¹´3æœˆ' },
            { label: '2024å¹´2æœˆ', value: '2024å¹´2æœˆ' },
            { label: '2024å¹´1æœˆ', value: '2024å¹´1æœˆ' }
        ],
        activeTab: 'records',
        // è´¢åŠ¡æ¦‚è§ˆ
        overview: {
            income: '21.2',
            expense: '16.8',
            profit: '4.4',
            growthRate: '32.1',
            feedCost: '8.2',
            feedPercent: '48.8',
            laborCost: '4.5',
            laborPercent: '26.8',
            medicalCost: '2.1',
            medicalPercent: '12.5',
            otherCost: '2.0',
            otherPercent: '11.9'
        },
        // AIå»ºè®®
        aiSuggestions: [
            {
                id: 1,
                type: 'success',
                icon: 'âœ…',
                title: 'å¸‚åœºæœºä¼š',
                description: 'å½“å‰é¹…ä»·å¤„äºä¸Šå‡æœŸï¼Œå»ºè®®é€‚é‡å¢åŠ å‡ºæ é‡ï¼Œé¢„è®¡å¯å¢æ”¶15%'
            },
            {
                id: 2,
                type: 'warning',
                icon: 'âš ï¸',
                title: 'æˆæœ¬æ§åˆ¶',
                description: 'é¥²æ–™æˆæœ¬åé«˜ï¼Œå»ºè®®æ›´æ¢XXå“ç‰Œé¥²æ–™ï¼Œé¢„è®¡å¯èŠ‚çœæˆæœ¬8%'
            },
            {
                id: 3,
                type: 'primary',
                icon: 'ğŸ’¡',
                title: 'æŠ•èµ„å»ºè®®',
                description: 'é¹…è‹—ä»·æ ¼ä¸‹é™ï¼Œå»ºè®®é€‚å½“è¡¥æ ï¼ŒæŠ•èµ„å›æŠ¥ç‡é¢„è®¡è¾¾25%'
            }
        ],
        // ç­›é€‰æ¡ä»¶
        filters: {
            type: 'å…¨éƒ¨ç±»å‹',
            period: 'æœ€è¿‘7å¤©'
        },
        typeOptions: [
            { label: 'å…¨éƒ¨ç±»å‹', value: 'å…¨éƒ¨ç±»å‹' },
            { label: 'æ”¶å…¥', value: 'æ”¶å…¥' },
            { label: 'æ”¯å‡º', value: 'æ”¯å‡º' }
        ],
        periodOptions: [
            { label: 'æœ€è¿‘7å¤©', value: 'æœ€è¿‘7å¤©' },
            { label: 'æœ€è¿‘30å¤©', value: 'æœ€è¿‘30å¤©' },
            { label: 'æœ¬æœˆ', value: 'æœ¬æœˆ' }
        ],
        // è´¢åŠ¡è®°å½•
        records: [
            {
                id: 1,
                type: 'income',
                icon: 'ğŸ’°',
                title: 'æˆé¹…é”€å”®æ”¶å…¥',
                description: 'å®¢æˆ·ï¼šè‹å·å†œè´¸å¸‚åœº â€¢ 120ç¾½',
                amount: '18,000',
                date: '2024-03-15 14:30',
                relatedInfo: 'å‡ºæ è®°å½•å…³è”',
                status: 'å·²å…¥è´¦',
                statusTheme: 'success',
                autoGenerated: true
            },
            {
                id: 2,
                type: 'expense',
                icon: 'ğŸ›’',
                title: 'ä¼˜è´¨é¹…ç”¨é¥²æ–™é‡‡è´­',
                description: 'ä¾›åº”å•†ï¼šæ­£å¤§é›†å›¢ â€¢ 1.5å¨',
                amount: '4,500',
                date: '2024-03-15 10:20',
                relatedInfo: 'ç‰©æ–™é‡‡è´­å…³è”',
                status: 'å·²æ”¯å‡º',
                statusTheme: 'danger',
                autoGenerated: true
            },
            {
                id: 3,
                type: 'expense',
                icon: 'ğŸ¦¢',
                title: 'ç™½é¹…è‹—é‡‡è´­æ”¯å‡º',
                description: 'ä¾›åº”å•†ï¼šæ±Ÿè‹é¹…ä¸š â€¢ 200ç¾½',
                amount: '1,640',
                date: '2024-03-14 16:45',
                relatedInfo: 'å…¥æ è®°å½•å…³è”',
                status: 'å·²æ”¯å‡º',
                statusTheme: 'danger',
                autoGenerated: true
            },
            {
                id: 4,
                type: 'expense',
                icon: 'ğŸ’Š',
                title: 'ç–«è‹—è¯å“æ”¯å‡º',
                description: 'ç¦½æµæ„Ÿç–«è‹— â€¢ æ²»ç–—ç”¨è¯',
                amount: '750',
                date: '2024-03-13 11:15',
                relatedInfo: 'å¥åº·è®°å½•å…³è”',
                status: 'å·²æ”¯å‡º',
                statusTheme: 'danger',
                autoGenerated: true
            },
            {
                id: 5,
                type: 'expense',
                icon: 'âš¡',
                title: 'æ°´ç”µè´¹æ”¯å‡º',
                description: 'å…»æ®–åœº3æœˆä»½æ°´ç”µè´¹',
                amount: '1,280',
                date: '2024-03-12 18:30',
                relatedInfo: 'å¼ ä¸‰å½•å…¥',
                status: 'æ‰‹åŠ¨è®°å½•',
                statusTheme: 'default',
                autoGenerated: false
            }
        ],
        // è´¢åŠ¡æŠ¥è¡¨
        reports: {
            yearGrowth: '24.5',
            profitRate: '20.7'
        },
        // å®¡æ‰¹äº‹é¡¹
        approvalItems: [
            {
                id: 1,
                type: 'expense',
                icon: 'ğŸ“‹',
                applicant: 'æå››',
                title: 'å·®æ—…è´¹æŠ¥é”€',
                description: 'å»è‹å·é¹…è‹—å¸‚åœºè€ƒå¯Ÿè´¹ç”¨',
                amount: '280',
                submitTime: 'ä»Šå¤© 14:30'
            },
            {
                id: 2,
                type: 'purchase',
                icon: 'ğŸ›’',
                applicant: 'ç‹äº”',
                title: 'é¥²æ–™é‡‡è´­ç”³è¯·',
                description: 'ä¼˜è´¨é¹…ç”¨é¥²æ–™ 2å¨',
                amount: '6,000',
                submitTime: 'ä»Šå¤© 11:20'
            }
        ],
        filteredRecords: []
    },
    onLoad() {
        this.setData({
            filteredRecords: this.data.records
        });
    },
    // è¿”å›ä¸Šä¸€é¡µ
    goBack() {
        wx.navigateBack({
            fail: () => {
                wx.switchTab({
                    url: '/pages/profile/profile'
                });
            }
        });
    },
    // æœˆä»½é€‰æ‹©
    onMonthChange(e) {
        this.setData({
            selectedMonth: e.detail.value
        });
        this.loadFinanceData();
    },
    // Tabåˆ‡æ¢ - TDesign æ ¼å¼
    onTabChange(e) {
        const { value } = e.detail;
        this.setData({
            activeTab: value
        });
    },
    // åˆ‡æ¢Tabçš„æ—§æ–¹æ³•ä¿æŒå…¼å®¹
    switchTab(e) {
        const { tab } = e.currentTarget.dataset;
        this.setData({
            activeTab: tab
        });
    },
    // ç±»å‹ç­›é€‰
    onTypeFilterChange(e) {
        this.setData({
            'filters.type': e.detail.value
        });
        this.filterRecords();
    },
    // æ—¶é—´ç­›é€‰
    onPeriodFilterChange(e) {
        this.setData({
            'filters.period': e.detail.value
        });
        this.filterRecords();
    },
    // ç­›é€‰è®°å½•
    filterRecords() {
        let filtered = this.data.records;
        // æŒ‰ç±»å‹ç­›é€‰
        if (this.data.filters.type !== 'å…¨éƒ¨ç±»å‹') {
            const typeMap = { 'æ”¶å…¥': 'income', 'æ”¯å‡º': 'expense' };
            filtered = filtered.filter(record => record.type === typeMap[this.data.filters.type]);
        }
        // æŒ‰æ—¶é—´ç­›é€‰ (è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥æŒ‰æ—¥æœŸç­›é€‰)
        this.setData({
            filteredRecords: filtered
        });
    },
    // åŠ è½½è´¢åŠ¡æ•°æ®
    loadFinanceData() {
        // æ¨¡æ‹ŸAPIè°ƒç”¨
        wx.showLoading({
            title: 'åŠ è½½ä¸­...'
        });
        setTimeout(() => {
            wx.hideLoading();
            // è¿™é‡Œä¼šæ ¹æ®é€‰æ‹©çš„æœˆä»½åŠ è½½å¯¹åº”æ•°æ®
        }, 1000);
    },
    // è·å–è¯¦ç»†æŠ¥å‘Š
    getDetailedReport() {
        wx.showLoading({
            title: 'AIåˆ†æä¸­...'
        });
        setTimeout(() => {
            wx.hideLoading();
            wx.showModal({
                title: 'AIåˆ†ææŠ¥å‘Š',
                content: 'åŸºäºæ‚¨çš„è´¢åŠ¡æ•°æ®åˆ†æï¼Œå»ºè®®ä¼˜åŒ–é¥²æ–™é‡‡è´­æˆæœ¬ï¼Œé€‚æ—¶å¢åŠ å‡ºæ é‡ï¼Œé¢„è®¡å¯æå‡åˆ©æ¶¦15-20%ã€‚',
                showCancel: false
            });
        }, 2000);
    },
    // æŸ¥çœ‹è®°å½•è¯¦æƒ…
    viewRecordDetail(e) {
        const { item } = e.currentTarget.dataset;
        wx.showModal({
            title: 'äº¤æ˜“è¯¦æƒ…',
            content: `${item.title}\n\n${item.description}\n\né‡‘é¢ï¼šÂ¥${item.amount}\næ—¶é—´ï¼š${item.date}`,
            showCancel: false
        });
    },
    // é€šè¿‡å®¡æ‰¹
    approveApproval(e) {
        const { id } = e.currentTarget.dataset;
        wx.showModal({
            title: 'ç¡®è®¤æ“ä½œ',
            content: 'ç¡®è®¤é€šè¿‡æ­¤ç”³è¯·ï¼Ÿ',
            success: (res) => {
                if (res.confirm) {
                    this.removeApprovalItem(id);
                    wx.showToast({
                        title: 'ç”³è¯·å·²é€šè¿‡',
                        icon: 'success'
                    });
                }
            }
        });
    },
    // æ‹’ç»å®¡æ‰¹
    rejectApproval(e) {
        const { id } = e.currentTarget.dataset;
        wx.showModal({
            title: 'ç¡®è®¤æ“ä½œ',
            content: 'ç¡®è®¤æ‹’ç»æ­¤ç”³è¯·ï¼Ÿ',
            success: (res) => {
                if (res.confirm) {
                    this.removeApprovalItem(id);
                    wx.showToast({
                        title: 'ç”³è¯·å·²æ‹’ç»',
                        icon: 'success'
                    });
                }
            }
        });
    },
    // ç§»é™¤å®¡æ‰¹é¡¹
    removeApprovalItem(id) {
        const approvalItems = this.data.approvalItems.filter(item => item.id !== id);
        this.setData({
            approvalItems
        });
    },
    // æ‰‹åŠ¨è®°è´¦
    addManualRecord() {
        wx.showToast({
            title: 'åŠŸèƒ½å¼€å‘ä¸­',
            icon: 'none'
        });
    },
    // å¯¼å‡ºæŠ¥è¡¨
    exportReport() {
        wx.showLoading({
            title: 'å¯¼å‡ºä¸­...'
        });
        setTimeout(() => {
            wx.hideLoading();
            wx.showToast({
                title: 'æŠ¥è¡¨å·²å¯¼å‡º',
                icon: 'success'
            });
        }, 1500);
    },
    // å®¡æ‰¹æ“ä½œ - é€‚é… TDesign æ»‘åŠ¨æ“ä½œ
    onApprovalAction(e) {
        const { action } = e.detail;
        const { item } = e.currentTarget.dataset;
        if (action.text === 'é€šè¿‡') {
            this.approveApproval({ currentTarget: { dataset: { id: item.id } } });
        }
        else if (action.text === 'æ‹’ç»') {
            this.rejectApproval({ currentTarget: { dataset: { id: item.id } } });
        }
    }
};
// ä½¿ç”¨å¯¼èˆªæ é€‚é…å·¥å…·åˆ›å»ºé¡µé¢
Page((0, navigation_1.createPageWithNavbar)(pageConfig));
