<!--treatment-followup.wxml - æ²»ç–—è·Ÿè¿›é¡µé¢-->
<view class="page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <navigation-bar 
    title="æ²»ç–—è·Ÿè¿›"
    show-back="{{true}}"
    show-menu="{{false}}"
    show-record="{{false}}"
    bind:back="goBack"
  />

  <!-- è¡¨å•å†…å®¹åŒºåŸŸ -->
  <view class="form-content">
    <!-- åŸå§‹è®°å½•ä¿¡æ¯ -->
    <view class="original-record-section">
      <view class="section-header">
        <text class="section-title">åŸå§‹è®°å½•</text>
      </view>
      
      <view class="form-card original-record">
        <view class="record-header">
          <view class="batch-info">
            <text class="record-batch">{{originalRecord.batchNumber}}</text>
            <text class="record-date">{{originalRecord.recordDate}}</text>
          </view>
          <view class="header-right">
            <view class="stat-badge">
              <text class="stat-number">{{originalRecord.affectedCount}}</text>
              <text class="stat-unit">ç¾½</text>
            </view>
            <t-tag theme="{{originalRecord.severity}}" size="small">{{originalRecord.severityText}}</t-tag>
          </view>
        </view>
        
        <view class="record-summary">
          <view class="summary-item">
            <text class="summary-label">ç—‡çŠ¶</text>
            <text class="summary-value">{{originalRecord.symptoms}}</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">æ²»ç–—</text>
            <text class="summary-value">{{originalRecord.treatment}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è·Ÿè¿›è¡¨å• -->
    <view class="followup-form-section">
      <view class="section-header">
        <text class="section-title">æ²»ç–—è·Ÿè¿›</text>
      </view>
      
      <view class="form-card">
        <!-- è·Ÿè¿›æ—¥æœŸ -->
        <view class="form-item">
          <view class="form-label required">è·Ÿè¿›æ—¥æœŸ</view>
          <view class="form-field-content">
            <view class="picker-content" bind:tap="showDatePicker">
              <text class="picker-text">{{formData.followupDate || 'è¯·é€‰æ‹©è·Ÿè¿›æ—¥æœŸ'}}</text>
              <t-icon name="calendar" size="24rpx" color="#bbb" />
            </view>
          </view>
        </view>

        <!-- æ²»æ„ˆæ•°é‡ -->
        <view class="quantity-section cured-section">
          <view class="quantity-header">
            <view class="quantity-title">
              <t-icon name="check-circle-filled" size="32rpx" color="#00a870" />
              <text class="title-text">æ²»æ„ˆæ•°é‡</text>
            </view>
            <view class="reference-info">
              <text class="reference-text">å¯å¤„ç†ï¼š{{originalRecord.currentAffectedCount}} ç¾½</text>
              <text class="detail-text">ï¼ˆåŸå§‹ {{originalRecord.affectedCount}} ç¾½ï¼Œå·²æ²»æ„ˆ {{originalRecord.curedCount}} ç¾½ï¼Œå·²æ­»äº¡ {{originalRecord.deathCount}} ç¾½ï¼‰</text>
            </view>
          </view>
          <view class="quantity-input">
            <t-input
              placeholder="è¾“å…¥æ²»æ„ˆæ•°é‡"
              value="{{formData.curedCount}}"
              type="number"
              bind:change="onFieldChange"
              data-field="curedCount"
              suffix="ç¾½"
              align="center"
              class="quantity-field cured-field"
            />
          </view>
        </view>

        <!-- æ­»äº¡æ•°é‡ -->
        <view class="quantity-section death-section">
          <view class="quantity-header">
            <view class="quantity-title">
              <t-icon name="error-circle-filled" size="32rpx" color="#d54941" />
              <text class="title-text">æ­»äº¡æ•°é‡</text>
            </view>
            <view class="reference-info">
              <text class="reference-text">å¯å¤„ç†ï¼š{{originalRecord.currentAffectedCount}} ç¾½</text>
              <text class="detail-text">ï¼ˆåŸå§‹ {{originalRecord.affectedCount}} ç¾½ï¼Œå·²æ²»æ„ˆ {{originalRecord.curedCount}} ç¾½ï¼Œå·²æ­»äº¡ {{originalRecord.deathCount}} ç¾½ï¼‰</text>
            </view>
          </view>
          <view class="quantity-input">
            <t-input
              placeholder="è¾“å…¥æ­»äº¡æ•°é‡"
              value="{{formData.deathCount}}"
              type="number"
              bind:change="onFieldChange"
              data-field="deathCount"
              suffix="ç¾½"
              align="center"
              class="quantity-field death-field"
            />
          </view>
        </view>

        <!-- è·Ÿè¿›å¤‡æ³¨ -->
        <view class="form-item form-item-vertical">
          <view class="form-label">è·Ÿè¿›å¤‡æ³¨</view>
          <view class="form-field-content">
            <t-textarea
              placeholder="è¯·è¾“å…¥è·Ÿè¿›æƒ…å†µï¼Œå¦‚ï¼šæ²»ç–—æ•ˆæœã€ç—‡çŠ¶å˜åŒ–ã€åç»­è®¡åˆ’ç­‰..."
              value="{{formData.notes}}"
              bind:change="onFieldChange"
              data-field="notes"
              maxlength="300"
              indicator
              autosize
              class="form-textarea"
            />
          </view>
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="form-actions">
      <t-button 
        theme="primary" 
        size="large" 
        block 
        bind:tap="onSubmit"
        loading="{{submitting}}"
        disabled="{{submitting}}"
      >
        {{submitting ? 'æäº¤ä¸­...' : 'æäº¤è·Ÿè¿›è®°å½•'}}
      </t-button>
      <t-button 
        theme="default" 
        size="large" 
        block 
        bind:tap="goBack"
        disabled="{{submitting}}"
      >
        å–æ¶ˆ
      </t-button>
    </view>

    <!-- æ¸©é¦¨æç¤º -->
    <view class="form-tips">
      <t-notice-bar theme="info" content="ğŸ’¡ æç¤ºï¼šå¯åŒæ—¶å¡«å†™æ²»æ„ˆå’Œæ­»äº¡æ•°é‡ï¼Œæ€»æ•°ä¸èƒ½è¶…è¿‡å‰©ä½™å¾…å¤„ç†æ•°é‡ã€‚è‡³å°‘éœ€è¦å¡«å†™ä¸€é¡¹ã€‚" />
    </view>
  </view>

  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <t-date-time-picker 
    visible="{{showDate}}"
    mode="date"
    value="{{dateValue}}"
    format="YYYY-MM-DD"
    bind:cancel="hideDatePicker"
    bind:confirm="onDateConfirm"
  />
</view>
