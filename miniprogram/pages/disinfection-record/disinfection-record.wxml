<!-- disinfection-record.wxml - 环境消毒记录页面 -->
<view class="page disinfection-record-page">
  <!-- 导航栏 -->
  <navigation-bar 
    title="环境消毒记录"
    show-back="true"
    bind:back="goBack"
  />

  <view class="page-container">
    <!-- 表单内容 -->
    <view class="form-container">
      
      <!-- 基本信息 -->
      <view class="form-section">
        <view class="section-title">基本信息</view>
        
        <!-- 批次选择 -->
        <view class="form-item" wx:if="{{!formData.batchId}}">
          <view class="form-label">目标批次</view>
          <t-cell 
            title="{{formData.batchId || '请选择批次（可选）'}}"
            arrow
            bind:click="showBatchSelector"
          />
        </view>

        <!-- 消毒区域 -->
        <view class="form-item">
          <view class="form-label required">消毒区域</view>
          <t-input
            value="{{formData.locationId}}"
            placeholder="请输入消毒区域"
            data-field="locationId"
            bind:change="onFormInput"
            status="{{formErrors.locationId ? 'error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.locationId}}">{{formErrors.locationId}}</view>
        </view>

        <!-- 消毒剂名称 -->
        <view class="form-item">
          <view class="form-label required">消毒剂名称</view>
          <t-input
            value="{{formData.disinfectant}}"
            placeholder="如：聚维酮碘、过氧乙酸等"
            data-field="disinfectant"
            bind:change="onFormInput"
            status="{{formErrors.disinfectant ? 'error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.disinfectant}}">{{formErrors.disinfectant}}</view>
        </view>

        <!-- 消毒剂浓度 -->
        <view class="form-item">
          <view class="form-label required">消毒剂浓度</view>
          <t-input
            value="{{formData.concentration}}"
            placeholder="如：1:200、0.5%等"
            data-field="concentration"
            bind:change="onFormInput"
            status="{{formErrors.concentration ? 'error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.concentration}}">{{formErrors.concentration}}</view>
        </view>

        <!-- 消毒面积 -->
        <view class="form-item">
          <view class="form-label required">消毒面积</view>
          <t-input
            value="{{formData.area}}"
            placeholder="请输入消毒面积"
            type="digit"
            data-field="area"
            bind:input="onNumberInput"
            status="{{formErrors.area ? 'error' : ''}}"
            suffix="平方米"
          />
          <view class="error-text" wx:if="{{formErrors.area}}">{{formErrors.area}}</view>
        </view>
      </view>

      <!-- 消毒方式 -->
      <view class="form-section">
        <view class="section-title">消毒方式</view>
        
        <!-- 消毒方法 -->
        <view class="form-item">
          <view class="form-label">消毒方法</view>
          <t-cell 
            title="{{selectedMethodLabel}}"
            arrow
            bind:click="showMethodSelector"
          />
        </view>

        <!-- 天气条件 -->
        <view class="form-item">
          <view class="form-label">天气条件</view>
          <t-cell 
            title="{{selectedWeatherLabel}}"
            arrow
            bind:click="showWeatherSelector"
          />
        </view>

        <!-- 环境温度 -->
        <view class="form-item">
          <view class="form-label">环境温度</view>
          <t-input
            value="{{formData.temperature}}"
            placeholder="请输入环境温度"
            type="digit"
            data-field="temperature"
            bind:input="onNumberInput"
            status="{{formErrors.temperature ? 'error' : ''}}"
            suffix="°C"
          />
          <view class="error-text" wx:if="{{formErrors.temperature}}">{{formErrors.temperature}}</view>
        </view>

        <!-- 环境湿度 -->
        <view class="form-item">
          <view class="form-label">环境湿度</view>
          <t-input
            value="{{formData.humidity}}"
            placeholder="请输入环境湿度"
            type="digit"
            data-field="humidity"
            bind:input="onNumberInput"
            status="{{formErrors.humidity ? 'error' : ''}}"
            suffix="%"
          />
          <view class="error-text" wx:if="{{formErrors.humidity}}">{{formErrors.humidity}}</view>
        </view>
      </view>

      <!-- 执行信息 -->
      <view class="form-section">
        <view class="section-title">执行信息</view>
        
        <!-- 执行日期 -->
        <view class="form-item">
          <view class="form-label required">执行日期</view>
          <picker 
            mode="date" 
            value="{{formData.executionDate}}"
            data-field="executionDate"
            bind:change="onDateChange"
          >
            <t-input
              value="{{formData.executionDate}}"
              placeholder="请选择执行日期"
              readonly
              suffix-icon="calendar"
              status="{{formErrors.executionDate ? 'error' : ''}}"
            />
          </picker>
          <view class="error-text" wx:if="{{formErrors.executionDate}}">{{formErrors.executionDate}}</view>
        </view>

        <!-- 执行时间 -->
        <view class="form-item">
          <view class="form-label">执行时间</view>
          <picker 
            mode="time" 
            value="{{formData.executionTime}}"
            data-field="executionTime"
            bind:change="onTimeChange"
          >
            <t-input
              value="{{formData.executionTime}}"
              placeholder="请选择执行时间"
              readonly
              suffix-icon="time"
            />
          </picker>
        </view>

        <!-- 操作员 -->
        <view class="form-item">
          <view class="form-label required">操作员</view>
          <t-input
            value="{{formData.operator}}"
            placeholder="请输入操作员姓名"
            data-field="operator"
            bind:change="onFormInput"
            status="{{formErrors.operator ? 'error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.operator}}">{{formErrors.operator}}</view>
        </view>

        <!-- 成本费用 -->
        <view class="form-item">
          <view class="form-label">成本费用</view>
          <t-input
            value="{{formData.cost}}"
            placeholder="请输入消毒成本"
            type="digit"
            data-field="cost"
            bind:input="onNumberInput"
            prefix-icon="wallet"
            suffix="元"
          />
        </view>
      </view>

      <!-- 效果评估 -->
      <view class="form-section">
        <view class="section-title">效果评估</view>
        
        <!-- 消毒效果 -->
        <view class="form-item">
          <view class="form-label">消毒效果</view>
          <t-cell 
            title="{{selectedEffectivenessLabel}}"
            arrow
            bind:click="showEffectivenessSelector"
          />
          <view class="form-tip" wx:if="{{formData.effectiveness === 'poor'}}">
            效果较差将触发健康风险监控
          </view>
        </view>

        <!-- 下次消毒时间 -->
        <view class="form-item">
          <view class="form-label">下次消毒</view>
          <picker 
            mode="date" 
            value="{{formData.nextSchedule}}"
            data-field="nextSchedule"
            bind:change="onDateChange"
          >
            <t-input
              value="{{formData.nextSchedule}}"
              placeholder="请选择下次消毒时间（可选）"
              readonly
              suffix-icon="calendar"
            />
          </picker>
        </view>

        <!-- 备注 -->
        <view class="form-item">
          <view class="form-label">备注信息</view>
          <t-textarea
            value="{{formData.notes}}"
            placeholder="请输入备注信息（可选）"
            maxlength="200"
            data-field="notes"
            bind:change="onFormInput"
          />
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <t-button 
        theme="light" 
        size="large" 
        bind:tap="resetForm"
        disabled="{{submitting}}"
      >
        重置
      </t-button>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="submitForm"
        loading="{{submitting}}"
      >
        保存记录
      </t-button>
    </view>

    <!-- 底部安全区域 -->
    <view style="height: 120rpx;"></view>
  </view>

  <!-- 消毒方法选择器 -->
  <t-picker
    visible="{{showMethodPicker}}"
    value="{{[selectedMethodIndex]}}"
    data-source="{{methodOptions}}"
    bind:change="onMethodPickerChange"
    bind:cancel="onMethodPickerCancel"
    title="选择消毒方法"
  >
    <t-picker-item
      wx:for="{{methodOptions}}"
      wx:key="value"
      label="{{item.label}}"
      value="{{index}}"
    />
  </t-picker>

  <!-- 天气条件选择器 -->
  <t-picker
    visible="{{showWeatherPicker}}"
    value="{{[selectedWeatherIndex]}}"
    data-source="{{weatherOptions}}"
    bind:change="onWeatherPickerChange"
    bind:cancel="onWeatherPickerCancel"
    title="选择天气条件"
  >
    <t-picker-item
      wx:for="{{weatherOptions}}"
      wx:key="value"
      label="{{item.label}}"
      value="{{index}}"
    />
  </t-picker>

  <!-- 消毒效果选择器 -->
  <t-picker
    visible="{{showEffectivenessPicker}}"
    value="{{[selectedEffectivenessIndex]}}"
    data-source="{{effectivenessOptions}}"
    bind:change="onEffectivenessPickerChange"
    bind:cancel="onEffectivenessPickerCancel"
    title="选择消毒效果"
  >
    <t-picker-item
      wx:for="{{effectivenessOptions}}"
      wx:key="value"
      label="{{item.label}}"
      value="{{index}}"
    />
  </t-picker>
</view>
