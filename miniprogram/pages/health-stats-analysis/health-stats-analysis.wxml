<!--health-stats-analysis.wxml - å¥åº·ç»Ÿè®¡åˆ†æé¡µé¢-->
<view class="page page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <navigation-bar 
    title="å¥åº·ç»Ÿè®¡åˆ†æ"
    show-back="true"
    show-menu="false"
    show-record="false"
    bind:back="goBack"
  />

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <t-loading theme="spinner" size="40rpx" text="åŠ è½½ä¸­..." />
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->
    <view wx:else class="content-container">
      <!-- æ•´ä½“ç»Ÿè®¡æ¦‚è§ˆ -->
      <view class="stats-overview">
        <view class="overview-header">
          <t-icon name="chart-line" size="32rpx" color="#0052D9" />
          <text class="overview-title">æ•´ä½“å¥åº·æ¦‚å†µ</text>
          <text class="data-period">ï¼ˆåŸºäºå…¨å†å²æ•°æ®ï¼‰</text>
        </view>
        
        <t-row gutter="16" class="overview-stats">
          <t-col span="6">
            <view class="stat-card stat-primary">
              <view class="stat-value">{{overallStats.totalAnimals}}</view>
              <view class="stat-label">ç´¯è®¡å…»æ®–</view>
              <view class="stat-unit">åª</view>
            </view>
          </t-col>
          <t-col span="6">
            <view class="stat-card stat-success">
              <view class="stat-value">{{overallStats.survivalRate}}%</view>
              <view class="stat-label">æ•´ä½“å­˜æ´»ç‡</view>
            </view>
          </t-col>
          <t-col span="6">
            <view class="stat-card stat-info">
              <view class="stat-value">{{overallStats.recoveryRate}}%</view>
              <view class="stat-label">æ²»æ„ˆç‡</view>
            </view>
          </t-col>
          <t-col span="6">
            <view class="stat-card stat-warning">
              <view class="stat-value">{{overallStats.mortalityRate}}%</view>
              <view class="stat-label">æ­»äº¡ç‡</view>
            </view>
          </t-col>
        </t-row>
      </view>

      <!-- Tabå¯¼èˆª -->
      <t-tabs 
        value="{{activeTab}}" 
        bind:change="onTabChange" 
        theme="line" 
        class="analysis-tabs"
        sticky
        sticky-offset="{{navBarHeight}}"
      >
        <t-tab-panel value="trend" label="å¥åº·è¶‹åŠ¿" />
        <t-tab-panel value="diseases" label="ç—…ç§ç»Ÿè®¡" />
        <t-tab-panel value="treatment" label="æ²»ç–—æ•ˆæœ" />
        <t-tab-panel value="cost" label="æˆæœ¬åˆ†æ" />
        <t-tab-panel value="ai_prediction" label="AIé¢„æµ‹" />
      </t-tabs>

      <!-- Tabå†…å®¹åŒºåŸŸ -->
      <view class="tab-content">
        
        <!-- å¥åº·è¶‹åŠ¿ Tab -->
        <view wx:if="{{activeTab === 'trend'}}" class="trend-panel">
          <!-- è¶‹åŠ¿å›¾è¡¨ -->
          <view class="chart-section">
            <view class="section-header">
              <text class="section-title">ğŸ“ˆ å¥åº·æŒ‡æ ‡è¶‹åŠ¿</text>
            </view>
            <view class="chart-container">
              <!-- æœˆåº¦å¥åº·è¶‹åŠ¿ -->
              <view class="trend-chart">
                <view class="chart-title">æœˆåº¦å­˜æ´»ç‡å˜åŒ–</view>
                <view class="trend-line-chart">
                  <view wx:for="{{trendData.monthlyData}}" wx:key="month" class="trend-point">
                    <view class="point-bar" style="height: {{item.percentage}}%"></view>
                    <view class="point-value">{{item.rate}}%</view>
                    <view class="point-label">{{item.month}}</view>
                  </view>
                </view>
              </view>
              
              <!-- å­£åº¦å¯¹æ¯” -->
              <view class="seasonal-comparison">
                <view class="chart-title">å­£åº¦å¥åº·å¯¹æ¯”</view>
                <t-row gutter="12">
                  <t-col wx:for="{{trendData.seasonalData}}" wx:key="season" span="6">
                    <view class="season-card">
                      <view class="season-name">{{item.season}}</view>
                      <view class="season-rate {{item.status}}">{{item.rate}}%</view>
                      <view class="season-trend">
                        <t-icon name="{{item.trend === 'up' ? 'chevron-up' : 'chevron-down'}}" size="20rpx" color="{{item.trend === 'up' ? '#52c41a' : '#ff4d4f'}}" />
                        <text class="trend-text">{{item.change}}</text>
                      </view>
                    </view>
                  </t-col>
                </t-row>
              </view>
            </view>
          </view>
          
          <!-- å…³é”®æŒ‡æ ‡å¡ç‰‡ -->
          <view class="key-indicators">
            <view class="section-header">
              <text class="section-title">ğŸ“Š å…³é”®å¥åº·æŒ‡æ ‡</text>
            </view>
            <view class="indicators-grid">
              <view wx:for="{{healthIndicators}}" wx:key="index" class="indicator-card">
                <view class="indicator-icon">{{item.icon}}</view>
                <view class="indicator-content">
                  <view class="indicator-name">{{item.name}}</view>
                  <view class="indicator-value">{{item.value}}</view>
                  <view class="indicator-desc">{{item.description}}</view>
                </view>
                <view class="indicator-trend {{item.trendDirection}}">
                  <t-icon name="{{item.trendDirection === 'up' ? 'chevron-up' : 'chevron-down'}}" size="20rpx" />
                  <text>{{item.trendValue}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- ç—…ç§ç»Ÿè®¡ Tab -->
        <view wx:if="{{activeTab === 'diseases'}}" class="diseases-panel">
          <!-- ç—…ç§åˆ†å¸ƒ -->
          <view class="disease-distribution">
            <view class="section-header">
              <text class="section-title">ğŸ§¬ å†å²ç—…ç§åˆ†å¸ƒ</text>
            </view>
            
            <!-- é¥¼å›¾å±•ç¤º -->
            <view class="pie-chart-container">
              <view class="css-pie-chart">
                <view wx:for="{{diseaseStats.pieData}}" wx:key="index" 
                      class="pie-slice-container" 
                      style="transform: rotate({{item.startAngle}}deg)">
                  <view class="pie-slice" 
                        style="--slice-color: {{item.color}}; --slice-angle: {{item.angle}}deg"></view>
                </view>
                <view class="pie-center">
                  <text class="center-value">{{diseaseStats.totalCases}}</text>
                  <text class="center-label">æ€»ç—…ä¾‹</text>
                </view>
              </view>
              
              <!-- å›¾ä¾‹ -->
              <view class="chart-legend">
                <view wx:for="{{diseaseStats.legendData}}" wx:key="index" class="legend-item">
                  <view class="legend-color" style="background-color: {{item.color}}"></view>
                  <text class="legend-name">{{item.name}}</text>
                  <text class="legend-value">{{item.percentage}}%</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- é«˜å‘ç—…ç§è¯¦æƒ… -->
          <view class="top-diseases">
            <view class="section-header">
              <text class="section-title">ğŸ”¥ é«˜å‘ç—…ç§æ’å</text>
            </view>
            <view class="diseases-ranking">
              <view wx:for="{{diseaseStats.topDiseases}}" wx:key="index" class="disease-rank-item">
                <view class="rank-badge rank-{{index + 1}}">{{index + 1}}</view>
                <view class="disease-info">
                  <view class="disease-name">{{item.name}}</view>
                  <view class="disease-cases">ç´¯è®¡ {{item.cases}} ä¾‹</view>
                </view>
                <view class="disease-stats">
                  <view class="mortality-rate">æ­»äº¡ç‡ {{item.mortalityRate}}%</view>
                  <view class="recovery-rate">æ²»æ„ˆç‡ {{item.recoveryRate}}%</view>
                </view>
                <view class="disease-trend">
                  <view class="trend-bar">
                    <view class="bar-fill" style="width: {{item.trendPercentage}}%; background: {{item.trendColor}}"></view>
                  </view>
                  <text class="trend-label">{{item.trendLabel}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- æ²»ç–—æ•ˆæœ Tab -->
        <view wx:if="{{activeTab === 'treatment'}}" class="treatment-panel">
          <!-- è¯ç‰©æ•ˆæœç»Ÿè®¡ -->
          <view class="medication-effectiveness">
            <view class="section-header">
              <text class="section-title">ğŸ’Š è¯ç‰©æ²»ç–—æ•ˆæœ</text>
            </view>
            
            <view class="effectiveness-chart">
              <view wx:for="{{treatmentStats.medications}}" wx:key="index" class="medication-item">
                <view class="medication-header">
                  <view class="medication-name">{{item.name}}</view>
                  <view class="success-rate">æœ‰æ•ˆç‡ {{item.effectiveRate}}%</view>
                </view>
                <view class="effectiveness-bar">
                  <view class="bar-bg">
                    <view class="bar-fill" style="width: {{item.effectiveRate}}%"></view>
                  </view>
                  <view class="bar-stats">
                    <text class="stat-item">ä½¿ç”¨æ¬¡æ•°: {{item.usageCount}}</text>
                    <text class="stat-item">å¹³å‡æ²»æ„ˆå¤©æ•°: {{item.avgRecoveryDays}}å¤©</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- æ²»ç–—æ–¹æ¡ˆåˆ†æ -->
          <view class="treatment-methods">
            <view class="section-header">
              <text class="section-title">ğŸ¥ æ²»ç–—æ–¹æ¡ˆå¯¹æ¯”</text>
            </view>
            
            <view class="methods-comparison">
              <view wx:for="{{treatmentStats.methods}}" wx:key="index" class="method-card">
                <view class="method-header">
                  <view class="method-icon">{{item.icon}}</view>
                  <view class="method-name">{{item.name}}</view>
                </view>
                <view class="method-stats">
                  <view class="stat-row">
                    <text class="stat-label">æˆåŠŸç‡:</text>
                    <text class="stat-value success">{{item.successRate}}%</text>
                  </view>
                  <view class="stat-row">
                    <text class="stat-label">å¹³å‡æˆæœ¬:</text>
                    <text class="stat-value cost">Â¥{{item.avgCost}}</text>
                  </view>
                  <view class="stat-row">
                    <text class="stat-label">æ²»ç–—å‘¨æœŸ:</text>
                    <text class="stat-value duration">{{item.avgDuration}}å¤©</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- æˆæœ¬åˆ†æ Tab -->
        <view wx:if="{{activeTab === 'cost'}}" class="cost-panel">
          <!-- æˆæœ¬ç»“æ„ -->
          <view class="cost-structure">
            <view class="section-header">
              <text class="section-title">ğŸ’° åŒ»ç–—æˆæœ¬ç»“æ„</text>
            </view>
            
            <view class="cost-breakdown">
              <view class="total-cost-card">
                <view class="cost-value">Â¥{{costAnalysis.totalMedicalCost}}</view>
                <view class="cost-label">ç´¯è®¡åŒ»ç–—æ”¯å‡º</view>
                <view class="cost-period">ï¼ˆå…¨å†å²å‘¨æœŸï¼‰</view>
              </view>
              
              <view class="cost-categories">
                <view wx:for="{{costAnalysis.categories}}" wx:key="index" class="category-item">
                  <view class="category-info">
                    <view class="category-name">{{item.name}}</view>
                    <view class="category-amount">Â¥{{item.amount}}</view>
                  </view>
                  <view class="category-percentage">
                    <view class="percentage-bar">
                      <view class="bar-fill" style="width: {{item.percentage}}%; background: {{item.color}}"></view>
                    </view>
                    <text class="percentage-text">{{item.percentage}}%</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- æˆæœ¬æ•ˆç›Šåˆ†æ -->
          <view class="cost-benefit-analysis">
            <view class="section-header">
              <text class="section-title">ğŸ“ˆ æˆæœ¬æ•ˆç›Šåˆ†æ</text>
            </view>
            
            <view class="benefit-metrics">
              <t-row gutter="16">
                <t-col span="12">
                  <view class="metric-card">
                    <view class="metric-value">Â¥{{costAnalysis.avgCostPerAnimal}}</view>
                    <view class="metric-label">å•åªå¹³å‡åŒ»ç–—æˆæœ¬</view>
                    <view class="metric-trend down">
                      <t-icon name="chevron-down" size="16rpx" />
                      <text>è¾ƒå»å¹´â†“{{costAnalysis.costReduction}}%</text>
                    </view>
                  </view>
                </t-col>
                <t-col span="12">
                  <view class="metric-card">
                    <view class="metric-value">{{costAnalysis.preventionEffectiveness}}%</view>
                    <view class="metric-label">é¢„é˜²æªæ–½æœ‰æ•ˆæ€§</view>
                    <view class="metric-trend up">
                      <t-icon name="chevron-up" size="16rpx" />
                      <text>è¾ƒå»å¹´â†‘{{costAnalysis.preventionImprovement}}%</text>
                    </view>
                  </view>
                </t-col>
              </t-row>
            </view>
          </view>
        </view>

        <!-- AIé¢„æµ‹ Tab -->
        <view wx:if="{{activeTab === 'ai_prediction'}}" class="ai-prediction-panel">
          <!-- AIé¢„æµ‹åŠŸèƒ½ -->
          <view class="prediction-section">
            <view class="section-header">
              <t-icon name="robot" size="32rpx" color="#0052D9" />
              <text class="section-title">ğŸ”® AIå¥åº·é¢„æµ‹</text>
              <t-button wx:if="{{!aiPrediction.loading}}" size="small" theme="primary" bind:tap="generateAIPrediction" class="ai-button primary-button">
                {{aiPrediction.result ? 'é‡æ–°é¢„æµ‹' : 'ç”Ÿæˆé¢„æµ‹'}}
              </t-button>
            </view>
            
            <!-- AIé¢„æµ‹è¿›è¡Œä¸­ -->
            <view wx:if="{{aiPrediction.loading}}" class="prediction-loading">
              <t-loading theme="spinner" size="40rpx" />
              <text class="loading-text">AIæ­£åœ¨åˆ†æå†å²æ•°æ®...</text>
            </view>
            
            <!-- AIé¢„æµ‹ç»“æœ -->
            <view wx:elif="{{aiPrediction.result}}" class="prediction-results">
              <!-- é£é™©é¢„è­¦ -->
              <view class="risk-alerts">
                <view class="alert-title">âš ï¸ é£é™©é¢„è­¦</view>
                <view wx:for="{{aiPrediction.result.riskAlerts}}" wx:key="index" class="alert-item {{item.level}}">
                  <view class="alert-icon">{{item.icon}}</view>
                  <view class="alert-content">
                    <view class="alert-message">{{item.message}}</view>
                    <view class="alert-probability">é¢„æµ‹æ¦‚ç‡: {{item.probability}}%</view>
                  </view>
                </view>
              </view>
              
              <!-- è¶‹åŠ¿é¢„æµ‹ -->
              <view class="trend-prediction">
                <view class="prediction-title">ğŸ“Š æœªæ¥3ä¸ªæœˆè¶‹åŠ¿é¢„æµ‹</view>
                <view class="prediction-chart">
                  <view wx:for="{{aiPrediction.result.monthlyPrediction}}" wx:key="month" class="prediction-month">
                    <view class="month-header">
                      <text class="month-name">{{item.month}}</text>
                    </view>
                    <view class="month-metrics">
                      <view class="metric-item">
                        <text class="metric-name">é¢„æµ‹å­˜æ´»ç‡</text>
                        <text class="metric-value success">{{item.survivalRate}}%</text>
                      </view>
                      <view class="metric-item">
                        <text class="metric-name">ç–¾ç—…é£é™©</text>
                        <text class="metric-value {{item.riskLevel}}">{{item.diseaseRisk}}</text>
                      </view>
                    </view>
                  </view>
                </view>
              </view>
              
              <!-- AIå»ºè®® -->
              <view class="ai-recommendations">
                <view class="recommendation-title">ğŸ’¡ AIä¼˜åŒ–å»ºè®®</view>
                <view class="recommendations-list">
                  <view wx:for="{{aiPrediction.result.recommendations}}" wx:key="index" class="recommendation-item">
                    <view class="recommendation-category">{{item.category}}</view>
                    <view class="recommendation-content">{{item.content}}</view>
                    <view class="recommendation-impact">é¢„æœŸæ”¶ç›Š: {{item.expectedBenefit}}</view>
                  </view>
                </view>
              </view>
            </view>
            
            <!-- æ— é¢„æµ‹ç»“æœæ—¶çš„æç¤º -->
            <view wx:else class="prediction-empty">
              <view class="empty-icon">ğŸ¤–</view>
              <view class="empty-text">ç‚¹å‡»"ç”Ÿæˆé¢„æµ‹"è·å–AIå¥åº·åˆ†æ</view>
              <view class="empty-desc">åŸºäºå†å²æ•°æ®è¿›è¡Œæ™ºèƒ½é¢„æµ‹å’Œå»ºè®®</view>
            </view>
          </view>
        </view>

      </view>
    </view>
  </view>
</view>
