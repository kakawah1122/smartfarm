<view class="weather-detail-page">
  <!-- 导航栏 -->
  <navigation-bar 
    title="天气详情"
    show-back="{{true}}"
  />

  <scroll-view class="scroll-container" scroll-y enhanced="{{true}}" show-scrollbar="{{false}}">
    
    <!-- 当前天气卡片 -->
    <view class="card current-weather-card">
      <view class="card-content">

        <!-- 主要天气信息 - 左中右对称布局 -->
        <view class="weather-main-layout">
          <!-- 左侧城市信息 -->
          <view class="left-city-section">
            <text class="city-name">{{location.city}}</text>
            <text class="district-name">{{location.district}}</text>
          </view>
          
          <!-- 中间温度和天气 -->
          <view class="center-weather-section">
            <view class="temperature-row">
              <text class="main-temperature">{{weather.temperature}}°</text>
              <view class="weather-info-right">
                <text class="weather-emoji">{{weather.emoji || '☀️'}}</text>
                <text class="weather-condition">{{weather.condition}}</text>
              </view>
            </view>
          </view>
          
          <!-- 右侧体感温度 -->
          <view class="right-feels-section">
            <text class="feels-label">体感</text>
            <text class="feels-temperature">{{weather.feelsLike}}°</text>
          </view>
        </view>
        
        <!-- 今日概览数据 -->
        <view class="today-overview" wx:if="{{todayForecast.tempMax}}">
          <view class="overview-item">
            <text class="overview-label">今日最高</text>
            <text class="overview-value">{{todayForecast.tempMax}}°</text>
          </view>
          <view class="overview-item">
            <text class="overview-label">今日最低</text>
            <text class="overview-value">{{todayForecast.tempMin}}°</text>
          </view>
          <view class="overview-item">
            <text class="overview-label">湿度</text>
            <text class="overview-value">{{weather.humidity}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 天气预警卡片 -->
    <view class="card warning-card" wx:if="{{warningList.length > 0}}">
      <view class="card-header">
        <text class="card-title">⚠️ 天气预警</text>
        <view class="warning-count">{{warningList.length}}条预警</view>
      </view>
      <view class="card-content">
        <view class="warning-list">
          <view class="warning-item" wx:for="{{warningList}}" wx:key="id">
            <view class="warning-header">
              <t-tag theme="{{item.theme || 'default'}}" size="small">{{item.severity || '未知'}}</t-tag>
              <text class="warning-type">{{item.typeName || item.type}}</text>
            </view>
            <text class="warning-title">{{item.title}}</text>
            
            <!-- 预警详情内容，使用更清晰的布局 -->
            <view class="warning-details">
              <text class="warning-text" wx:if="{{item.text}}">{{item.text}}</text>
            </view>
            
            <!-- 预警时间信息，使用更清晰的布局 -->
            <view class="warning-time-info">
              <text class="warning-time" wx:if="{{item.pubTime}}">发布: {{item.pubTime}}</text>
              <view class="warning-period">
                <text class="period-start" wx:if="{{item.startTime}}">生效: {{item.startTime}}</text>
                <text class="period-end" wx:if="{{item.endTime}}">解除: {{item.endTime}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 24小时预报卡片 -->
    <view class="card hourly-forecast-card">
      <view class="card-header">
        <text class="card-title">24小时预报</text>
        <text class="next-hour-info" wx:if="{{nextHourWeather}}">下一小时：{{nextHourWeather.desc}}</text>
      </view>
      <view class="card-content">
        <view class="next-hour-summary" wx:if="{{nextHourWeather}}">
          <view class="next-hour-details">
            <text class="next-hour-time">{{nextHourWeather.time}}</text>
            <text class="next-hour-temp">{{nextHourWeather.temp}}</text>
            <text class="next-hour-wind">{{nextHourWeather.wind}}</text>
            <text class="next-hour-pop" wx:if="{{nextHourWeather.pop}}">{{nextHourWeather.pop}}</text>
          </view>
        </view>
        <scroll-view scroll-x class="hourly-scroll" show-scrollbar="{{false}}">
          <view class="hourly-container">
            <view class="hourly-item {{index === 0 ? 'current' : ''}}" wx:for="{{hourlyForecast}}" wx:key="time">
              <text class="hour-time">{{item.timeLabel}}</text>
              <view class="hour-weather">
                <text class="hour-icon">{{item.icon}}</text>
                <text class="hour-temp">{{item.temp}}°</text>
                <text class="hour-pop" wx:if="{{item.pop > 0}}">{{item.pop}}%</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- 空气质量卡片 - 使用TDesign组件 -->
    <view class="card air-quality-card" wx:if="{{airData}}">
      <view class="card-header">
        <text class="card-title">空气质量</text>
        <t-tag theme="{{airData.aqi <= 50 ? 'success' : (airData.aqi <= 100 ? 'warning' : 'danger')}}" variant="light" size="medium">
          {{airData.category || '获取中'}}
        </t-tag>
      </view>
      <view class="card-content">
        <!-- 主要AQI显示区域 -->
        <view class="aqi-display">
          <view class="aqi-main-section">
            <view class="aqi-main-value">
              <text class="aqi-number" style="color: {{airData.color}}">{{airData.aqi || '--'}}</text>
              <text class="aqi-unit">AQI</text>
            </view>
            <view class="aqi-progress-container">
              <t-progress 
                percentage="{{airData.progress || 0}}" 
                color="{{airData.color}}"
                stroke-width="8"
                track-color="rgba(0, 0, 0, 0.1)"
              />
            </view>
          </view>
        </view>
        
      </view>
    </view>

    <!-- 详细指标卡片 -->
    <view class="card weather-metrics-card">
      <view class="card-header">
        <text class="card-title">详细指标</text>
        <text class="metrics-subtitle">实时数据</text>
      </view>
      <view class="card-content">
        <t-grid column="2" border="{{true}}" class="metrics-grid">
          <t-grid-item>
            <view class="metric-item">
              <text class="metric-value">{{weather.humidity}}%</text>
              <text class="metric-label">湿度</text>
            </view>
          </t-grid-item>
          
          <t-grid-item>
            <view class="metric-item">
              <text class="metric-value">{{weather.windScale}}</text>
              <text class="metric-label">风力等级</text>
            </view>
          </t-grid-item>
          
          <t-grid-item>
            <view class="metric-item">
              <text class="metric-value">{{weather.visibility || '--'}}km</text>
              <text class="metric-label">能见度</text>
            </view>
          </t-grid-item>
          
          <t-grid-item>
            <view class="metric-item">
              <text class="metric-value">{{weather.pressure || '--'}}</text>
              <text class="metric-label">气压 (hPa)</text>
            </view>
          </t-grid-item>
        </t-grid>
      </view>
    </view>


    <!-- 7天预报卡片 -->
    <view class="card weekly-forecast-card">
      <view class="card-header">
        <text class="card-title">7天预报</text>
        <text class="forecast-trend">温度趋势</text>
      </view>
      <view class="card-content">
        <view class="daily-forecast-list">
          <view class="daily-forecast-item" wx:for="{{dailyForecast}}" wx:key="date">
            <view class="day-info">
              <text class="day-name">{{item.dayName}}</text>
              <view class="day-weather">
                <text class="day-icon">{{item.iconDay}}</text>
                <text class="day-condition">{{item.textDay}}</text>
              </view>
              <view class="day-wind" wx:if="{{item.windDir}}">
                <text class="wind-dir">{{item.windDir}}</text>
                <text class="wind-scale">{{item.windScale}}</text>
              </view>
            </view>
            
            <view class="temp-info">
              <view class="temp-range">
                <text class="temp-low">{{item.tempMin}}°</text>
                <view class="temp-bar-wrapper">
                  <view class="temp-bar" style="width: {{item.tempProgress}}%;"></view>
                </view>
                <text class="temp-high">{{item.tempMax}}°</text>
              </view>
              <view class="day-details" wx:if="{{item.humidity}}">
                <text class="humidity-info">湿度{{item.humidity}}%</text>
                <text class="uv-info" wx:if="{{item.uvIndex}}">UV{{item.uvIndex}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>




  </scroll-view>

  <!-- 刷新按钮 -->
  <view class="refresh-button-container">
    <t-button 
      theme="primary" 
      size="large" 
      icon="refresh" 
      loading="{{refreshing}}"
      bind:tap="onRefreshWeather"
      class="refresh-button"
    >
      {{refreshing ? '刷新中...' : '刷新天气'}}
    </t-button>
  </view>

</view>
