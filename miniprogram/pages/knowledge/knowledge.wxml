<!--knowledge.wxml-->
<view class="page-container">
  <!-- 新式导航栏 -->
  <navigation-bar 
    title="养鹅知识库"
    show-back="{{true}}"
    show-menu="{{false}}"
    show-record="{{false}}"
    bind:back="goBack"
  />
  
  <!-- 搜索栏 -->
  <view class="search-section" wx:if="{{showSearchBar}}">
    <view class="search-container">
      <t-input placeholder="搜索养鹅知识..." 
               value="{{searchKeyword}}" 
               bind:change="onSearchInput"
               bind:enter="searchArticles"
               prefix-icon="search" />
    </view>
  </view>

  <scroll-view class="scroll-container" scroll-y style="padding-top: {{totalNavHeight + 100}}rpx;">
    <!-- 分类导航 -->
    <view class="category-nav">
      <t-tabs value="{{activeCategory}}" bind:change="selectCategory" theme="line" class="knowledge-tabs">
        <t-tab-panel wx:for="{{categories}}" wx:key="id" value="{{item.id}}" label="{{item.name}}" />
      </t-tabs>
    </view>

    <!-- 热门推荐 -->
    <view wx:if="{{activeCategory === 'all'}}" class="card hot-card">
      <view class="card-header">
        <text class="card-title">🔥 本周热门</text>
      </view>
      <t-cell title="{{hotArticle.title}}"
              description="{{hotArticle.description}}"
              note="阅读量: {{hotArticle.views}} • {{hotArticle.date}}"
              left-icon="🔥"
              arrow
              bind:click="viewArticle"
              data-item="{{hotArticle}}"
              class="hot-article-cell">
      </t-cell>
    </view>

    <!-- 文章列表 -->
    <view class="card article-list-card">
      <view class="card-header">
        <text class="card-title">文章列表</text>
      </view>
      <t-cell-group>
        <t-cell wx:for="{{filteredArticles}}" 
                wx:key="id"
                title="{{item.title}}"
                description="{{item.description}}"
                note="👁️ {{item.views}} • ⏱️ {{item.readTime}}分钟 • {{item.date}}"
                left-icon="{{item.categoryIcon}}"
                arrow
                bind:click="viewArticle"
                data-item="{{item}}">
          <view slot="right" class="article-meta">
            <t-tag theme="{{item.categoryTheme}}" size="small">{{item.categoryName}}</t-tag>
          </view>
        </t-cell>
      </t-cell-group>
    </view>

    <!-- 我的收藏 -->
    <view class="card collection-card">
      <view class="card-header">
        <text class="card-title">💾 我的收藏</text>
        <text class="view-all" bind:tap="viewAllCollections">查看全部</text>
      </view>
      <t-grid column="2" class="collection-grid">
        <t-grid-item wx:for="{{collections}}" 
                     wx:key="id"
                     bind:click="viewArticle" 
                     data-item="{{item}}">
          <view class="collection-item">
            <text class="collection-title">{{item.title}}</text>
            <text class="collection-date">{{item.collectedDate}}收藏</text>
          </view>
        </t-grid-item>
      </t-grid>
    </view>

    <!-- 底部安全区域 -->
    <view style="height: 120rpx;"></view>
  </scroll-view>
</view>
