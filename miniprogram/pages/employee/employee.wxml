<!--pages/employee/employee.wxml-->
<navigation-bar title="å‘˜å·¥ç®¡ç†" show-back="{{true}}" bind:back="goBack"></navigation-bar>

<view class="container">
  <!-- æƒé™æ£€æŸ¥ -->
  <view wx:if="{{!hasManagePermission && !hasInvitePermission}}" class="no-permission">
    <view class="no-permission-icon">ğŸ”’</view>
    <view class="no-permission-text">æ‚¨æ²¡æœ‰å‘˜å·¥ç®¡ç†æƒé™</view>
    <view class="no-permission-desc">è¯·è”ç³»ç®¡ç†å‘˜åˆ†é…ç›¸åº”æƒé™</view>
    <button class="join-btn" bindtap="showJoinOrganization">åŠ å…¥ç»„ç»‡</button>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="main-content">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <view class="page-header">
      <text class="page-title">å‘˜å·¥åˆ—è¡¨ ({{totalEmployees}})</text>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button wx:if="{{hasInvitePermission}}" class="invite-btn" bindtap="goToInviteManagement">
        <text class="icon">â•</text>
        é‚€è¯·ç®¡ç†
      </button>
      <button class="join-btn" bindtap="showJoinOrganization">
        <text class="icon">ğŸ”—</text>
        åŠ å…¥ç»„ç»‡
      </button>
    </view>

    <!-- å‘˜å·¥åˆ—è¡¨ -->
    <view class="employees-section">
      <view wx:if="{{loading}}" class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
      
      <view wx:elif="{{employees.length === 0}}" class="empty-state">
        <view class="empty-icon">ğŸ‘¥</view>
        <view class="empty-text">æš‚æ— å‘˜å·¥</view>
        <view class="empty-desc">ç‚¹å‡»é‚€è¯·ç®¡ç†åˆ›å»ºé‚€è¯·ç </view>
      </view>
      
      <view wx:else class="employee-list">
        <view class="employee-item" wx:for="{{employees}}" wx:key="_id">
          <view class="employee-avatar">
            <image src="{{item.avatarUrl || '/assets/icons/profile.png'}}" mode="aspectFill"></image>
            <view class="status-badge {{item.isActive ? 'active' : 'inactive'}}"></view>
          </view>
          
          <view class="employee-info">
            <view class="employee-name">{{item.nickname || 'æœªè®¾ç½®'}}</view>
            <view class="employee-role">{{item.position || 'æœªè®¾ç½®èŒä½'}} Â· {{item.department || 'æœªè®¾ç½®éƒ¨é—¨'}}</view>
            <view class="employee-meta">
              <text class="role-tag {{item.role}}">{{item.role === 'admin' ? 'ç®¡ç†å‘˜' : item.role === 'employee' ? 'å‘˜å·¥' : 'ç”¨æˆ·'}}</text>
              <text class="join-time">{{item.createTime}}</text>
            </view>
          </view>
          
          <view wx:if="{{hasManagePermission}}" class="employee-actions">
            <button class="action-btn edit" data-employee="{{item}}" bindtap="editEmployee">ç¼–è¾‘</button>
            <button class="action-btn remove" data-employee="{{item}}" bindtap="removeEmployee">ç§»é™¤</button>
          </view>
        </view>
      </view>
    </view>

  </view>
</view>


<!-- ç¼–è¾‘å‘˜å·¥å¯¹è¯æ¡† -->
<view wx:if="{{showEditDialog}}" class="dialog-overlay" bindtap="closeDialog">
  <view class="dialog-content" catchtap="">
    <view class="dialog-header">
      <text class="dialog-title">ç¼–è¾‘å‘˜å·¥</text>
      <text class="dialog-close" bindtap="closeDialog">âœ•</text>
    </view>
    
    <view class="dialog-body">
      <view class="form-group">
        <text class="form-label">éƒ¨é—¨</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥éƒ¨é—¨åç§°" value="{{editForm.department}}" bindinput="onEditDepartmentInput" />
      </view>
      
      <view class="form-group">
        <text class="form-label">èŒä½</text>
        <input class="form-input" placeholder="è¯·è¾“å…¥èŒä½åç§°" value="{{editForm.position}}" bindinput="onEditPositionInput" />
      </view>
      
      <view class="form-group">
        <text class="form-label">æƒé™è®¾ç½®</text>
        <checkbox-group data-type="edit" bindchange="onPermissionChange">
          <view class="permission-list">
            <label class="permission-item" wx:for="{{permissions}}" wx:key="*this" wx:for-index="permKey" wx:for-item="permName">
              <checkbox value="{{permKey}}" checked="{{editForm.permissions.includes(permKey)}}" />
              <text class="permission-name">{{permName}}</text>
            </label>
          </view>
        </checkbox-group>
      </view>
      
      <view class="form-group">
        <text class="form-label">çŠ¶æ€</text>
        <switch checked="{{editForm.isActive}}" bindchange="onEditActiveChange" />
        <text class="switch-label">{{editForm.isActive ? 'æ¿€æ´»' : 'åœç”¨'}}</text>
      </view>
    </view>
    
    <view class="dialog-footer">
      <button class="btn-cancel" bindtap="closeDialog">å–æ¶ˆ</button>
      <button class="btn-confirm" bindtap="saveEmployeeEdit">ä¿å­˜</button>
    </view>
  </view>
</view>

<!-- åŠ å…¥ç»„ç»‡å¯¹è¯æ¡† -->
<view wx:if="{{showJoinDialog}}" class="dialog-overlay" bindtap="closeDialog">
  <view class="dialog-content" catchtap="">
    <view class="dialog-header">
      <text class="dialog-title">åŠ å…¥ç»„ç»‡</text>
      <text class="dialog-close" bindtap="closeDialog">âœ•</text>
    </view>
    
    <view class="dialog-body">
      <view class="form-group">
        <text class="form-label">é‚€è¯·ç </text>
        <input class="form-input" placeholder="è¯·è¾“å…¥8ä½é‚€è¯·ç " value="{{joinForm.inviteCode}}" bindinput="onJoinCodeInput" maxlength="8" />
      </view>
      
      <view class="join-tip">
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">è¯·å‘æ‚¨çš„ç®¡ç†å‘˜è·å–é‚€è¯·ç </text>
      </view>
    </view>
    
    <view class="dialog-footer">
      <button class="btn-cancel" bindtap="closeDialog">å–æ¶ˆ</button>
      <button class="btn-confirm" bindtap="joinOrganization">åŠ å…¥</button>
    </view>
  </view>
</view>
