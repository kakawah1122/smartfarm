<!--production.wxml - 重新设计的生产管理页面-->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="生产管理"
    show-back="{{true}}"
    show-menu="{{true}}"
    show-record="{{false}}"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <!-- 主内容区域 -->
  <view class="main-content">
    <!-- Tab 导航 -->
    <t-tabs 
      value="{{activeTab}}" 
      bind:change="onTabChange" 
      theme="line" 
      class="main-tabs"
      sticky
      sticky-offset="{{navBarHeight}}"
    >
      <t-tab-panel label="入栏管理" value="entry" />
      <t-tab-panel label="出栏管理" value="exit" />
      <t-tab-panel label="物料管理" value="material" />
    </t-tabs>

    <!-- Tab 内容区域 -->
    <view class="tab-container">
      <!-- 入栏管理 -->
      <view wx:if="{{activeTab === 'entry'}}" class="tab-content">
        <!-- 数据概览 -->
        <view class="stats-section">
          <t-row gutter="16" class="overview-stats">
            <t-col span="8">
              <t-card>
                <view class="stat-content stat-primary">
                  <view class="stat-value">{{entryStats.total}}</view>
                  <view class="stat-label">总数量(羽)</view>
                </view>
              </t-card>
            </t-col>
            <t-col span="8">
              <t-card>
                <view class="stat-content stat-success">
                  <view class="stat-value">{{entryStats.survivalRate}}%</view>
                  <view class="stat-label">存活率</view>
                </view>
              </t-card>
            </t-col>
            <t-col span="8">
              <t-card>
                <view class="stat-content stat-warning">
                  <view class="stat-value">{{entryStats.batches}}</view>
                  <view class="stat-label">入栏批次</view>
                </view>
              </t-card>
            </t-col>
          </t-row>
        </view>

        <!-- 快速操作 -->
        <view class="quick-action">
          <t-button theme="primary" block icon="add" bind:tap="addEntry">
            新增入栏记录
          </t-button>
        </view>

        <!-- 记录列表 -->
        <view class="list-section">
          <view class="card list-card">
            <view class="card-header">
              <text class="card-title">最近入栏记录</text>
            </view>
            <view class="records-container">
              <!-- 空状态显示 -->
              <view wx:if="{{entryRecords.length === 0 && !loading}}" class="empty-state">
                <t-empty icon="file" description="暂无入栏记录">
                  <t-button theme="primary" size="small" bind:tap="addEntry">
                    立即添加
                  </t-button>
                </t-empty>
              </view>
              
              <!-- 记录列表 -->
              <view wx:for="{{entryRecords}}" wx:key="id" 
                    class="record-item" 
                    bind:tap="viewRecord" 
                    data-item="{{item}}">
                <view class="record-main">
                  <view class="record-header">
                    <text class="record-location">{{item.breed}}</text>
                    <t-tag theme="{{item.status === '已完成' ? 'success' : 'warning'}}" size="small">{{item.status}}</t-tag>
                  </view>
                  <view class="record-content">
                    <text class="record-symptoms">{{item.supplier}} • {{item.quantity}}羽</text>
                  </view>
                  <view class="record-footer">
                    <text class="record-date">{{item.date}}</text>
                  </view>
                </view>
                <view class="record-arrow">
                  <t-icon name="chevron-right" size="16" color="#c8c9cc" />
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 出栏管理 -->
      <view wx:if="{{activeTab === 'exit'}}" class="tab-content">
        <!-- 数据概览 -->
        <view class="stats-section">
          <t-row gutter="16" class="overview-stats">
            <t-col span="8">
              <t-card>
                <view class="stat-content stat-success">
                  <view class="stat-value">{{exitStats.total}}</view>
                  <view class="stat-label">总数量(羽)</view>
                </view>
              </t-card>
            </t-col>
            <t-col span="8">
              <t-card>
                <view class="stat-content stat-success">
                  <view class="stat-value">{{exitStats.batches}}</view>
                  <view class="stat-label">出栏批次</view>
                </view>
              </t-card>
            </t-col>
            <t-col span="8">
              <t-card>
                <view class="stat-content stat-primary">
                  <view class="stat-value">{{exitStats.avgWeight}}斤</view>
                  <view class="stat-label">平均重量</view>
                </view>
              </t-card>
            </t-col>
          </t-row>
        </view>

        <!-- 快速操作 -->
        <view class="quick-action">
          <t-button theme="primary" block icon="add" bind:tap="addExit">
            新增出栏记录
          </t-button>
        </view>

        <!-- 记录列表 -->
        <view class="list-section">
          <view class="card list-card">
            <view class="card-header">
              <text class="card-title">最近出栏记录</text>
            </view>
            <view class="records-container">
              <!-- 空状态显示 -->
              <view wx:if="{{exitRecords.length === 0 && !loading}}" class="empty-state">
                <t-empty icon="file" description="暂无出栏记录">
                  <t-button theme="primary" size="small" bind:tap="addExit">
                    立即添加
                  </t-button>
                </t-empty>
              </view>
              
              <!-- 记录列表 -->
              <view wx:for="{{exitRecords}}" wx:key="id" 
                    class="record-item" 
                    bind:tap="viewRecord" 
                    data-item="{{item}}">
                <view class="record-main">
                  <view class="record-header">
                    <text class="record-location">{{item.type}}</text>
                    <t-tag theme="{{item.status === '已交付' ? 'success' : 'primary'}}" size="small">{{item.status}}</t-tag>
                  </view>
                  <view class="record-content">
                    <text class="record-symptoms">{{item.customer}} • {{item.quantity}}羽 • 平均{{item.avgWeight}}斤</text>
                  </view>
                  <view class="record-footer">
                    <text class="record-date">{{item.date}}</text>
                  </view>
                </view>
                <view class="record-arrow">
                  <t-icon name="chevron-right" size="16" color="#c8c9cc" />
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 物料管理 -->
      <view wx:if="{{activeTab === 'material'}}" class="tab-content">
        <!-- 库存状态 -->
        <view class="stats-section">
          <t-row gutter="16" class="overview-stats">
            <t-col span="12">
              <t-card bind:tap="viewInventoryDetail">
                <view class="stat-content {{materialStats.feed > 0 ? 'stat-success' : 'stat-warning'}}">
                  <view class="stat-value">{{materialStats.feed}}吨</view>
                  <view class="stat-label">饲料库存</view>
                  <view class="stat-status {{materialStats.feed > 0 ? 'success' : 'warning'}}">{{materialStats.feed > 0 ? '状态良好' : '库存不足'}}</view>
                </view>
              </t-card>
            </t-col>
            <t-col span="12">
              <t-card bind:tap="viewInventoryDetail">
                <view class="stat-content {{materialStats.medicineStatus === '充足' ? 'stat-success' : 'stat-warning'}}">
                  <view class="stat-value">{{materialStats.medicineStatus}}</view>
                  <view class="stat-label">药品库存</view>
                  <view class="stat-status {{materialStats.medicineStatus === '充足' ? 'success' : 'warning'}}">{{materialStats.medicineStatus === '充足' ? '状态良好' : '需要补货'}}</view>
                </view>
              </t-card>
            </t-col>
          </t-row>
        </view>

        <!-- 快速操作 -->
        <view class="quick-action">
          <t-row gutter="16">
            <t-col span="12">
              <t-button theme="primary" block icon="add" bind:tap="purchaseMaterial">
                采购入库
              </t-button>
            </t-col>
            <t-col span="12">
              <t-button theme="warning" block icon="remove" bind:tap="useMaterial">
                物料领用
              </t-button>
            </t-col>
          </t-row>
        </view>

        <!-- 记录列表 -->
        <view class="list-section">
          <view class="card list-card">
            <view class="card-header">
              <text class="card-title">最近物料记录</text>
            </view>
            <view class="records-container">
              <!-- 加载状态 -->
              <view wx:if="{{loading}}" class="loading-state">
                <t-loading theme="spinner" size="40rpx" text="加载中..." />
              </view>
              
              <!-- 记录列表 - 直接显示，不用复杂条件 -->
              <view wx:if="{{!loading && materialRecords && materialRecords.length > 0}}">
                <view wx:for="{{materialRecords}}" wx:key="id" 
                      class="record-item" 
                      bind:tap="viewRecord" 
                      data-item="{{item}}">
                  <view class="record-main">
                    <view class="record-header">
                      <text class="record-location">{{item.name}}</text>
                      <t-tag theme="{{item.type === '采购' ? 'success' : 'warning'}}" size="small">{{item.type}}</t-tag>
                    </view>
                    <view class="record-content">
                      <text class="record-symptoms">{{item.description}} • {{item.quantity}}</text>
                    </view>
                    <view class="record-footer">
                      <text class="record-date">{{item.date}}</text>
                    </view>
                  </view>
                  <view class="record-arrow">
                    <t-icon name="chevron-right" size="16" color="#c8c9cc" />
                  </view>
                </view>
              </view>
              
              <!-- 空状态显示 -->
              <view wx:if="{{!loading && (!materialRecords || materialRecords.length === 0)}}" class="empty-state">
                <t-empty icon="file" description="暂无物料记录">
                  <t-button theme="primary" size="small" bind:tap="purchaseMaterial">
                    采购物料
                  </t-button>
                </t-empty>
              </view>
              
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>