<!--production.wxml-->
<view class="page-container">
  <!-- æ–°å¼å¯¼èˆªæ  -->
  <navigation-bar 
    title="ç”Ÿäº§ç®¡ç†"
    show-back="{{true}}"
    show-menu="{{true}}"
    show-record="{{false}}"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <!-- Tab åˆ‡æ¢ -->
  <t-tabs value="{{activeTab}}" bind:change="onTabChange" theme="line" class="production-tabs">
    <t-tab-panel label="å…¥æ ç®¡ç†" value="entry" />
    <t-tab-panel label="å‡ºæ ç®¡ç†" value="exit" />
    <t-tab-panel label="ç‰©æ–™ç®¡ç†" value="material" />
  </t-tabs>

  <scroll-view class="scroll-container" scroll-y style="padding-top: {{totalNavHeight + 120}}rpx;">
    <!-- å…¥æ ç®¡ç† -->
    <view wx:if="{{activeTab === 'entry'}}" class="tab-content">
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <t-grid class="stats-card" column="3" theme="card">
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value primary">{{entryStats.total}}</text>
            <text class="stat-label">æ€»æ•°é‡(ç¾½)</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value success">Â¥{{entryStats.amount}}ä¸‡</text>
            <text class="stat-label">æ€»é‡‘é¢</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value warning">{{entryStats.batches}}</text>
            <text class="stat-label">å…¥æ æ‰¹æ¬¡</text>
          </view>
        </t-grid-item>
      </t-grid>

      <!-- æ·»åŠ æŒ‰é’® -->
      <view class="action-section">
        <t-button theme="primary" size="large" block icon="add" bind:tap="addEntry">
          æ–°å¢å…¥æ è®°å½•
        </t-button>
      </view>

      <!-- è®°å½•åˆ—è¡¨ -->
      <view class="card list-card">
        <view class="card-header">
          <text class="card-title">æœ€è¿‘å…¥æ è®°å½•</text>
        </view>
        <t-cell-group class="record-list">
          <t-cell 
            wx:for="{{entryRecords}}" 
            wx:key="id"
            title="{{item.breed}}{{item.quality ? ' - ' + item.quality : ''}}"
            description="ä¾›åº”å•†ï¼š{{item.supplier}}"
            note="{{item.date}} â€¢ {{item.operator}}"
            left-icon="ğŸ¦¢"
            arrow
            bind:click="viewRecord"
            data-item="{{item}}"
          >
            <view slot="right" class="record-meta">
              <text class="record-quantity">{{item.quantity}}ç¾½</text>
              <text class="record-amount">Â¥{{item.amount}}</text>
            </view>
            <view slot="note" class="record-info">
              <text class="record-date">{{item.date}} â€¢ {{item.operator}}</text>
              <t-tag theme="{{item.status === 'å·²å®Œæˆ' ? 'success' : 'warning'}}" size="small">{{item.status}}</t-tag>
            </view>
          </t-cell>
        </t-cell-group>
      </view>
    </view>

    <!-- å‡ºæ ç®¡ç† -->
    <view wx:if="{{activeTab === 'exit'}}" class="tab-content">
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <t-grid class="stats-card" column="3" theme="card">
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value success">{{exitStats.total}}</text>
            <text class="stat-label">æ€»æ•°é‡(ç¾½)</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value success">Â¥{{exitStats.revenue}}ä¸‡</text>
            <text class="stat-label">æ€»æ”¶å…¥</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-item">
            <text class="stat-value primary">{{exitStats.avgWeight}}æ–¤</text>
            <text class="stat-label">å¹³å‡é‡é‡</text>
          </view>
        </t-grid-item>
      </t-grid>

      <!-- æ·»åŠ æŒ‰é’® -->
      <view class="action-section">
        <t-button theme="primary" size="large" block icon="add" bind:tap="addExit">
          æ–°å¢å‡ºæ è®°å½•
        </t-button>
      </view>

      <!-- è®°å½•åˆ—è¡¨ -->
      <view class="card list-card">
        <view class="card-header">
          <text class="card-title">æœ€è¿‘å‡ºæ è®°å½•</text>
        </view>
        <t-cell-group class="record-list">
          <t-cell 
            wx:for="{{exitRecords}}" 
            wx:key="id"
            title="{{item.type}}"
            description="å®¢æˆ·ï¼š{{item.customer}}"
            note="{{item.date}} â€¢ {{item.operator}} â€¢ å¹³å‡{{item.avgWeight}}æ–¤"
            left-icon="ğŸ“¦"
            arrow
            bind:click="viewRecord"
            data-item="{{item}}"
          >
            <view slot="right" class="record-meta">
              <text class="record-quantity">{{item.quantity}}ç¾½</text>
              <text class="record-amount success">Â¥{{item.revenue}}</text>
            </view>
            <view slot="note" class="record-info">
              <text class="record-date">{{item.date}} â€¢ {{item.operator}} â€¢ å¹³å‡{{item.avgWeight}}æ–¤</text>
              <t-tag theme="{{item.status === 'å·²äº¤ä»˜' ? 'success' : 'primary'}}" size="small">{{item.status}}</t-tag>
            </view>
          </t-cell>
        </t-cell-group>
      </view>
    </view>

    <!-- ç‰©æ–™ç®¡ç† -->
    <view wx:if="{{activeTab === 'material'}}" class="tab-content">
      <!-- åº“å­˜æ¦‚è§ˆ -->
      <t-grid class="stats-card" column="2" theme="card">
        <t-grid-item>
          <view class="inventory-item warning">
            <text class="inventory-label">é¥²æ–™åº“å­˜</text>
            <text class="inventory-value">{{materialStats.feed}}å¨</text>
            <text class="inventory-status">âš ï¸ åº“å­˜ä¸è¶³</text>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="inventory-item success">
            <text class="inventory-label">è¯å“åº“å­˜</text>
            <text class="inventory-value">å……è¶³</text>
            <text class="inventory-status">âœ… çŠ¶æ€è‰¯å¥½</text>
          </view>
        </t-grid-item>
      </t-grid>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-section">
        <t-row gutter="24" class="action-buttons">
          <t-col span="12">
            <t-button theme="primary" block size="large" icon="add" bind:tap="purchaseMaterial">
              é‡‡è´­å…¥åº“
            </t-button>
          </t-col>
          <t-col span="12">
            <t-button theme="warning" block size="large" icon="remove" bind:tap="useMaterial">
              ç‰©æ–™é¢†ç”¨
            </t-button>
          </t-col>
        </t-row>
      </view>

      <!-- ç‰©æ–™è®°å½• -->
      <view class="card list-card">
        <view class="card-header">
          <text class="card-title">æœ€è¿‘ç‰©æ–™è®°å½•</text>
        </view>
        <t-cell-group class="record-list">
          <t-cell 
            wx:for="{{materialRecords}}" 
            wx:key="id"
            title="{{item.name}}"
            description="{{item.type}}{{item.type === 'é‡‡è´­' ? 'å…¥åº“' : 'é¢†ç”¨'}} â€¢ {{item.description}}"
            note="{{item.date}} â€¢ {{item.operator}}"
            left-icon="{{item.type === 'é‡‡è´­' ? 'ğŸ“¥' : 'ğŸ“¤'}}"
            arrow
            bind:click="viewRecord"
            data-item="{{item}}"
          >
            <view slot="right" class="record-meta">
              <text class="record-quantity">{{item.quantity}}</text>
              <text class="record-amount {{item.type === 'é‡‡è´­' ? 'primary' : 'gray'}}">
                {{item.type === 'é‡‡è´­' ? 'Â¥' + item.amount : 'æ—¥å¸¸ä½¿ç”¨'}}
              </text>
            </view>
            <view slot="note" class="record-info">
              <text class="record-date">{{item.date}} â€¢ {{item.operator}}</text>
              <text class="record-stock">åº“å­˜: {{item.stock}}</text>
            </view>
          </t-cell>
        </t-cell-group>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view style="height: 120rpx;"></view>
  </scroll-view>
</view>
