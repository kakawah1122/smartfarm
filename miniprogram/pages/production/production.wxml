<!--production.wxml - 重新设计的生产管理页面-->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="生产管理"
    show-back="{{true}}"
    show-menu="{{true}}"
    show-record="{{false}}"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <!-- 主内容区域 -->
  <view class="main-content">
    <!-- Tab 导航 -->
    <t-tabs 
      value="{{activeTab}}" 
      bind:change="onTabChange" 
      theme="line" 
      class="main-tabs"
      sticky
      sticky-offset="{{navBarHeight}}"
    >
      <t-tab-panel label="入栏管理" value="entry" />
      <t-tab-panel label="出栏管理" value="exit" />
      <t-tab-panel label="物料管理" value="material" />
    </t-tabs>

    <!-- Tab 内容区域 -->
    <view class="tab-container">
      <!-- 入栏管理 -->
      <view wx:if="{{activeTab === 'entry'}}" class="tab-content">
        <!-- 数据概览 -->
        <t-grid class="overview-grid" column="3" theme="card">
          <t-grid-item>
            <view class="overview-item">
              <text class="overview-value primary">{{entryStats.total}}</text>
              <text class="overview-label">总数量(羽)</text>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="overview-item">
              <text class="overview-value success">¥{{entryStats.amount}}万</text>
              <text class="overview-label">总金额</text>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="overview-item">
              <text class="overview-value warning">{{entryStats.batches}}</text>
              <text class="overview-label">入栏批次</text>
            </view>
          </t-grid-item>
        </t-grid>

        <!-- 快速操作 -->
        <view class="quick-action">
          <t-button theme="primary" block icon="add" bind:tap="addEntry">
            新增入栏记录
          </t-button>
        </view>

        <!-- 记录列表 -->
        <t-cell-group title="最近入栏记录" class="record-group">
          <t-cell 
            wx:for="{{entryRecords}}" 
            wx:key="id"
            title="{{item.breed}}{{item.quality ? ' - ' + item.quality : ''}}"
            description="{{item.date}} • {{item.quantity}}羽"
            note="¥{{item.amount}}"
            left-icon="livestock"
            arrow
            bind:click="viewRecord"
            data-item="{{item}}"
          />
        </t-cell-group>
      </view>

      <!-- 出栏管理 -->
      <view wx:if="{{activeTab === 'exit'}}" class="tab-content">
        <!-- 数据概览 -->
        <t-grid class="overview-grid" column="3" theme="card">
          <t-grid-item>
            <view class="overview-item">
              <text class="overview-value success">{{exitStats.total}}</text>
              <text class="overview-label">总数量(羽)</text>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="overview-item">
              <text class="overview-value success">¥{{exitStats.revenue}}万</text>
              <text class="overview-label">总收入</text>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="overview-item">
              <text class="overview-value primary">{{exitStats.avgWeight}}斤</text>
              <text class="overview-label">平均重量</text>
            </view>
          </t-grid-item>
        </t-grid>

        <!-- 快速操作 -->
        <view class="quick-action">
          <t-button theme="primary" block icon="add" bind:tap="addExit">
            新增出栏记录
          </t-button>
        </view>

        <!-- 记录列表 -->
        <t-cell-group title="最近出栏记录" class="record-group">
          <t-cell 
            wx:for="{{exitRecords}}" 
            wx:key="id"
            title="{{item.type}}"
            description="{{item.date}} • {{item.quantity}}羽 • 平均{{item.avgWeight}}斤"
            note="¥{{item.revenue}}"
            left-icon="cart"
            arrow
            bind:click="viewRecord"
            data-item="{{item}}"
          />
        </t-cell-group>
      </view>

      <!-- 物料管理 -->
      <view wx:if="{{activeTab === 'material'}}" class="tab-content">
        <!-- 库存状态 -->
        <t-grid class="overview-grid" column="2" theme="card">
          <t-grid-item>
            <view class="overview-item warning">
              <text class="overview-value">{{materialStats.feed}}吨</text>
              <text class="overview-label">饲料库存</text>
              <text class="overview-status warning">库存不足</text>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="overview-item success">
              <text class="overview-value">充足</text>
              <text class="overview-label">药品库存</text>
              <text class="overview-status success">状态良好</text>
            </view>
          </t-grid-item>
        </t-grid>

        <!-- 快速操作 -->
        <view class="quick-action">
          <t-row gutter="16">
            <t-col span="12">
              <t-button theme="primary" block icon="add" bind:tap="purchaseMaterial">
                采购入库
              </t-button>
            </t-col>
            <t-col span="12">
              <t-button theme="warning" block icon="remove" bind:tap="useMaterial">
                物料领用
              </t-button>
            </t-col>
          </t-row>
        </view>

        <!-- 记录列表 -->
        <t-cell-group title="最近物料记录" class="record-group">
          <t-cell 
            wx:for="{{materialRecords}}" 
            wx:key="id"
            title="{{item.name}}"
            description="{{item.date}} • {{item.quantity}}"
            note="{{item.type === '采购' ? '¥' + item.amount : '领用'}}"
            left-icon="{{item.type === '采购' ? 'add-circle' : 'remove-circle'}}"
            arrow
            bind:click="viewRecord"
            data-item="{{item}}"
          />
        </t-cell-group>
      </view>
    </view>
  </view>
</view>