<!--pages/material-records-list/material-records-list.wxml-->
<view class="page page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="物料记录"
    show-back="true"
    show-menu="false"
    show-record="false"
    bind:back="goBack"
  />

  <!-- 主内容区域 -->
  <view class="main-content">
    
    <!-- 搜索栏 -->
    <view class="search-section">
      <t-search 
        value="{{searchKeyword || ''}}"
        placeholder="搜索物料名称或单据号"
        left-icon=""
        bind:change="onSearch"
        bind:submit="onSearch"
        class="search-bar"
      />
    </view>

    <!-- 筛选标签 -->
    <view class="filter-section">
      <t-tabs 
        value="{{activeFilter}}" 
        bind:change="onFilterChange" 
        theme="line"
        class="filter-tabs"
      >
        <t-tab-panel label="全部" value="all" />
        <t-tab-panel label="采购入库" value="purchase" />
        <t-tab-panel label="物料领用" value="use" />
      </t-tabs>
    </view>

    <!-- 统计信息 -->
    <view class="stats-section">
      <text class="stats-text">共{{totalRecords}}条记录</text>
    </view>

    <!-- 记录列表 -->
    <view class="records-section">
      
      <!-- 加载状态 -->
      <view wx:if="{{loading}}" class="loading-state">
        <t-loading theme="spinner" size="40rpx" text="加载中..." />
      </view>

      <!-- 记录列表 -->
      <view wx:if="{{!loading && records.length > 0}}" class="records-list">
        <view 
          wx:for="{{records}}" 
          wx:key="id" 
          class="record-item"
          bind:tap="viewRecordDetail"
          data-record="{{item}}"
        >
          <!-- 记录头部 -->
          <view class="record-header">
            <view class="record-title-row">
              <text class="record-name">{{item.name}}</text>
            </view>
          </view>

          <!-- 记录内容 - 分行显示 -->
          <view class="record-content">
            <!-- 第一行：单据 -->
            <view class="info-row" wx:if="{{item.recordNumber}}">
              <text class="info-label">单据：</text>
              <text class="info-value">{{item.recordNumber}}</text>
            </view>
            <!-- 第二行：分类 -->
            <view class="info-row" wx:if="{{item.category}}">
              <text class="info-label">分类：</text>
              <text class="info-value">{{item.category}}</text>
            </view>
            <!-- 第三行：数量 -->
            <view class="info-row" wx:if="{{item.quantity}}">
              <text class="info-label">数量：</text>
              <text class="info-value quantity-value">{{item.displayQuantity}}</text>
            </view>

            <!-- 底部：日期 + 操作员 -->
            <view class="record-footer">
              <text class="date-text">{{item.date}}</text>
              <text class="operator-text">{{item.operator}}</text>
            </view>
          </view>


        </view>
      </view>

      <!-- 加载更多状态 -->
      <view wx:if="{{loadingMore}}" class="loading-more">
        <t-loading theme="spinner" size="32rpx" text="加载更多..." />
      </view>

      <!-- 无更多数据提示 -->
      <view wx:if="{{!loading && !loadingMore && records.length > 0 && !hasMore}}" class="no-more">
        <text class="no-more-text">已显示全部记录</text>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{!loading && isEmpty}}" class="empty-state">
        <t-empty 
          description="{{activeFilter === 'all' ? '暂无物料记录' : (activeFilter === 'purchase' ? '暂无采购记录' : '暂无领用记录')}}"
        >
          <t-button theme="primary" size="small" bind:tap="goBack" class="primary-button">
            返回生产管理
          </t-button>
        </t-empty>
      </view>

    </view>
  </view>

  <!-- 物料记录详情弹窗组件 -->
  <material-record-detail-popup
    visible="{{showDetailPopup}}"
    record="{{selectedRecord}}"
    bind:close="closeDetailPopup"
  />

</view>
