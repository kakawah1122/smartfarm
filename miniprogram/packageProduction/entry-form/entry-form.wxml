<!--entry-form.wxml - 入栏记录表单页面-->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="新增入栏记录"
    show-back="true"
    show-menu="false"
    show-record="false"
    bind:back="goBack"
  />

  <!-- 表单内容区域 -->
  <view class="form-content">
    <!-- 主要表单 -->
    <view class="entry-form">
      <!-- 基础信息卡片 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">基础信息</text>
        </view>
        <view class="form-card">
          <!-- 批次ID显示 -->
          <view class="form-item">
            <view class="item-label">批次ID</view>
            <view class="item-input batch-id-display">
              <text class="batch-id-text">{{formData.batchId}}</text>
              <t-tag theme="primary" size="small" class="batch-tag">自动生成</t-tag>
            </view>
          </view>

          <!-- 入栏日期（使用原生 picker）-->
          <picker 
            mode="date" 
            value="{{formData.entryDate}}" 
            start="2020-01-01"
            end="{{maxDate}}"
            bind:change="onDateConfirm"
            class="picker-wrapper"
          >
            <view class="form-item">
              <view class="item-label required">入栏日期</view>
              <view class="item-input date-input">
                <text class="date-text">{{formData.entryDate || '请选择入栏日期'}}</text>
              </view>
            </view>
          </picker>

          <!-- 鹅苗品种 -->
          <view class="form-item">
            <view class="item-label required">鹅苗品种</view>
            <view class="item-input">
              <t-input
                placeholder="请输入鹅苗品种，如：白鹅苗"
                value="{{formData.breed}}"
                bind:change="onFieldChange"
                data-field="breed"
                borderless
                align="right"
              />
            </view>
          </view>


          <!-- 供应商 -->
          <view class="form-item">
            <view class="item-label required">供应商</view>
            <view class="item-input">
              <t-input
                placeholder="请输入供应商名称"
                value="{{formData.supplier}}"
                bind:change="onFieldChange"
                data-field="supplier"
                borderless
                align="right"
              />
            </view>
          </view>
        </view>
      </view>

      <!-- 采购信息卡片 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">采购信息</text>
        </view>
        <view class="form-card">
          <!-- 采购数量 -->
          <view class="form-item">
            <view class="item-label required">采购数量</view>
            <view class="item-input">
              <t-input
                placeholder="请输入数量"
                value="{{formData.quantity}}"
                type="number"
                bind:change="onFieldChange"
                data-field="quantity"
                suffix="羽"
                borderless
                align="right"
              />
            </view>
          </view>

          <!-- 单价 -->
          <view class="form-item">
            <view class="item-label required">单价</view>
            <view class="item-input">
              <t-input
                placeholder="请输入单价"
                value="{{formData.unitPrice}}"
                type="digit"
                bind:change="onFieldChange"
                data-field="unitPrice"
                suffix="元/羽"
                borderless
                align="right"
              />
            </view>
          </view>

          <!-- 总金额 -->
          <view class="form-item amount-item">
            <view class="item-label">总金额</view>
            <view class="item-value">
              <text class="amount-value">￥{{totalAmount}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 备注信息 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">备注</text>
        </view>
        <!-- ✅ 修复：使用 form-card 容器，与上方卡片框保持一致的安全边界 -->
        <view class="form-card">
          <view class="textarea-item">
            <view class="item-textarea">
              <t-textarea
                placeholder="请输入备注信息（可选）"
                value="{{formData.remarks}}"
                bind:change="onFieldChange"
                data-field="remarks"
                maxlength="200"
                indicator
                autosize
                class="item-textarea-input"
              />
            </view>
          </view>
        </view>
      </view>

      <!-- 提交按钮 -->
      <view class="form-actions">
        <t-button 
          theme="primary" 
          size="large" 
          block 
          bind:tap="onSubmit"
          loading="{{submitting}}"
          t-class="custom-form-button"
        >
          {{submitting ? '提交中...' : '提交入栏记录'}}
        </t-button>
        <t-button 
          theme="default" 
          size="large" 
          block 
          bind:tap="onReset"
          t-class="reset-button"
        >
          重置表单
        </t-button>
      </view>
    </view>
  </view>

  <!-- 重置表单确认弹窗 -->
  <bottom-popup
    visible="{{showResetConfirmPopup}}"
    title="确认重置"
    show-close="{{true}}"
    show-actions="{{true}}"
    cancel-text="取消"
    confirm-text="确认重置"
    bind:close="closeResetConfirmPopup"
    bind:cancel="closeResetConfirmPopup"
    bind:confirm="confirmReset"
  >
    <view class="confirm-content">
      <view class="warning-icon">🔄</view>
      <view class="warning-text">确定要重置表单吗？所有已填写的数据将被清空。</view>
    </view>
  </bottom-popup>

</view>