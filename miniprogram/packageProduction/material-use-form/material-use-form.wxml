<!--material-use-form.wxml - 物料领用表单页面-->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="物料领用申请"
    show-back="true"
    show-menu="false"
    show-record="false"
    bind:back="goBack"
  />

  <!-- 表单内容区域 -->
  <view class="form-content">
    <!-- 表单顶部信息卡片 -->
    <view class="form-header">
      <view class="form-card">
        <view class="header-info">
          <view class="batch-id-section">
            <view class="batch-label">申请单号</view>
            <view class="batch-id">{{formData.applicationId}}</view>
            <t-tag theme="primary" size="small">自动生成</t-tag>
          </view>
          <view class="date-info">
            <text class="date-text">{{formData.useDate || '请选择领用日期'}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 主要表单 -->
    <view class="entry-form">
      <!-- 基础信息卡片 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">基础信息</text>
        </view>
        <view class="form-card">
          <!-- 领用日期 -->
          <view class="form-item" bind:tap="showDatePicker">
            <view class="item-label required">领用日期</view>
            <view class="item-input date-input">
              <text class="date-text">{{formData.useDate || '请选择领用日期'}}</text>
              <t-icon name="calendar" size="32" color="#c8c9cc" />
            </view>
          </view>

          <!-- 物料名称 -->
          <view class="form-item" bind:tap="showMaterialPicker">
            <view class="item-label required">物料名称</view>
            <view class="item-input material-input">
              <text class="material-text">{{formData.materialName || '请选择库存物料'}}</text>
              <t-icon name="chevron-down" size="24" color="#666" />
            </view>
          </view>

          <!-- 领用用途 -->
          <view class="form-item">
            <view class="item-label required">领用用途</view>
            <view class="item-input">
              <t-input
                placeholder="请输入领用用途，如：1号鹅舍日常投喂"
                value="{{formData.purpose}}"
                bind:change="onFieldChange"
                data-field="purpose"
                borderless
                align="right"
              />
            </view>
          </view>

          <!-- 领用数量 -->
          <view class="form-item">
            <view class="item-label required">领用数量</view>
            <view class="item-input">
              <t-input
                placeholder="请输入数量"
                value="{{formData.quantity}}"
                type="digit"
                bind:change="onFieldChange"
                data-field="quantity"
                borderless
                align="right"
              />
            </view>
          </view>

        </view>
      </view>

      <!-- 备注信息 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">备注</text>
        </view>
        <!-- 备注输入框 - 左右满屏 -->
        <view class="fullwidth-textarea-container">
          <t-textarea
            placeholder="请输入备注信息（可选）"
            value="{{formData.remarks}}"
            bind:change="onFieldChange"
            data-field="remarks"
            maxlength="200"
            indicator
            autosize
            class="fullwidth-textarea"
          />
        </view>
      </view>

      <!-- 提交按钮 -->
      <view class="form-actions">
        <t-button 
          theme="primary" 
          size="large" 
          block 
          bind:tap="onSubmit"
          loading="{{submitting}}"
        >
          {{submitting ? '提交中...' : '提交领用申请'}}
        </t-button>
        <t-button 
          theme="default" 
          size="large" 
          block 
          bind:tap="onReset"
        >
          重置表单
        </t-button>
      </view>
    </view>
  </view>

  <!-- 日期选择器 -->
  <t-date-time-picker 
    visible="{{showDate}}"
    mode="date"
    value="{{dateValue}}"
    format="YYYY-MM-DD"
    bind:change="onDateChange"
    bind:cancel="hideDatePicker"
    bind:confirm="onDateConfirm"
  />

  <!-- 物料选择器已改为使用原生wx.showActionSheet -->
</view>
