<!--pages/entry-records-list/entry-records-list.wxml-->
<view class="page page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="入栏记录"
    show-back="true"
    show-menu="false"
    show-record="false"
    bind:back="goBack"
  />

  <!-- 主内容区域 -->
  <view class="main-content">
    
    <!-- 搜索栏 -->
    <view class="search-section">
      <t-search 
        value="{{searchKeyword || ''}}"
        placeholder="搜索品种或批次号"
        left-icon=""
        bind:change="onSearch"
        bind:submit="onSearch"
        class="search-bar"
      />
    </view>

    <!-- 统计信息 -->
    <view class="stats-section">
      <text class="stats-text">共{{totalRecords}}条记录</text>
    </view>

    <!-- 记录列表 -->
    <view class="records-section">
      
      <!-- 加载状态 -->
      <view wx:if="{{loading}}" class="loading-state">
        <t-loading theme="spinner" size="40rpx" text="加载中..." />
      </view>

      <!-- 记录列表 -->
      <view wx:if="{{!loading && records.length > 0}}" class="records-list">
        <view 
          wx:for="{{records}}" 
          wx:key="id" 
          class="record-item"
          bind:tap="viewRecordDetail"
          data-record="{{item}}"
        >
          <!-- 记录头部 -->
          <view class="record-header">
            <view class="record-title-row">
              <text class="record-name">{{item.displayTitle}}</text>
            </view>
          </view>

          <!-- 记录内容 - 双列布局，分行显示 -->
          <view class="record-content">
            <!-- 第一行：批次 + 数量 -->
            <view class="info-grid">
              <view class="info-column left-column">
                <view class="info-item">
                  <text class="info-label">批次：</text>
                  <text class="info-value">{{item.batchNumber}}</text>
                </view>
              </view>
              <view class="info-column right-column">
                <view class="info-item">
                  <text class="info-label">数量：</text>
                  <text class="info-value">{{item.displayQuantity}}</text>
                </view>
              </view>
            </view>
            
            <!-- 第二行：供应商 + 品种 -->
            <view class="info-grid" wx:if="{{item.supplier || item.breed}}">
              <view class="info-column left-column">
                <view class="info-item" wx:if="{{item.supplier}}">
                  <text class="info-label">供应商：</text>
                  <text class="info-value">{{item.supplier}}</text>
                </view>
              </view>
              <view class="info-column right-column">
                <view class="info-item" wx:if="{{item.breed}}">
                  <text class="info-label">品种：</text>
                  <text class="info-value">{{item.breed}}</text>
                </view>
              </view>
            </view>

            <!-- 底部：日期 + 操作员 -->
            <view class="record-footer">
              <text class="date-text">{{item.date}}</text>
              <text class="operator-text">{{item.operator}}</text>
            </view>
          </view>

        </view>
      </view>

      <!-- 加载更多状态 -->
      <view wx:if="{{loadingMore}}" class="loading-more">
        <t-loading theme="spinner" size="32rpx" text="加载更多..." />
      </view>

      <!-- 无更多数据提示 -->
      <view wx:if="{{!loading && !loadingMore && records.length > 0 && !hasMore}}" class="no-more">
        <text class="no-more-text">已显示全部记录</text>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{!loading && isEmpty}}" class="empty-state">
        <t-empty 
          description="暂无入栏记录"
        >
          <t-button theme="primary" size="small" bind:tap="addEntry" class="primary-button">
            新增入栏记录
          </t-button>
        </t-empty>
      </view>

    </view>
  </view>

  <!-- 入栏记录详情弹窗组件 -->
  <entry-record-detail-popup
    visible="{{showDetailPopup}}"
    record="{{selectedRecord}}"
    bind:close="closeDetailPopup"
  />

</view>
