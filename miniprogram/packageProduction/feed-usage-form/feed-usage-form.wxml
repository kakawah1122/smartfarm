<!--feed-usage-form.wxml - 饲料投喂记录表单页面-->
<view class="feed-usage-form-page">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="饲料投喂记录"
    show-back="{{true}}"
    fallbackUrl="/pages/production/production"
  />
  
  <!-- 表单容器 - 添加顶部间距避免被导航栏遮挡 -->
  <view class="form-container" style="padding-top: {{totalNavHeight}}rpx;">
    
    <!-- 投喂日期 -->
    <view class="form-section">
      <view class="section-title">投喂信息</view>
      
      <!-- 使用提示 -->
      <view class="usage-tip">
        <t-icon name="info-circle" size="28rpx" color="#0052d9" />
        <text class="tip-text">建议每周记录一次，填写本周投喂总量</text>
      </view>
      
      <view class="form-item" bindtap="showDatePicker">
        <view class="item-label required">投喂日期</view>
        <view class="item-value">
          <view class="value-text {{formData.recordDate ? '' : 'placeholder'}}">
            {{formData.recordDate || '请选择日期'}}
          </view>
        </view>
      </view>
      
      <!-- 选择批次 -->
      <view class="form-item" bindtap="showBatchPicker">
        <view class="item-label required">选择批次</view>
        <view class="item-value">
          <view class="value-text {{formData.batchNumber ? '' : 'placeholder'}}">
            {{formData.batchNumber || '请选择批次'}}
          </view>
        </view>
      </view>
      
      <!-- 当前存栏数 -->
      <view wx:if="{{currentStock > 0}}" class="stock-info-card">
        <view class="stock-info-item">
          <text class="stock-label">当前存栏</text>
          <text class="stock-value">{{currentStock}} 只</text>
        </view>
        <view wx:if="{{stockInfo}}" class="stock-details">
          <text class="detail-text">入栏: {{stockInfo.initialQuantity}}只</text>
          <text class="detail-text">死亡: {{stockInfo.totalDeathCount}}只</text>
          <text class="detail-text">出栏: {{stockInfo.totalExitCount}}只</text>
        </view>
      </view>
    </view>
    
    <!-- 饲料信息 -->
    <view class="form-section">
      <view class="section-title">饲料信息</view>
      
      <!-- 选择饲料 -->
      <view class="form-item" bindtap="showFeedPicker">
        <view class="item-label required">选择饲料</view>
        <view class="item-value">
          <view class="value-text {{formData.materialName ? '' : 'placeholder'}}">
            {{formData.materialName || '请选择饲料'}}
          </view>
        </view>
      </view>
      
      <!-- 饲料数量 -->
      <view class="form-item">
        <view class="item-label required">饲料数量</view>
        <view class="item-input">
          <input
            type="digit"
            placeholder="输入本周使用饲料总量"
            value="{{formData.quantity}}"
            data-field="quantity"
            bindinput="onFieldChange"
          />
          <text class="unit" wx:if="{{formData.unit}}">{{formData.unit}}</text>
        </view>
      </view>
      
      <!-- 成本预估 -->
      <view wx:if="{{estimatedCost !== '0.00' && currentStock > 0}}" class="cost-preview-card">
        <view class="cost-item">
          <text class="cost-label">单价</text>
          <text class="cost-value">¥{{unitPrice}}/{{formData.unit || '单位'}}</text>
        </view>
        <view class="cost-item">
          <text class="cost-label">预计成本</text>
          <text class="cost-value primary">¥{{estimatedCost}}</text>
        </view>
        <view class="cost-item">
          <text class="cost-label">单只成本</text>
          <text class="cost-value">¥{{costPerBird}}/只</text>
        </view>
      </view>
    </view>
    
    <!-- 备注 -->
    <view class="form-section">
      <view class="section-title">备注信息</view>
      
      <view class="form-item">
        <textarea
          class="textarea-input"
          placeholder="如：本周10月23-29日投喂记录（选填）"
          value="{{formData.notes}}"
          data-field="notes"
          bindinput="onFieldChange"
          maxlength="200"
          show-confirm-bar="{{false}}"
        />
      </view>
    </view>
    
    <!-- 操作按钮 -->
    <view class="button-group">
      <t-button
        theme="default"
        size="large"
        bindtap="onReset"
        disabled="{{submitting}}"
      >
        重置
      </t-button>
      <t-button
        theme="primary"
        size="large"
        bindtap="onSubmit"
        loading="{{submitting}}"
        disabled="{{submitting}}"
      >
        {{submitting ? '提交中...' : '提交记录'}}
      </t-button>
    </view>
  </view>
  
  <!-- 日期选择器 -->
  <t-date-time-picker
    visible="{{showDate}}"
    mode="date"
    title="选择投喂日期"
    value="{{dateValue}}"
    bindchange="onDateChange"
    bindconfirm="onDateConfirm"
    bindcancel="hideDatePicker"
  />
</view>

