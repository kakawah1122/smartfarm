<view class="page-container">
  <navigation-bar
    title="æ–‡ç« ç®¡ç†"
    show-back="{{true}}"
    bind:back="goBack"
  />

  <view class="content-wrapper">
    <!-- åˆ†ç±»ç­›é€‰ -->
    <view class="category-filter">
      <view
        wx:for="{{categories}}"
        wx:key="id"
        class="category-item {{activeCategory === item.id ? 'active' : ''}}"
        bind:tap="selectCategory"
        data-category="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>

    <!-- æ–‡ç« åˆ—è¡¨ -->
    <scroll-view class="scroll-container" scroll-y bind:scrolltolower="loadMore">
      <view wx:if="{{articleList.length > 0}}" class="article-list">
        <view
          wx:for="{{articleList}}"
          wx:key="_id"
          class="swipe-item-wrapper"
        >
          <!-- æ»‘åŠ¨æ“ä½œæŒ‰é’® -->
          <view class="swipe-actions">
            <view class="swipe-action-btn edit-btn" bind:tap="onSwipeEdit" data-id="{{item._id}}">
              <text class="swipe-action-icon">âœ</text>
              <text class="swipe-action-text">ç¼–è¾‘</text>
            </view>
            <view class="swipe-action-btn delete-btn" bind:tap="onSwipeDelete" data-id="{{item._id}}">
              <text class="swipe-action-icon">ğŸ—‘</text>
              <text class="swipe-action-text">åˆ é™¤</text>
            </view>
          </view>
          
          <!-- æ–‡ç« å¡ç‰‡ -->
          <view
            class="article-item {{swipedId === item._id ? 'swiped' : ''}}"
            style="transform: translateX({{swipedId === item._id ? swipeDistance : 0}}rpx);"
            bind:touchstart="onTouchStart"
            bind:touchmove="onTouchMove"
            bind:touchend="onTouchEnd"
            data-id="{{item._id}}"
            catch:tap="onItemTap"
          >
            <view class="article-content">
              <view class="article-header">
                <text class="article-title">{{item.title}}</text>
                <t-tag theme="{{item.categoryTheme || 'default'}}" size="small" class="article-tag">
                  {{item.categoryName}}
                </t-tag>
              </view>
              <view class="article-meta">
                <text class="meta-item">é˜…è¯»é‡ {{item.views || '0'}}</text>
                <text class="meta-divider">â€¢</text>
                <text class="meta-item">é˜…è¯»æ—¶é•¿ {{item.averageReadDuration ? item.averageReadDuration + 'åˆ†é’Ÿ' : 'æš‚æ— '}}</text>
                <text class="meta-divider">â€¢</text>
                <text class="meta-item">æ›´æ–° {{item.updateTimeFormatted || item.date || 'æœªçŸ¥'}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-state">
        <text class="empty-text">æš‚æ— æ–‡ç« </text>
      </view>
      
      <view wx:if="{{loading}}" class="loading-more">
        <t-loading theme="dots" size="40rpx" />
      </view>
      
      <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸå ä½ -->
      <view class="safe-area-bottom"></view>
    </scroll-view>
    
    <!-- åº•éƒ¨æ–°å»ºæ–‡ç« æŒ‰é’® -->
    <view class="bottom-action-bar">
      <t-button theme="primary" size="large" bind:tap="showCreateForm" class="create-button">
        æ–°å»ºæ–‡ç« 
      </t-button>
    </view>
  </view>

  <!-- ç¼–è¾‘/åˆ›å»ºå¼¹çª— -->
  <view wx:if="{{showForm}}" class="form-modal" catchtap="closeForm">
    <view class="form-content" catchtap="stopPropagation">
      <view class="form-header">
        <text class="form-title">{{editingArticle ? 'ç¼–è¾‘æ–‡ç« ' : 'æ–°å»ºæ–‡ç« '}}</text>
        <text class="form-close" bind:tap="closeForm">Ã—</text>
      </view>
      
      <scroll-view class="form-scroll" scroll-y>
        <!-- æ–‡æœ¬è§£æ -->
        <view class="form-section">
          <view class="section-title">å¿«é€Ÿå¡«å……</view>
          <t-textarea
            placeholder="ç²˜è´´æ–‡ç« å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£ææ ‡é¢˜ã€æè¿°ç­‰ä¿¡æ¯..."
            value="{{parseText}}"
            bind:change="onParseTextChange"
            maxlength="5000"
            autosize
            class="parse-textarea"
          />
          <t-button theme="default" size="small" bind:tap="parseText" class="parse-btn">
            è§£ææ–‡æœ¬
          </t-button>
        </view>

        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
          
          <view class="form-item">
            <view class="form-label">æ ‡é¢˜ *</view>
            <t-input
              value="{{formData.title}}"
              bind:change="onFormChange"
              data-field="title"
              placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜"
            />
          </view>

          <view class="form-item">
            <view class="form-label">æè¿°</view>
            <t-textarea
              value="{{formData.description}}"
              bind:change="onFormChange"
              data-field="description"
              placeholder="è¯·è¾“å…¥æ–‡ç« æè¿°"
              maxlength="200"
              autosize
            />
          </view>

          <view class="form-item">
            <view class="form-label required">æ–‡ç« åˆ†ç±» *</view>
            <picker
              mode="selector"
              value="{{categoryIndex}}"
              range="{{categories}}"
              range-key="name"
              bind:change="onCategoryChange"
            >
              <view class="picker-display {{formData.categoryName ? '' : 'placeholder'}}">
                <text>{{formData.categoryName || 'è¯·é€‰æ‹©æ–‡ç« åˆ†ç±»'}}</text>
                <text class="picker-arrow">â€º</text>
              </view>
            </picker>
          </view>

          <view class="form-item">
            <view class="form-label">å‘å¸ƒæ—¥æœŸ</view>
            <picker mode="date" value="{{formData.date}}" bind:change="onDateChange">
              <view class="picker-display {{formData.date ? '' : 'placeholder'}}">
                <text>{{formData.date || 'è¯·é€‰æ‹©å‘å¸ƒæ—¥æœŸ'}}</text>
                <text class="picker-arrow">â€º</text>
              </view>
            </picker>
          </view>
        </view>

        <!-- æ–‡ç« å†…å®¹ -->
        <view class="form-section">
          <view class="section-title">æ–‡ç« å†…å®¹ *</view>
          <t-textarea
            value="{{formData.content}}"
            bind:change="onFormChange"
            data-field="content"
            placeholder="è¯·è¾“å…¥æ–‡ç« å†…å®¹ï¼Œæ”¯æŒæ¢è¡Œ"
            maxlength="10000"
            autosize
            class="content-textarea"
          />
        </view>
      </scroll-view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="form-actions">
        <t-button theme="default" bind:tap="closeForm">å–æ¶ˆ</t-button>
        <t-button theme="primary" bind:tap="saveArticle">ä¿å­˜</t-button>
      </view>
    </view>
  </view>

  <t-message id="t-message" />
</view>




