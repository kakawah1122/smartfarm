<!--manual-record-form.wxml - 手动记账表单页面-->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="手动记账"
    show-back="true"
    show-menu="false"
    show-record="false"
    bind:back="goBack"
  />

  <!-- 表单内容区域 -->
  <scroll-view class="form-content" scroll-y>
    <view class="entry-form">
      <!-- 记账类型选择 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">记账类型</text>
        </view>
        <view class="form-card">
          <radio-group class="radio-group" bindchange="onRecordTypeChange">
            <label class="radio-item">
              <radio value="expense" checked="{{recordType === 'expense'}}" color="#0052d9" />
              <text class="radio-label">支出</text>
            </label>
            <label class="radio-item">
              <radio value="income" checked="{{recordType === 'income'}}" color="#0052d9" />
              <text class="radio-label">收入</text>
            </label>
          </radio-group>
        </view>
      </view>

      <!-- 基础信息卡片 -->
      <view class="form-section">
        <view class="section-header">
          <text class="section-title">基础信息</text>
        </view>
        <view class="form-card">
          <!-- 记录日期 -->
          <picker 
            mode="date" 
            value="{{formData.recordDate}}" 
            start="2020-01-01"
            end="{{maxDate}}"
            bind:change="onDateChange"
          >
            <view class="form-item">
              <view class="item-label required">记录日期</view>
              <view class="item-input date-input">
                <text class="date-text">{{formData.recordDate || '请选择记录日期'}}</text>
              </view>
            </view>
          </picker>

          <!-- 类型选择（根据记账类型显示不同选项） -->
          <picker
            mode="selector"
            range="{{typeOptions}}"
            range-key="label"
            value="{{typeIndex}}"
            bind:change="onTypeChange"
          >
            <view class="form-item">
              <view class="item-label required">{{recordType === 'expense' ? '支出类型' : '收入类型'}}</view>
              <view class="item-input picker-input">
                <text class="picker-text">{{formData.typeLabel || (recordType === 'expense' ? '请选择支出类型' : '请选择收入类型')}}</text>
              </view>
            </view>
          </picker>

          <!-- 金额 -->
          <view class="form-item">
            <view class="item-label required">金额</view>
            <view class="item-input">
              <t-input
                type="digit"
                placeholder="请输入金额"
                value="{{formData.amount}}"
                bind:change="onFieldChange"
                data-field="amount"
                borderless
                align="right"
                suffix="元"
              />
            </view>
          </view>

          <!-- 描述 -->
          <view class="form-item">
            <view class="item-label required">描述</view>
            <view class="item-input">
              <t-input
                placeholder="请输入简要描述"
                value="{{formData.description}}"
                bind:change="onFieldChange"
                data-field="description"
                borderless
                align="right"
              />
            </view>
          </view>

          <!-- 发票号（可选） -->
          <view class="form-item">
            <view class="item-label">发票号</view>
            <view class="item-input">
              <t-input
                placeholder="请输入发票号（可选）"
                value="{{formData.invoiceNumber}}"
                bind:change="onFieldChange"
                data-field="invoiceNumber"
                borderless
                align="right"
              />
            </view>
          </view>

          <!-- 上传单据 -->
          <view class="form-item form-item-vertical upload-item">
            <view class="item-label">单据附件</view>
            <view class="upload-container">
              <view class="upload-list">
                <view 
                  wx:for="{{uploadedFiles}}" 
                  wx:key="fileID" 
                  class="upload-item-preview"
                >
                  <image 
                    class="preview-image" 
                    src="{{item.fileID}}" 
                    mode="aspectFill"
                    bind:tap="previewImage"
                    data-url="{{item.fileID}}"
                  />
                  <view class="delete-btn" bind:tap="deleteImage" data-index="{{index}}">
                    <text class="delete-icon">×</text>
                  </view>
                </view>
                <view 
                  wx:if="{{uploadedFiles.length < 5}}"
                  class="upload-btn" 
                  bind:tap="chooseImage"
                >
                  <text class="upload-text">上传单据</text>
                </view>
              </view>
            </view>
          </view>

          <!-- 备注 -->
          <view class="form-item form-item-vertical">
            <view class="item-label">备注</view>
            <view class="item-textarea">
              <t-textarea
                placeholder="请输入备注信息（可选）"
                value="{{formData.notes}}"
                bind:change="onFieldChange"
                data-field="notes"
                maxlength="200"
                indicator
                autosize="{{true}}"
              />
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部操作按钮 -->
  <view class="bottom-actions">
    <t-button 
      theme="default" 
      size="large" 
      bind:tap="onReset"
      class="action-button reset-button"
    >
      重置
    </t-button>
    <t-button 
      theme="primary" 
      size="large" 
      bind:tap="onSubmit"
      loading="{{submitting}}"
      class="action-button submit-button"
    >
      提交
    </t-button>
  </view>
</view>
