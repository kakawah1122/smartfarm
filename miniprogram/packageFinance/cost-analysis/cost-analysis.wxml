<!--cost-analysis.wxml - 成本分析页面-->
<view class="page cost-analysis-page">
  <!-- 导航栏 -->
  <navigation-bar 
    title="成本分析"
    show-back="true"
    show-menu="false"
    bind:back="goBack"
  />

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <t-loading theme="circular" size="40rpx" />
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 内容区域 -->
  <view wx:else class="content-container">
    
    <!-- 日期范围选择 -->
    <view class="date-range-selector">
      <t-radio-group value="{{dateRange}}" bind:change="onDateRangeChange" theme="primary">
        <t-radio name="week" label="本周" />
        <t-radio name="month" label="本月" />
        <t-radio name="quarter" label="本季度" />
        <t-radio name="year" label="本年度" />
      </t-radio-group>
    </view>

    <!-- 成本总览 -->
    <view class="overview-card">
      <view class="overview-header">
        <text class="card-title">成本总览</text>
        <view class="trend-indicator trend-{{overview.trend}}">
          <t-icon name="{{overview.trend === 'decreasing' ? 'arrow-down' : 'arrow-up'}}" size="16" />
          <text>{{overview.monthlyChange}}%</text>
        </view>
      </view>
      
      <view class="overview-main">
        <view class="main-cost">
          <text class="cost-value">¥{{overview.totalCost}}</text>
          <text class="cost-label">总健康成本</text>
        </view>
        <view class="cost-breakdown">
          <view class="breakdown-item">
            <text class="breakdown-value">¥{{overview.preventionCost}}</text>
            <text class="breakdown-label">预防成本</text>
          </view>
          <view class="breakdown-item">
            <text class="breakdown-value">¥{{overview.treatmentCost}}</text>
            <text class="breakdown-label">治疗成本</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 成本构成分析 -->
    <view class="cost-breakdown-card">
      <text class="card-title">成本构成分析</text>
      <view class="breakdown-chart">
        <view class="chart-legend">
          <view 
            class="legend-item"
            wx:for="{{costBreakdown}}"
            wx:key="category"
          >
            <view class="legend-color" style="background-color: {{item.color}}"></view>
            <text class="legend-text">{{item.category}}</text>
            <text class="legend-percentage">{{item.percentage}}%</text>
          </view>
        </view>
      </view>
      
      <view class="breakdown-list">
        <view 
          class="breakdown-item"
          wx:for="{{costBreakdown}}"
          wx:key="category"
          bind:tap="onCategoryDetail"
          data-category="{{item}}"
        >
          <view class="item-info">
            <view class="item-header">
              <view class="category-indicator" style="background-color: {{item.color}}"></view>
              <text class="category-name">{{item.category}}</text>
            </view>
            <view class="amount-info">
              <text class="amount-value">¥{{item.amount}}</text>
              <text class="amount-percentage">{{item.percentage}}%</text>
            </view>
          </view>
          <view class="progress-bar">
            <view 
              class="progress-fill" 
              style="width: {{item.percentage}}%; background-color: {{item.color}}"
            ></view>
          </view>
        </view>
      </view>
    </view>

    <!-- 月度趋势 -->
    <view class="trend-card">
      <text class="card-title">月度趋势</text>
      <view class="trend-chart">
        <view class="chart-container">
          <view 
            class="trend-bar"
            wx:for="{{monthlyTrend}}"
            wx:key="month"
          >
            <view class="bar-stack">
              <view 
                class="prevention-bar" 
                style="height: {{item.prevention / 200}}rpx"
              ></view>
              <view 
                class="treatment-bar" 
                style="height: {{item.treatment / 200}}rpx"
              ></view>
            </view>
            <text class="month-label">{{item.month}}</text>
            <text class="total-value">¥{{item.total}}</text>
          </view>
        </view>
        
        <view class="chart-legend">
          <view class="legend-item">
            <view class="legend-color prevention"></view>
            <text>预防成本</text>
          </view>
          <view class="legend-item">
            <view class="legend-color treatment"></view>
            <text>治疗成本</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ROI分析 -->
    <view class="roi-card">
      <text class="card-title">投资回报率分析</text>
      <view class="roi-overview">
        <view class="roi-main">
          <text class="roi-value">{{roi.roiRatio}}:1</text>
          <text class="roi-label">投资回报比</text>
        </view>
        <view class="roi-details">
          <view class="roi-item">
            <text class="roi-desc">总投入</text>
            <text class="roi-amount">¥{{roi.totalInvestment}}</text>
          </view>
          <view class="roi-item">
            <text class="roi-desc">避免损失</text>
            <text class="roi-amount success">¥{{roi.preventedLoss}}</text>
          </view>
          <view class="roi-item">
            <text class="roi-desc">实际损失</text>
            <text class="roi-amount warning">¥{{roi.actualLoss}}</text>
          </view>
          <view class="roi-item">
            <text class="roi-desc">净收益</text>
            <text class="roi-amount primary">¥{{roi.netBenefit}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 优化建议 -->
    <view class="suggestions-card">
      <text class="card-title">优化建议</text>
      <view class="suggestions-list">
        <view 
          class="suggestion-item"
          wx:for="{{suggestions}}"
          wx:key="category"
          bind:tap="onSuggestionDetail"
          data-suggestion="{{item}}"
        >
          <view class="suggestion-content">
            <view class="suggestion-header">
              <text class="suggestion-category">{{item.category}}</text>
              <view class="priority-badge priority-{{item.priority}}">
                {{item.priority === 'high' ? '高' : item.priority === 'medium' ? '中' : '低'}}
              </view>
            </view>
            <text class="suggestion-text">{{item.suggestion}}</text>
            <view class="suggestion-saving">
              <text class="saving-label">预计节省:</text>
              <text class="saving-value">¥{{item.potentialSaving}}</text>
            </view>
          </view>
          <view class="suggestion-arrow">
            <t-icon name="chevron-right" size="16" color="#c8c9cc" />
          </view>
        </view>
      </view>
    </view>

    <!-- 对比分析 -->
    <view class="comparison-card">
      <text class="card-title">对比分析</text>
      <view class="comparison-grid">
        <view class="comparison-item">
          <text class="comparison-label">上月</text>
          <text class="comparison-value">¥{{comparison.lastMonth}}</text>
        </view>
        <view class="comparison-item">
          <text class="comparison-label">去年同期</text>
          <text class="comparison-value">¥{{comparison.lastYear}}</text>
        </view>
        <view class="comparison-item">
          <text class="comparison-label">行业均值</text>
          <text class="comparison-value">¥{{comparison.industryAverage}}</text>
        </view>
        <view class="comparison-item">
          <text class="comparison-label">最佳实践</text>
          <text class="comparison-value">¥{{comparison.bestPractice}}</text>
        </view>
      </view>
    </view>

    <!-- 操作区域 -->
    <view class="actions-section">
      <t-button 
        theme="primary" 
        size="large" 
        block
        bind:tap="exportReport"
      >
        导出成本分析报告
      </t-button>
    </view>

    <!-- 底部安全区域 -->
    <view style="height: 120rpx;"></view>
  </view>
</view>
