<view class="page-container">
  <!-- æ–°å¼å¯¼èˆªæ  -->
  <navigation-bar 
    title="è´¢åŠ¡ç®¡ç†"
    show-back="true"
    show-menu="true"
    show-record="false"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <scroll-view class="scroll-container" scroll-y>
    <!-- è´¢åŠ¡æ¦‚è§ˆå¡ç‰‡ -->
    <view class="card overview-card" style="margin-bottom: 0 !important;">
      <view class="card-content" style="padding-bottom: 0 !important;">
        <view class="overview-header">
          <text class="overview-title">è´¢åŠ¡æ¦‚è§ˆ</text>
          <picker 
            mode="selector" 
            range="{{batchOptions}}" 
            range-key="label"
            value="{{selectedBatchIndex}}"
            bind:change="onBatchPickerChange"
          >
            <text class="batch-filter-text">{{selectedBatchLabel}}</text>
          </picker>
        </view>
        
        <!-- æ”¶æ”¯å¯¹æ¯” -->
        <view class="comparison-section">
          <view class="comparison-data">
            <view class="data-item">
              <text class="data-value danger">Â¥{{overview.income}}ä¸‡</text>
              <text class="data-label">æ€»æ”¶å…¥</text>
            </view>
            <view class="data-item">
              <text class="data-value {{overview.profitColorClass}}">Â¥{{overview.profit}}ä¸‡</text>
              <text class="data-label">å‡€åˆ©æ¶¦</text>
            </view>
            <view class="data-item">
              <text class="data-value success">Â¥{{overview.expense}}ä¸‡</text>
              <text class="data-label">æ€»æ”¯å‡º</text>
            </view>
          </view>
        </view>

        <!-- æˆæœ¬æ„æˆ -->
        <view class="cost-grid" style="margin-bottom: 0 !important; padding-bottom: 0 !important;">
          <view class="cost-item orange">
            <text class="cost-label">é¥²æ–™æˆæœ¬</text>
            <text class="cost-value">Â¥{{overview.feedCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.feedPercent}}%</text>
          </view>
          <view class="cost-item purple">
            <text class="cost-label">äººå·¥æˆæœ¬</text>
            <text class="cost-value">Â¥{{overview.laborCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.laborPercent}}%</text>
          </view>
          <view class="cost-item yellow">
            <text class="cost-label">åŒ»ç–—è´¹ç”¨</text>
            <text class="cost-value">Â¥{{overview.medicalCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.medicalPercent}}%</text>
          </view>
          <view class="cost-item gray">
            <text class="cost-label">å…¶ä»–è´¹ç”¨</text>
            <text class="cost-value">Â¥{{overview.otherCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.otherPercent}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢ -->
    <t-tabs value="{{activeTab}}" bind:change="onTabChange" theme="line" t-class="finance-tabs" style="margin-top: 0 !important; padding-top: 0 !important;">
      <t-tab-panel label="æ”¶æ”¯æ˜ç»†" value="records" />
      <t-tab-panel label="è´¢åŠ¡æŠ¥è¡¨" value="reports" />
      <t-tab-panel label="å®¡æ‰¹ç®¡ç†" value="approval" />
    </t-tabs>

    <!-- æ”¶æ”¯æ˜ç»†é¡µé¢ -->
    <view wx:if="{{activeTab === 'records'}}" class="tab-content" style="margin-top: 0 !important; padding-top: 0 !important;">
      <!-- äº¤æ˜“è®°å½• -->
      <view class="card" style="margin-top: 0 !important;">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">æœ€è¿‘äº¤æ˜“è®°å½•</text>
          </view>
          <view class="records-list">
            <view 
              wx:for="{{filteredRecords}}" 
              wx:key="id"
              class="record-item"
              bind:tap="viewRecordDetail"
              data-item="{{item}}"
            >
              <view class="record-left">
                <view class="record-content">
                  <view class="record-title">{{item.title}}</view>
                  <view class="record-desc">{{item.description}}</view>
                  <view class="record-footer">
                    <text class="record-time">{{item.date}}</text>
                    <t-tag theme="{{item.statusTheme || 'default'}}" size="small" class="record-status">{{item.status || 'æœªçŸ¥'}}</t-tag>
                  </view>
                </view>
              </view>
              <view class="record-right">
                <view class="record-amount {{item.type}}">
                  {{item.type === 'income' ? '+' : '-'}}Â¥{{item.amount}}
                </view>
                <view class="record-source">
                  {{item.autoGenerated ? 'è‡ªåŠ¨ç”Ÿæˆ' : 'æ‰‹åŠ¨å½•å…¥'}}
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è´¢åŠ¡æŠ¥è¡¨é¡µé¢ -->
    <view wx:if="{{activeTab === 'reports'}}" class="tab-content">
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">è´¢åŠ¡æŠ¥è¡¨</text>
          </view>
          
          <!-- è¶‹åŠ¿å›¾å ä½ -->
          <view class="chart-section">
            <text class="chart-header">æ”¶æ”¯è¶‹åŠ¿å›¾</text>
            <view class="chart-placeholder">
              <text class="chart-text">ğŸ“Š å›¾è¡¨å ä½åŒºåŸŸ</text>
            </view>
          </view>

          <!-- åŒæ¯”åˆ†æ -->
          <view class="analysis-grid">
            <view class="analysis-item success">
              <text class="analysis-title">åŒæ¯”å¢é•¿</text>
              <text class="analysis-value">+{{reports.yearGrowth}}%</text>
              <text class="analysis-desc">è¾ƒå»å¹´åŒæœŸ</text>
            </view>
            <view class="analysis-item primary">
              <text class="analysis-title">åˆ©æ¶¦ç‡</text>
              <text class="analysis-value">{{reports.profitRate}}%</text>
              <text class="analysis-desc">è¾ƒä¸Šæœˆæå‡</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®¡æ‰¹ç®¡ç†é¡µé¢ -->
    <view wx:if="{{activeTab === 'approval'}}" class="tab-content">
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">å¾…å®¡æ‰¹äº‹é¡¹</text>
          </view>
          
          <view class="approval-list">
            <view 
              wx:for="{{approvalItems}}" 
              wx:key="id"
              class="approval-item"
              bind:tap="viewApprovalDetail"
              data-item="{{item}}"
            >
              <view class="approval-left">
                <view class="approval-content">
                  <view class="approval-title">{{item.applicant}} - {{item.title}}</view>
                  <view class="approval-desc">{{item.description}}</view>
                  <view class="approval-footer">
                    <text class="approval-time">æäº¤æ—¶é—´ï¼š{{item.submitTime}}</text>
                  </view>
                </view>
              </view>
              <view class="approval-right">
                <view class="approval-amount">
                  Â¥{{item.amount}}
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- AIè´¢åŠ¡åˆ†æ -->
    <view class="card ai-analysis-card">
      <view class="card-content">
        <view class="ai-header">
          <view class="ai-icon">
            <text>ğŸ¤–</text>
          </view>
          <view class="ai-info">
            <text class="ai-title">AIè´¢åŠ¡åˆ†æ</text>
            <text class="ai-subtitle">æ™ºèƒ½æˆæœ¬ä¼˜åŒ–ä¸ç›ˆåˆ©é¢„æµ‹</text>
          </view>
          <t-button wx:if="{{!aiAnalysis.loading}}" size="small" theme="primary" bind:tap="generateFinancialAnalysis" class="ai-button primary-button">
            {{aiAnalysis.result ? 'é‡æ–°åˆ†æ' : 'å¼€å§‹åˆ†æ'}}
          </t-button>
        </view>
        
        <!-- AIåˆ†æè¿›è¡Œä¸­ -->
        <view wx:if="{{aiAnalysis.loading}}" class="ai-loading">
          <t-loading theme="spinner" size="40rpx" />
          <text class="loading-text">AIæ­£åœ¨åˆ†æè´¢åŠ¡æ•°æ®...</text>
        </view>
        
        <!-- AIåˆ†æç»“æœ -->
        <view wx:elif="{{aiAnalysis.result}}" class="ai-analysis-content">
          <!-- è´¢åŠ¡å¥åº·åº¦è¯„çº§ -->
          <view class="financial-health">
            <view class="health-header">
              <text class="health-title">ğŸ“Š è´¢åŠ¡å¥åº·åº¦</text>
              <view class="health-score {{aiAnalysis.result.healthLevel}}">
                {{aiAnalysis.result.healthScore}}åˆ†
              </view>
            </view>
            <view class="health-indicators">
              <view wx:for="{{aiAnalysis.result.healthIndicators}}" wx:key="category" class="health-indicator">
                <text class="indicator-name">{{item.category}}</text>
                <view class="indicator-bar">
                  <view class="bar-fill {{item.level}}" style="width: {{item.score}}%"></view>
                </view>
                <text class="indicator-score">{{item.score}}</text>
              </view>
            </view>
          </view>
          
          <!-- æˆæœ¬ä¼˜åŒ–å»ºè®® -->
          <view class="cost-optimization">
            <text class="section-title">ğŸ’° æˆæœ¬ä¼˜åŒ–å»ºè®®</text>
            <view class="optimization-list">
              <view wx:for="{{aiAnalysis.result.costOptimization}}" wx:key="category" class="optimization-item">
                <view class="opt-header">
                  <text class="opt-category">{{item.category}}</text>
                  <text class="opt-saving">èŠ‚çœ Â¥{{item.potentialSaving}}</text>
                </view>
                <text class="opt-recommendation">{{item.recommendation}}</text>
                <view class="opt-details">
                  <text class="opt-impact">é¢„æœŸæ•ˆæœï¼š{{item.expectedImpact}}</text>
                  <text class="opt-timeline">å®æ–½å‘¨æœŸï¼š{{item.timeline}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- ç›ˆåˆ©é¢„æµ‹ -->
          <view class="profit-forecast">
            <text class="section-title">ğŸ“ˆ ç›ˆåˆ©é¢„æµ‹</text>
            <view class="forecast-chart">
              <view class="chart-header">
                <text class="chart-title">æœªæ¥3ä¸ªæœˆé¢„æµ‹</text>
                <text class="forecast-confidence">é¢„æµ‹å‡†ç¡®åº¦: {{aiAnalysis.result.forecastConfidence}}%</text>
              </view>
              <view class="monthly-forecast">
                <view wx:for="{{aiAnalysis.result.monthlyForecast}}" wx:key="month" class="forecast-month">
                  <text class="month-name">{{item.month}}</text>
                  <view class="forecast-metrics">
                    <view class="metric-item">
                      <text class="metric-label">é¢„æµ‹æ”¶å…¥</text>
                      <text class="metric-value income">Â¥{{item.income}}ä¸‡</text>
                    </view>
                    <view class="metric-item">
                      <text class="metric-label">é¢„æµ‹æ”¯å‡º</text>
                      <text class="metric-value expense">Â¥{{item.expense}}ä¸‡</text>
                    </view>
                    <view class="metric-item">
                      <text class="metric-label">å‡€åˆ©æ¶¦</text>
                      <text class="metric-value profit">Â¥{{item.profit}}ä¸‡</text>
                    </view>
                  </view>
                  <view class="profit-trend {{item.trendDirection}}">
                    {{item.trendDirection === 'up' ? 'â†—' : item.trendDirection === 'down' ? 'â†˜' : 'â†’'}} {{item.trendText}}
                  </view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- æŠ•èµ„å»ºè®® -->
          <view class="investment-advice">
            <text class="section-title">ğŸ’¡ æŠ•èµ„å»ºè®®</text>
            <view class="investment-opportunities">
              <view wx:for="{{aiAnalysis.result.investmentOpportunities}}" wx:key="opportunity" class="investment-item">
                <view class="investment-header">
                  <text class="investment-type">{{item.type}}</text>
                  <view class="roi-badge">ROI {{item.expectedROI}}%</view>
                </view>
                <text class="investment-desc">{{item.description}}</text>
                <view class="investment-details">
                  <view class="detail-item">
                    <text class="detail-label">æŠ•èµ„é‡‘é¢ï¼š</text>
                    <text class="detail-value">Â¥{{item.requiredInvestment}}ä¸‡</text>
                  </view>
                  <view class="detail-item">
                    <text class="detail-label">å›æ”¶å‘¨æœŸï¼š</text>
                    <text class="detail-value">{{item.paybackPeriod}}</text>
                  </view>
                  <view class="detail-item">
                    <text class="detail-label">é£é™©ç­‰çº§ï¼š</text>
                    <text class="detail-value {{item.riskLevel}}">{{item.riskLevelText}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- é£é™©é¢„è­¦ -->
          <view wx:if="{{aiAnalysis.result.riskAlerts && aiAnalysis.result.riskAlerts.length > 0}}" class="risk-alerts">
            <text class="section-title">âš ï¸ é£é™©é¢„è­¦</text>
            <view class="alert-list">
              <view wx:for="{{aiAnalysis.result.riskAlerts}}" wx:key="index" class="alert-item {{item.severity}}">
                <view class="alert-icon">{{item.icon}}</view>
                <view class="alert-content">
                  <text class="alert-title">{{item.title}}</text>
                  <text class="alert-description">{{item.description}}</text>
                  <text class="alert-suggestion">å»ºè®®æªæ–½ï¼š{{item.suggestion}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- æ— åˆ†æç»“æœæ—¶çš„æç¤º -->
        <view wx:else class="ai-analysis-empty">
          <view class="empty-icon">ğŸ“Š</view>
          <text class="empty-text">ç‚¹å‡»"å¼€å§‹åˆ†æ"è·å–AIè´¢åŠ¡æ´å¯Ÿ</text>
          <text class="empty-desc">åŸºäºæ”¶æ”¯æ•°æ®è¿›è¡Œæ™ºèƒ½åˆ†æå’Œé¢„æµ‹</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="card">
      <view class="card-content">
        <view class="card-header">
          <text class="card-title">å¿«æ·æ“ä½œ</text>
        </view>
        <t-row gutter="24" class="actions-grid">
          <t-col span="12">
            <t-button theme="primary" block size="large" icon="add" bind:tap="addManualRecord" class="primary-button">
              æ‰‹åŠ¨è®°è´¦
            </t-button>
          </t-col>
          <t-col span="12">
            <t-button theme="light" block size="large" icon="download" bind:tap="exportReport" class="light-button">
              å¯¼å‡ºæŠ¥è¡¨
            </t-button>
          </t-col>
        </t-row>
      </view>
    </view>

  </scroll-view>
</view>
