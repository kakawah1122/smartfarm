<view class="page-container">
  <!-- æ–°å¼å¯¼èˆªæ  -->
  <navigation-bar 
    title="è´¢åŠ¡ç®¡ç†"
    show-back="true"
    show-menu="true"
    show-record="false"
    bind:back="goBack"
    bind:menu="onMenuTap"
  />

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-wrapper">
    <scroll-view class="scroll-container" scroll-y>
    <!-- è´¢åŠ¡æ¦‚è§ˆå¡ç‰‡ -->
    <view class="card overview-card" style="margin-bottom: 0 !important;">
      <view class="card-content" style="padding-bottom: 0 !important;">
        <view class="overview-header">
          <text class="overview-title">è´¢åŠ¡æ¦‚è§ˆ</text>
          <view class="filter-container">
            <!-- ç¬¬ä¸€çº§ï¼šæ—¶é—´ç»´åº¦ç±»å‹é€‰æ‹© -->
            <picker 
              mode="selector" 
              range="{{filterTypeOptions}}" 
              range-key="label"
              value="{{filterTypeIndex}}"
              bind:change="onFilterTypeChange"
            >
              <text class="period-filter-text">{{filterTypeLabel}}</text>
            </picker>
            
            <!-- ç¬¬äºŒçº§ï¼šå…·ä½“æ—¶é—´é€‰æ‹© -->
            <!-- æœˆåº¦é€‰æ‹© -->
            <view wx:if="{{filterType === 'month'}}" class="custom-date-container">
              <picker 
                mode="selector"
                range="{{monthOptions}}"
                range-key="label"
                value="{{selectedMonthIndex}}"
                bind:change="onMonthChange"
              >
                <text class="custom-date-text">{{monthOptions[selectedMonthIndex].label}}</text>
              </picker>
            </view>
            
            <!-- å­£åº¦é€‰æ‹© -->
            <view wx:if="{{filterType === 'quarter'}}" class="custom-date-container">
              <picker 
                mode="selector"
                range="{{quarterOptions}}"
                range-key="label"
                value="{{selectedQuarterIndex}}"
                bind:change="onQuarterChange"
              >
                <text class="custom-date-text">{{quarterOptions[selectedQuarterIndex].label}}</text>
              </picker>
            </view>
            
            <!-- å¹´åº¦é€‰æ‹© -->
            <view wx:if="{{filterType === 'year'}}" class="custom-date-container">
              <picker 
                mode="selector"
                range="{{yearOptions}}"
                range-key="label"
                value="{{selectedYearIndex}}"
                bind:change="onYearChange"
              >
                <text class="custom-date-text">{{yearOptions[selectedYearIndex].label}}</text>
              </picker>
            </view>
            
            <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹© -->
            <view wx:if="{{filterType === 'custom'}}" class="custom-date-container">
              <picker 
                mode="date"
                value="{{customStartDate}}"
                bind:change="onCustomStartDateChange"
              >
                <text class="custom-date-text">{{customStartDate || 'å¼€å§‹æ—¥æœŸ'}}</text>
              </picker>
              <text class="date-separator">è‡³</text>
              <picker 
                mode="date"
                value="{{customEndDate}}"
                bind:change="onCustomEndDateChange"
              >
                <text class="custom-date-text">{{customEndDate || 'ç»“æŸæ—¥æœŸ'}}</text>
              </picker>
            </view>
          </view>
        </view>
        
        <!-- æ”¶æ”¯å¯¹æ¯” -->
        <view class="comparison-section">
          <view class="comparison-data">
            <view class="data-item">
              <text class="data-value danger">Â¥{{overview.income}}ä¸‡</text>
              <text class="data-label">æ€»æ”¶å…¥</text>
            </view>
            <view class="data-item">
              <text class="data-value {{overview.profitColorClass}}">Â¥{{overview.profit}}ä¸‡</text>
              <text class="data-label">å‡€åˆ©æ¶¦</text>
            </view>
            <view class="data-item">
              <text class="data-value success">Â¥{{overview.expense}}ä¸‡</text>
              <text class="data-label">æ€»æ”¯å‡º</text>
            </view>
          </view>
        </view>

        <!-- æˆæœ¬æ„æˆ -->
        <view class="cost-grid" style="margin-bottom: 0 !important; padding-bottom: 0 !important;">
          <view class="cost-item orange">
            <text class="cost-label">é¥²æ–™æˆæœ¬</text>
            <text class="cost-value">Â¥{{overview.feedCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.feedPercent}}%</text>
          </view>
          <view class="cost-item purple">
            <text class="cost-label">é¹…è‹—æˆæœ¬</text>
            <text class="cost-value">Â¥{{overview.goslingCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.goslingPercent}}%</text>
          </view>
          <view class="cost-item yellow">
            <text class="cost-label">åŒ»ç–—è´¹ç”¨</text>
            <text class="cost-value">Â¥{{overview.medicalCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.medicalPercent}}%</text>
          </view>
          <view class="cost-item gray">
            <text class="cost-label">å…¶ä»–è´¹ç”¨</text>
            <text class="cost-value">Â¥{{overview.otherCost}}ä¸‡</text>
            <text class="cost-percent">å æ”¯å‡º {{overview.otherPercent}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢ -->
    <t-tabs value="{{activeTab}}" bind:change="onTabChange" theme="line" t-class="finance-tabs" style="margin-top: 0 !important; padding-top: 0 !important;">
      <t-tab-panel label="æ”¶æ”¯æ˜ç»†" value="records" />
      <t-tab-panel label="è´¢åŠ¡æŠ¥è¡¨" value="reports" />
      <t-tab-panel label="å®¡æ‰¹ç®¡ç†" value="approval" />
    </t-tabs>

    <!-- æ”¶æ”¯æ˜ç»†é¡µé¢ -->
    <view wx:if="{{activeTab === 'records'}}" class="tab-content" style="margin-top: 0 !important; padding-top: 0 !important;">
      <!-- äº¤æ˜“è®°å½• -->
      <view class="card" style="margin-top: 0 !important;">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">æœ€è¿‘äº¤æ˜“è®°å½•</text>
            <text class="view-all-btn" bind:tap="viewAllRecords">æŸ¥çœ‹å…¨éƒ¨</text>
          </view>
          <view class="records-list">
            <view 
              wx:for="{{displayRecords}}" 
              wx:key="id"
              class="record-item-card"
              bind:tap="viewRecordDetail"
              data-item="{{item}}"
            >
              <view class="record-left">
                <view class="record-content">
                  <view class="record-title">{{item.title}}</view>
                  <view class="record-desc">{{item.description}}</view>
                  <view class="record-footer">
                    <text class="record-time">{{item.date}}</text>
                  </view>
                </view>
              </view>
              <view class="record-right">
                <view class="record-amount {{item.type}}">
                  {{item.type === 'income' ? '+' : '-'}}Â¥{{item.amount}}
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è´¢åŠ¡æŠ¥è¡¨é¡µé¢ -->
    <view wx:if="{{activeTab === 'reports'}}" class="tab-content">
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">è´¢åŠ¡æŠ¥è¡¨</text>
          </view>
          
          <!-- è¶‹åŠ¿å›¾å ä½ -->
          <view class="chart-section">
            <text class="chart-header">æ”¶æ”¯è¶‹åŠ¿å›¾</text>
            <view class="chart-placeholder">
              <text class="chart-text">ğŸ“Š å›¾è¡¨å ä½åŒºåŸŸ</text>
            </view>
          </view>

          <!-- åŒæ¯”åˆ†æ -->
          <view class="analysis-grid">
            <view class="analysis-item success">
              <text class="analysis-title">åŒæ¯”å¢é•¿</text>
              <text class="analysis-value">+{{reports.yearGrowth}}%</text>
              <text class="analysis-desc">è¾ƒå»å¹´åŒæœŸ</text>
            </view>
            <view class="analysis-item primary">
              <text class="analysis-title">åˆ©æ¶¦ç‡</text>
              <text class="analysis-value">{{reports.profitRate}}%</text>
              <text class="analysis-desc">è¾ƒä¸Šæœˆæå‡</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®¡æ‰¹ç®¡ç†é¡µé¢ -->
    <view wx:if="{{activeTab === 'approval'}}" class="tab-content">
      <view class="card">
        <view class="card-content">
          <view class="card-header">
            <text class="card-title">å¾…å®¡æ‰¹äº‹é¡¹</text>
          </view>
          
          <view class="approval-list">
            <view 
              wx:for="{{approvalItems}}" 
              wx:key="id"
              class="approval-item"
              bind:tap="viewApprovalDetail"
              data-item="{{item}}"
            >
              <view class="approval-left">
                <view class="approval-content">
                  <view class="approval-title">{{item.applicant}} - {{item.title}}</view>
                  <view class="approval-desc">{{item.description}}</view>
                  <view class="approval-footer">
                    <text class="approval-time">æäº¤æ—¶é—´ï¼š{{item.submitTime}}</text>
                  </view>
                </view>
              </view>
              <view class="approval-right">
                <view class="approval-amount">
                  Â¥{{item.amount}}
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="card">
      <view class="card-content">
        <view class="card-header">
          <text class="card-title">å¿«æ·æ“ä½œ</text>
        </view>
        <view class="actions-grid">
          <t-button theme="primary" size="large" bind:tap="addManualRecord" class="action-button primary-button">
            æ‰‹åŠ¨è®°è´¦
          </t-button>
          <t-button theme="light" size="large" bind:tap="exportReport" class="action-button light-button">
            å¯¼å‡ºæŠ¥è¡¨
          </t-button>
        </view>
      </view>
    </view>

      <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸå ä½ -->
      <view class="safe-area"></view>
    </scroll-view>
  </view>
  
  <!-- äº¤æ˜“è¯¦æƒ…å¼¹çª—ç»„ä»¶ -->
  <finance-record-detail
    visible="{{showDetailPopup}}"
    record="{{selectedRecord}}"
    bind:close="closeDetailPopup"
  />
</view>
