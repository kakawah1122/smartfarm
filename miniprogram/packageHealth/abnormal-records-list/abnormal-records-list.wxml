<!-- miniprogram/packageHealth/abnormal-records-list/abnormal-records-list.wxml -->
<view class="abnormal-records-page">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="异常记录" 
    showBack="{{true}}" 
    fallbackUrl="/pages/health/health" 
  />

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <t-loading theme="circular" size="60rpx" text="加载中..." />
  </view>

  <!-- 空状态 -->
  <view class="empty-container" wx:if="{{!loading && records.length === 0}}">
    <t-empty icon="info-circle" description="暂无异常记录" />
  </view>

  <!-- 记录列表 -->
  <view class="records-list" wx:if="{{!loading && records.length > 0}}">
    <view 
      class="record-card"
      wx:for="{{records}}"
      wx:key="_id"
      bind:tap="onRecordTap"
      data-id="{{item._id}}"
    >
      <!-- 记录头部：诊断名称 -->
      <view class="record-header">
        <view class="record-title-row">
          <text class="record-name">{{item.diagnosis}}</text>
        </view>
      </view>

      <!-- 记录内容 -->
      <view class="record-content">
        <!-- 第一行：批次号 + 数量 -->
        <view class="info-row">
          <view class="info-group">
            <text class="info-label">批次：</text>
            <text class="info-value">{{item.batchNumber}}</text>
          </view>
          <view class="info-group">
            <text class="info-label">受影响：</text>
            <text class="info-value highlight">{{item.affectedCount || item.sickCount || 0}} 只</text>
          </view>
        </view>

        <!-- 第二行：症状描述 -->
        <view class="info-row symptoms-row" wx:if="{{item.symptoms}}">
          <view class="symptoms-label">症状：</view>
          <view class="symptoms-text">{{item.symptoms}}</view>
        </view>

        <!-- 第三行：修正后的病名（如果存在） -->
        <view class="info-row" wx:if="{{item.isCorrected}}">
          <view class="info-group full-width">
            <text class="info-label">修正后：</text>
            <text class="info-value corrected-diagnosis">{{item.correctedDiagnosis}}</text>
          </view>
        </view>

        <!-- 底部：日期 + 记录者 + 状态 -->
        <view class="record-footer">
          <view class="footer-left">
            <text class="date-text">{{item.checkDate}}</text>
            <text class="operator-text">{{item.reporterName || item.correctedByName || 'KAKA'}}</text>
          </view>
          <t-tag 
            theme="{{item.status === 'abnormal' ? 'warning' : (item.status === 'treating' ? 'primary' : 'success')}}" 
            size="small" 
            class="status-tag"
          >
            {{item.status === 'abnormal' ? '待处理' : (item.status === 'treating' ? '治疗中' : '已隔离')}}
          </t-tag>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部安全区域 -->
  <view class="safe-area-bottom"></view>

</view>
