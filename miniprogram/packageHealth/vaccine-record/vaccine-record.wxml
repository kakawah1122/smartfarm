<!-- vaccine-record.wxml - 疫苗接种记录页面 -->
<view class="page vaccine-record-page">
  <!-- 导航栏 -->
  <navigation-bar 
    title="疫苗接种记录"
    show-back="true"
    bind:back="goBack"
  />

  <view class="page-container">
    <!-- 表单内容 -->
    <view class="form-container">
      
      <!-- 基本信息 -->
      <view class="form-section">
        <view class="section-title">基本信息</view>
        
        <!-- 批次选择 -->
        <view class="form-item">
          <view class="form-label required">目标批次</view>
          <t-cell 
            title="{{formData.batchId || '请选择批次'}}"
            arrow
            bind:click="showBatchSelector"
            t-class="{{formErrors.batchId ? 'form-cell-error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.batchId}}">{{formErrors.batchId}}</view>
        </view>

        <!-- 疫苗名称 -->
        <view class="form-item">
          <view class="form-label required">疫苗名称</view>
          <t-input
            value="{{formData.vaccineName}}"
            placeholder="请输入疫苗名称"
            data-field="vaccineName"
            bind:change="onFormInput"
            status="{{formErrors.vaccineName ? 'error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.vaccineName}}">{{formErrors.vaccineName}}</view>
        </view>

        <!-- 生产厂家 -->
        <view class="form-item">
          <view class="form-label">生产厂家</view>
          <t-input
            value="{{formData.manufacturer}}"
            placeholder="请输入生产厂家"
            data-field="manufacturer"
            bind:change="onFormInput"
          />
        </view>

        <!-- 批号 -->
        <view class="form-item">
          <view class="form-label">疫苗批号</view>
          <t-input
            value="{{formData.batchNumber}}"
            placeholder="请输入疫苗批号"
            data-field="batchNumber"
            bind:change="onFormInput"
          />
        </view>

        <!-- 有效期 -->
        <view class="form-item">
          <view class="form-label">有效期</view>
          <picker 
            mode="date" 
            value="{{formData.expiryDate}}"
            data-field="expiryDate"
            bind:change="onDateChange"
          >
            <t-input
              value="{{formData.expiryDate}}"
              placeholder="请选择有效期"
              readonly
              suffix-icon="calendar"
            />
          </picker>
        </view>
      </view>

      <!-- 接种信息 -->
      <view class="form-section">
        <view class="section-title">接种信息</view>
        
        <!-- 用法用量 -->
        <view class="form-item">
          <view class="form-label">用法用量</view>
          <t-input
            value="{{formData.dosage}}"
            placeholder="如：0.5ml/只"
            data-field="dosage"
            bind:change="onFormInput"
          />
        </view>

        <!-- 给药途径 -->
        <view class="form-item">
          <view class="form-label">给药途径</view>
          <t-cell 
            title="{{selectedRouteLabel}}"
            arrow
            bind:click="showRouteSelector"
          />
        </view>

        <!-- 目标接种数量 -->
        <view class="form-item">
          <view class="form-label required">目标数量</view>
          <t-input
            value="{{formData.targetCount}}"
            placeholder="请输入目标接种数量"
            type="number"
            data-field="targetCount"
            bind:input="onNumberInput"
            status="{{formErrors.targetCount ? 'error' : ''}}"
            suffix="只"
          />
          <view class="error-text" wx:if="{{formErrors.targetCount}}">{{formErrors.targetCount}}</view>
        </view>

        <!-- 实际接种数量 -->
        <view class="form-item">
          <view class="form-label">实际数量</view>
          <t-input
            value="{{formData.actualCount}}"
            placeholder="请输入实际接种数量"
            type="number"
            data-field="actualCount"
            bind:input="onNumberInput"
            status="{{formErrors.actualCount ? 'error' : ''}}"
            suffix="只"
          />
          <view class="error-text" wx:if="{{formErrors.actualCount}}">{{formErrors.actualCount}}</view>
        </view>

        <!-- 不良反应数量 -->
        <view class="form-item">
          <view class="form-label">不良反应</view>
          <t-input
            value="{{formData.adverseReactions}}"
            placeholder="不良反应数量"
            type="number"
            data-field="adverseReactions"
            bind:input="onNumberInput"
            status="{{formErrors.adverseReactions ? 'error' : ''}}"
            suffix="只"
          />
          <view class="error-text" wx:if="{{formErrors.adverseReactions}}">{{formErrors.adverseReactions}}</view>
          <view class="form-tip">如有不良反应，系统将提示进行AI诊断</view>
        </view>
      </view>

      <!-- 执行信息 -->
      <view class="form-section">
        <view class="section-title">执行信息</view>
        
        <!-- 执行日期 -->
        <view class="form-item">
          <view class="form-label required">执行日期</view>
          <picker 
            mode="date" 
            value="{{formData.executionDate}}"
            data-field="executionDate"
            bind:change="onDateChange"
          >
            <t-input
              value="{{formData.executionDate}}"
              placeholder="请选择执行日期"
              readonly
              suffix-icon="calendar"
              status="{{formErrors.executionDate ? 'error' : ''}}"
            />
          </picker>
          <view class="error-text" wx:if="{{formErrors.executionDate}}">{{formErrors.executionDate}}</view>
        </view>

        <!-- 执行时间 -->
        <view class="form-item">
          <view class="form-label">执行时间</view>
          <picker 
            mode="time" 
            value="{{formData.executionTime}}"
            data-field="executionTime"
            bind:change="onTimeChange"
          >
            <t-input
              value="{{formData.executionTime}}"
              placeholder="请选择执行时间"
              readonly
              suffix-icon="time"
            />
          </picker>
        </view>

        <!-- 操作员 -->
        <view class="form-item">
          <view class="form-label required">操作员</view>
          <t-input
            value="{{formData.operator}}"
            placeholder="请输入操作员姓名"
            data-field="operator"
            bind:change="onFormInput"
            status="{{formErrors.operator ? 'error' : ''}}"
          />
          <view class="error-text" wx:if="{{formErrors.operator}}">{{formErrors.operator}}</view>
        </view>

        <!-- 成本费用 -->
        <view class="form-item">
          <view class="form-label">成本费用</view>
          <t-input
            value="{{formData.cost}}"
            placeholder="请输入成本费用"
            type="digit"
            data-field="cost"
            bind:input="onNumberInput"
            prefix-icon="wallet"
            suffix="元"
          />
        </view>
      </view>

      <!-- 计划安排 -->
      <view class="form-section">
        <view class="section-title">后续计划</view>
        
        <!-- 下次接种时间 -->
        <view class="form-item">
          <view class="form-label">下次接种</view>
          <picker 
            mode="date" 
            value="{{formData.nextSchedule}}"
            data-field="nextSchedule"
            bind:change="onDateChange"
          >
            <t-input
              value="{{formData.nextSchedule}}"
              placeholder="请选择下次接种时间（可选）"
              readonly
              suffix-icon="calendar"
            />
          </picker>
        </view>

        <!-- 备注 -->
        <view class="form-item">
          <view class="form-label">备注信息</view>
          <t-textarea
            value="{{formData.notes}}"
            placeholder="请输入备注信息（可选）"
            maxlength="200"
            data-field="notes"
            bind:change="onFormInput"
          />
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <t-button 
        theme="light" 
        size="large" 
        bind:tap="resetForm"
        disabled="{{submitting}}"
      >
        重置
      </t-button>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="submitForm"
        loading="{{submitting}}"
      >
        保存记录
      </t-button>
    </view>

    <!-- 底部安全区域 -->
    <view class="safe-area"></view>
  </view>

  <!-- 给药途径选择器 -->
  <t-picker
    visible="{{showRoutePicker}}"
    value="{{[selectedRouteIndex]}}"
    data-source="{{routeOptions}}"
    bind:change="onRoutePickerChange"
    bind:cancel="onRoutePickerCancel"
    title="选择给药途径"
  >
    <t-picker-item
      wx:for="{{routeOptions}}"
      wx:key="value"
      label="{{item.label}}"
      value="{{index}}"
    />
  </t-picker>
</view>
