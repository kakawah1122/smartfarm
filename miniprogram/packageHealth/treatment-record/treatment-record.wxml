<!-- treatment-record.wxml - æ²»ç–—è®°å½•é¡µé¢ -->
<view class="page treatment-record-page">
  <!-- å¯¼èˆªæ  -->
  <navigation-bar 
    title="æ²»ç–—è®°å½•"
    show-back="true"
    bind:back="goBack"
  />

  <view class="page-content">
    
    <!-- ========== âœ… æŸ¥çœ‹æ¨¡å¼ï¼ˆæ²»ç–—è¿›å±•è·Ÿè¿›ï¼‰ ========== -->
    <block wx:if="{{viewMode}}">
      <!-- æ²»ç–—åŸºæœ¬ä¿¡æ¯ï¼ˆåªè¯»ï¼‰ -->
      <view class="view-section">
        <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
        <view class="info-card">
          <view class="info-row">
            <text class="info-label">æ²»ç–—æ‰¹æ¬¡</text>
            <text class="info-value">{{formData.batchId}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">è¯Šæ–­ç»“æœ</text>
            <text class="info-value">{{formData.diagnosis}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ²»ç–—ç±»å‹</text>
            <text class="info-value">{{formData.treatmentType === 'medication' ? 'è¯ç‰©æ²»ç–—' : 'éš”ç¦»è§‚å¯Ÿ'}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ²»ç–—æ—¥æœŸ</text>
            <text class="info-value">{{formData.treatmentDate}}</text>
          </view>
        </view>
      </view>

      <!-- æ²»ç–—æ–¹æ¡ˆï¼ˆåªè¯»ï¼‰ -->
      <view class="view-section">
        <view class="section-title">æ²»ç–—æ–¹æ¡ˆ</view>
        <view class="plan-card">
          <text class="plan-text">{{treatmentPlan.primary || 'æš‚æ— æ²»ç–—æ–¹æ¡ˆ'}}</text>
        </view>
      </view>

      <!-- ç”¨è¯å†å² -->
      <view class="view-section medication-history-section">
        <view class="section-title">ç”¨è¯å†å²</view>
        
        <!-- ç”¨è¯è®°å½• -->
        <view class="medication-records" wx:if="{{medications.length > 0}}">
          <view class="records-list">
            <view class="record-item" wx:for="{{medications}}" wx:key="index">
              <view class="record-icon">ğŸ’Š</view>
              <view class="record-info">
                <view class="record-header">
                  <text class="record-name">{{item.name}}</text>
                  <text class="record-spec">{{item.quantity}}{{item.unit}}</text>
                </view>
                <text class="record-dosage" wx:if="{{item.dosage}}">{{item.dosage}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="empty-records" wx:else>
          <text class="empty-text">æš‚æ— ç”¨è¯è®°å½•</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="action-buttons">
          <t-button 
            theme="primary" 
            size="large" 
            bind:tap="showContinueTreatmentOptions"
            disabled="{{treatmentProgress.remainingCount <= 0}}"
            block
          >
            è¿›ä¸€æ­¥æ²»ç–—
          </t-button>
          <t-button 
            theme="success" 
            size="large" 
            bind:tap="showProgressDialog"
            data-type="cured"
            disabled="{{treatmentProgress.remainingCount <= 0}}"
            block
          >
            è®°å½•æ²»æ„ˆ
          </t-button>
          <t-button 
            theme="danger" 
            size="large" 
            bind:tap="showProgressDialog"
            data-type="died"
            disabled="{{treatmentProgress.remainingCount <= 0}}"
            block
          >
            è®°å½•æ­»äº¡
          </t-button>
        </view>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="view-section" wx:if="{{formData.notes}}">
        <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
        <view class="notes-card">
          <text class="notes-text">{{formData.notes}}</text>
        </view>
      </view>
    </block>

    <!-- ========== ç¼–è¾‘/åˆ›å»ºæ¨¡å¼ ========== -->
    <block wx:else>
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      
      <!-- æ²»ç–—æ‰¹æ¬¡ -->
      <view class="form-item">
        <view class="form-label required">æ²»ç–—æ‰¹æ¬¡</view>
        <t-cell 
          title="{{formData.batchId || 'è¯·é€‰æ‹©æ²»ç–—æ‰¹æ¬¡'}}"
          arrow
          bind:click="showBatchSelector"
          t-class="{{formErrors.batchId ? 'form-cell-error' : ''}}"
        />
        <view class="error-text" wx:if="{{formErrors.batchId}}">{{formErrors.batchId}}</view>
      </view>

      <!-- è¯Šæ–­ç»“æœ -->
      <view class="form-item">
        <view class="form-label-row">
          <view class="form-label required">è¯Šæ–­ç»“æœ</view>
          <t-tag 
            wx:if="{{isDiagnosisCorrected}}" 
            theme="success" 
            variant="light" 
            size="small"
          >
            å·²ä¿®æ­£
          </t-tag>
        </view>
        <t-input
          value="{{formData.diagnosis}}"
          placeholder="è¯·è¾“å…¥è¯Šæ–­ç»“æœ"
          data-field="diagnosis"
          bind:change="onFormInput"
          status="{{formErrors.diagnosis ? 'error' : ''}}"
        />
        <view class="error-text" wx:if="{{formErrors.diagnosis}}">{{formErrors.diagnosis}}</view>
        
        <!-- AIè¯Šæ–­ç½®ä¿¡åº¦æ˜¾ç¤º -->
        <view class="diagnosis-confidence" wx:if="{{formData.diagnosisConfidence > 0}}">
          <text class="confidence-label">AIè¯Šæ–­ç½®ä¿¡åº¦ï¼š</text>
          <text class="confidence-value {{formData.diagnosisConfidence >= 80 ? 'high' : formData.diagnosisConfidence >= 60 ? 'medium' : 'low'}}">
            {{formData.diagnosisConfidence}}%
          </text>
        </view>
      </view>

      <!-- æ²»ç–—ç±»å‹ -->
      <view class="form-item">
        <view class="form-label">æ²»ç–—ç±»å‹</view>
        <view class="treatment-type-grid">
          <view 
            class="treatment-type-item {{formData.treatmentType === item.value ? 'active' : ''}}"
            wx:for="{{treatmentTypeOptions}}"
            wx:key="value"
            data-type="{{item.value}}"
            bind:tap="selectTreatmentType"
          >
            <text class="type-name">{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- æ²»ç–—æ—¥æœŸ -->
      <view class="form-item">
        <view class="form-label required">æ²»ç–—æ—¥æœŸ</view>
        <picker 
          mode="date" 
          value="{{formData.treatmentDate}}"
          data-field="treatmentDate"
          bind:change="onDateChange"
        >
          <t-input
            value="{{formData.treatmentDate}}"
            placeholder="è¯·é€‰æ‹©æ²»ç–—å¼€å§‹æ—¥æœŸ"
            readonly
            suffix-icon="calendar"
            status="{{formErrors.treatmentDate ? 'error' : ''}}"
          />
        </picker>
        <view class="error-text" wx:if="{{formErrors.treatmentDate}}">{{formErrors.treatmentDate}}</view>
      </view>
    </view>

    <!-- æ²»ç–—æ–¹æ¡ˆ -->
    <view class="form-section">
      <view class="section-title">
        <text wx:if="{{treatmentPlanSource === 'veterinarian'}}">å…½åŒ»å»ºè®®æ²»ç–—æ–¹æ¡ˆ</text>
        <text wx:elif="{{treatmentPlanSource === 'ai'}}">AIå»ºè®®æªæ–½</text>
        <text wx:else>æ²»ç–—æ–¹æ¡ˆ</text>
      </view>
      
      <view class="form-item">
        <t-textarea
          value="{{treatmentPlan.primary}}"
          placeholder="è¯·è¾“å…¥æ²»ç–—æ–¹æ¡ˆ"
          maxlength="200"
          data-field="primary"
          bind:change="onTreatmentPlanInput"
        />
        <view class="error-text" wx:if="{{formErrors.treatmentPlan}}">{{formErrors.treatmentPlan}}</view>
      </view>
    </view>

    <!-- âœ… AIç”¨è¯å»ºè®®ï¼ˆä»…æ˜¾ç¤ºï¼‰ -->
    <view class="form-section" wx:if="{{aiMedicationSuggestions.length > 0}}">
      <view class="section-title">AIç”¨è¯å»ºè®®</view>
      <view class="ai-medication-suggestions">
        <view class="suggestion-item" wx:for="{{aiMedicationSuggestions}}" wx:key="index">
          <view class="suggestion-header">
            <text class="med-name">ğŸ’Š {{item.name}}</text>
          </view>
          <view class="suggestion-details">
            <view class="detail-row" wx:if="{{item.dosage}}">
              <text class="detail-label">ç”¨é‡ï¼š</text>
              <text class="detail-value">{{item.dosage}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.route}}">
              <text class="detail-label">é€”å¾„ï¼š</text>
              <text class="detail-value">{{item.route}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.frequency}}">
              <text class="detail-label">é¢‘æ¬¡ï¼š</text>
              <text class="detail-value">{{item.frequency}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.duration}}">
              <text class="detail-label">ç–—ç¨‹ï¼š</text>
              <text class="detail-value">{{item.duration}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.notes}}">
              <text class="detail-label">å¤‡æ³¨ï¼š</text>
              <text class="detail-value">{{item.notes}}</text>
            </view>
          </view>
        </view>
      </view>
      <view class="ai-suggestion-hint">
        <text class="hint-icon">ğŸ’¡</text>
        <text class="hint-text">ä»¥ä¸Šä¸ºAIå»ºè®®ï¼Œå®é™…ç”¨è¯è¯·ä»ä¸‹æ–¹åº“å­˜ä¸­é€‰æ‹©</text>
      </view>
    </view>

    <!-- âœ… ç”¨è¯ç®¡ç† - å¤šé€‰è”åˆç”¨è¯ -->
    <view class="form-section medication-multi-select-section">
      <view class="section-title">ç”¨è¯ç®¡ç†</view>
      
      <!-- é€‰æ‹©è¯å“ -->
      <view class="form-item">
        <view class="form-label">é€‰æ‹©è¯å“</view>
        <picker 
          mode="selector" 
          range="{{filteredMaterials}}" 
          range-key="name"
          value="{{currentMedicationForm.materialIndex}}"
          bindchange="onInitialMedicationChange"
        >
          <view class="native-picker">
            {{formData.treatmentType === 'isolation' ? 'è¯·é€‰æ‹©è¥å…»å“' : 'è¯·é€‰æ‹©è¯å“æˆ–è¥å…»å“'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <!-- å·²é€‰æ‹©çš„è¯å“åˆ—è¡¨ -->
      <view class="selected-medications-list" wx:if="{{initialMedications.length > 0}}">
        <view class="medication-card-new" style="padding: 32rpx; margin-bottom: 16rpx; background: #fff; border-radius: 16rpx; border: 2rpx solid #e8eaed;" wx:for="{{initialMedications}}" wx:key="materialId">
          <!-- å¤´éƒ¨ï¼šè¯å“åç§°å’Œåˆ é™¤æŒ‰é’® -->
          <view class="card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20rpx; padding-bottom: 16rpx; border-bottom: 2rpx solid #f5f6f7;">
            <view class="drug-info" style="flex: 1;">
              <text class="drug-name" style="font-size: 30rpx; font-weight: normal; color: #1a1a1a; display: block;">{{item.materialName}}</text>
            </view>
            <view class="delete-icon" style="width: 56rpx; height: 56rpx; display: flex; align-items: center; justify-content: center; background: #fff1f0; border-radius: 50%; margin-left: 16rpx;" bind:tap="removeInitialMedication" data-index="{{index}}">
              <text class="icon-close" style="font-size: 56rpx; color: #ff4d4f; line-height: 1; font-weight: 300;">Ã—</text>
            </view>
          </view>
          
          <!-- è¯å“ä¿¡æ¯è¾“å…¥ -->
          <view class="medication-inputs-simple">
            <!-- æ•°é‡è¡Œ -->
            <view class="input-row-simple" style="display: flex; align-items: center; margin-bottom: 20rpx;">
              <text class="label-simple" style="width: 90rpx; font-size: 28rpx; font-weight: normal; color: #1a1a1a; margin-right: 16rpx;">æ•°é‡</text>
              <input
                class="input-field-simple"
                style="flex: 1; height: 70rpx; padding: 0 24rpx; font-size: 28rpx; color: #1a1a1a; background: #f7f8fa; border-radius: 12rpx; border: 2rpx solid #e8eaed;"
                value="{{item.quantity}}"
                placeholder="è¯·è¾“å…¥æ•°é‡ï¼ˆåº“å­˜: {{item.currentStock}}{{item.unit}}ï¼‰"
                type="digit"
                data-index="{{index}}"
                data-field="quantity"
                bind:input="onInitialMedicationInput"
              />
              <text class="unit-simple" style="font-size: 26rpx; color: #646566; margin-left: 16rpx;">{{item.unit}}</text>
            </view>
            
            <!-- ç”¨æ³•è¡Œ -->
            <view class="input-row-simple" style="display: flex; align-items: center;">
              <text class="label-simple" style="width: 90rpx; font-size: 28rpx; font-weight: normal; color: #1a1a1a; margin-right: 16rpx;">ç”¨æ³•</text>
              <input
                class="input-field-simple full-width"
                style="flex: 1; height: 70rpx; padding: 0 24rpx; font-size: 28rpx; color: #1a1a1a; background: #f7f8fa; border-radius: 12rpx; border: 2rpx solid #e8eaed;"
                value="{{item.dosage}}"
                placeholder="å¦‚ï¼š10mg/kg æ¯æ—¥2æ¬¡"
                data-index="{{index}}"
                data-field="dosage"
                bind:input="onInitialMedicationInput"
              />
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view class="empty-medications" wx:else>
        <text class="empty-text">æš‚æ— é€‰æ‹©è¯å“ï¼Œè¯·é€‰æ‹©å¹¶æ·»åŠ </text>
      </view>
    </view>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
      <view class="form-item">
        <t-textarea
          value="{{formData.notes}}"
          placeholder="è¯·è¾“å…¥æ²»ç–—å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰"
          maxlength="300"
          data-field="notes"
          bind:change="onFormInput"
        />
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <t-button 
        theme="light" 
        size="large" 
        bind:tap="resetForm"
        disabled="{{submitting}}"
        wx:if="{{!isEditMode}}"
      >
        é‡ç½®
      </t-button>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="submitForm"
        loading="{{submitting}}"
      >
        {{isDraft ? 'æäº¤æ²»ç–—æ–¹æ¡ˆ' : (isEditMode ? 'ä¿å­˜ä¿®æ”¹' : 'ä¿å­˜è®°å½•')}}
      </t-button>
    </view>
    </block>
    <!-- ========== ç¼–è¾‘/åˆ›å»ºæ¨¡å¼ç»“æŸ ========== -->
  </view>

  <!-- ========== âœ… æ²»ç–—è¿›å±•è‡ªå®šä¹‰å¼¹çª— ========== -->
  <!-- é®ç½©å±‚ -->
  <view 
    class="progress-mask" 
    wx:if="{{showProgressDialog}}"
    bind:tap="closeProgressDialog"
    catchtouchmove="preventTouchMove"
  ></view>
  
  <!-- å¼¹çª—å†…å®¹ -->
  <view class="progress-popup {{showProgressDialog ? 'show' : ''}}" wx:if="{{showProgressDialog}}">
    <!-- æ ‡é¢˜æ  -->
    <view class="popup-header">
      <text class="popup-title">{{progressDialogType === 'cured' ? 'è®°å½•æ²»æ„ˆ' : 'è®°å½•æ­»äº¡'}}</text>
      <view class="close-btn" bind:tap="closeProgressDialog">
        <text class="icon-close">Ã—</text>
      </view>
    </view>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <scroll-view class="popup-content" scroll-y>
      <!-- å‰©ä½™æ•°é‡æç¤º -->
      <view class="dialog-hint">
        <text class="hint-text">å½“å‰å‰©ä½™æ²»ç–—æ•°ï¼š</text>
        <text class="hint-value">{{treatmentProgress.remainingCount}} åª</text>
      </view>

      <!-- æ•°é‡è¾“å…¥ -->
      <view class="dialog-field">
        <view class="field-label required">
          {{progressDialogType === 'cured' ? 'æ²»æ„ˆæ•°é‡' : 'æ­»äº¡æ•°é‡'}}
        </view>
        <view class="count-input-row">
          <input
            class="count-input"
            value="{{progressForm.count}}"
            placeholder="{{progressDialogType === 'cured' ? 'è¾“å…¥æ²»æ„ˆçš„åªæ•°' : 'è¾“å…¥æ­»äº¡çš„åªæ•°'}}"
            type="digit"
            data-field="count"
            bind:input="onProgressFormInput"
          />
          <view class="all-btn" bind:tap="fillAllCount">
            <text>å…¨éƒ¨</text>
          </view>
        </view>
        <text class="field-hint">å¯è¾“å…¥1-{{treatmentProgress.remainingCount}}åª</text>
      </view>

      <!-- æ­»äº¡åŸå› ï¼ˆä»…æ­»äº¡æ—¶æ˜¾ç¤ºï¼‰ -->
      <view class="dialog-field" wx:if="{{progressDialogType === 'died'}}">
        <view class="field-label">æ­»äº¡åŸå› </view>
        <textarea
          class="field-textarea"
          value="{{progressForm.deathCause}}"
          placeholder="è¯·å¡«å†™æ­»äº¡åŸå› ï¼ˆå¯é€‰ï¼‰"
          maxlength="200"
          data-field="deathCause"
          bind:input="onProgressFormInput"
        />
      </view>

      <!-- å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰ -->
      <view class="dialog-field">
        <view class="field-label">å¤‡æ³¨</view>
        <textarea
          class="field-textarea"
          value="{{progressForm.notes}}"
          placeholder="è¡¥å……è¯´æ˜ï¼ˆå¯é€‰ï¼‰"
          maxlength="200"
          data-field="notes"
          bind:input="onProgressFormInput"
        />
      </view>
    </scroll-view>
    
    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="popup-footer">
      <view class="footer-btn cancel-btn" bind:tap="closeProgressDialog">
        <text>å–æ¶ˆ</text>
      </view>
      <view class="footer-btn confirm-btn" bind:tap="submitProgress">
        <text>ç¡®è®¤</text>
      </view>
    </view>
  </view>

  <!-- ========== âœ… è¿›ä¸€æ­¥æ²»ç–—ä¸€ä½“åŒ–åº•éƒ¨å¼¹çª— ========== -->
  <!-- é®ç½©å±‚ -->
  <view 
    class="treatment-mask" 
    wx:if="{{showContinueTreatmentDialog}}"
    bind:tap="closeContinueTreatmentDialog"
  ></view>
  
  <!-- åº•éƒ¨å¼¹çª— -->
  <view class="treatment-sheet {{showContinueTreatmentDialog ? 'show' : ''}}">
    <view class="sheet-header">
      <text class="sheet-title">è¿›ä¸€æ­¥æ²»ç–—</text>
      <view class="close-btn" bind:tap="closeContinueTreatmentDialog">
        <t-icon name="close" size="48rpx" />
      </view>
    </view>
    
    <scroll-view scroll-y class="sheet-scroll">
      <!-- æ²»ç–—ç¬”è®° -->
      <view class="form-section-inline">
        <view class="section-title-inline">
          <text class="title-icon">ğŸ“</text>
          <text class="title-text">æ²»ç–—ç¬”è®°</text>
          <text class="title-optional">ï¼ˆå¯é€‰ï¼‰</text>
        </view>
        <t-textarea
          value="{{noteForm.content}}"
          placeholder="è®°å½•æ²»ç–—è§‚å¯Ÿã€ç—…æƒ…å˜åŒ–ã€é£Ÿæ¬²æƒ…å†µç­‰"
          maxlength="500"
          data-field="content"
          bind:change="onNoteFormInput"
        />
      </view>
      
      <!-- è¿½åŠ ç”¨è¯ -->
      <view class="form-section-inline">
        <view class="section-title-inline">
          <text class="title-icon">ğŸ’Š</text>
          <text class="title-text">è¿½åŠ ç”¨è¯</text>
          <text class="title-optional">ï¼ˆå¯é€‰ï¼Œæ”¯æŒè”åˆç”¨è¯ï¼‰</text>
        </view>
        
        <!-- âœ… å·²é€‰æ‹©çš„è¯å“åˆ—è¡¨ï¼ˆç»Ÿä¸€æ ·å¼ï¼‰ -->
        <view class="medication-card-new" style="padding: 32rpx; margin-bottom: 16rpx; background: #fff; border-radius: 16rpx; border: 2rpx solid #e8eaed;" wx:for="{{selectedMedications}}" wx:key="materialId">
          <!-- å¤´éƒ¨ï¼šè¯å“åç§°å’Œåˆ é™¤æŒ‰é’® -->
          <view class="card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20rpx; padding-bottom: 16rpx; border-bottom: 2rpx solid #f5f6f7;">
            <view class="drug-info" style="flex: 1;">
              <text class="drug-name" style="font-size: 30rpx; font-weight: normal; color: #1a1a1a; display: block;">{{item.materialName}}</text>
            </view>
            <view class="delete-icon" style="width: 56rpx; height: 56rpx; display: flex; align-items: center; justify-content: center; background: #fff1f0; border-radius: 50%; margin-left: 16rpx;" bind:tap="removeMedication" data-index="{{index}}">
              <text class="icon-close" style="font-size: 56rpx; color: #ff4d4f; line-height: 1; font-weight: 300;">Ã—</text>
            </view>
          </view>

          <!-- è¯å“ä¿¡æ¯è¾“å…¥ -->
          <view class="medication-inputs-simple">
            <!-- æ•°é‡è¡Œ -->
            <view class="input-row-simple" style="display: flex; align-items: center; margin-bottom: 20rpx;">
              <text class="label-simple" style="width: 90rpx; font-size: 28rpx; font-weight: normal; color: #1a1a1a; margin-right: 16rpx;">æ•°é‡</text>
              <input
                class="input-field-simple"
                style="flex: 1; height: 70rpx; padding: 0 24rpx; font-size: 28rpx; color: #1a1a1a; background: #f7f8fa; border-radius: 12rpx; border: 2rpx solid #e8eaed;"
                value="{{item.quantity}}"
                placeholder="è¯·è¾“å…¥æ•°é‡ï¼ˆåº“å­˜: {{item.currentStock}}{{item.unit}}ï¼‰"
                type="digit"
                data-index="{{index}}"
                data-field="quantity"
                bind:input="onSelectedMedicationInput"
              />
              <text class="unit-simple" style="font-size: 26rpx; color: #646566; margin-left: 16rpx;">{{item.unit}}</text>
            </view>

            <!-- ç”¨æ³•è¡Œ -->
            <view class="input-row-simple" style="display: flex; align-items: center;">
              <text class="label-simple" style="width: 90rpx; font-size: 28rpx; font-weight: normal; color: #1a1a1a; margin-right: 16rpx;">ç”¨æ³•</text>
              <input
                class="input-field-simple full-width"
                style="flex: 1; height: 70rpx; padding: 0 24rpx; font-size: 28rpx; color: #1a1a1a; background: #f7f8fa; border-radius: 12rpx; border: 2rpx solid #e8eaed;"
                value="{{item.dosage}}"
                placeholder="å¦‚ï¼š10mg/kg æ¯æ—¥2æ¬¡"
                data-index="{{index}}"
                data-field="dosage"
                bind:input="onSelectedMedicationInput"
              />
            </view>
          </view>
        </view>
        
        <!-- âœ… æ·»åŠ è¯å“åŒºåŸŸï¼ˆå»æ‰æŒ‰é’®ï¼‰ -->
        <view class="add-medication-area">
          <view class="form-item-inline">
            <view class="form-label-inline">
              <text>é€‰æ‹©è¯å“/è¥å…»å“</text>
              <text class="add-hint" wx:if="{{selectedMedications.length > 0}}">ï¼ˆç»§ç»­æ·»åŠ ï¼‰</text>
            </view>
            <picker 
              mode="selector" 
              range="{{filteredMaterials}}" 
              range-key="name"
              bindchange="onAddMedicationMaterialChange"
            >
              <view class="native-picker">
                è¯·é€‰æ‹©è¯å“æˆ–è¥å…»å“
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
      </view>
      
      <view class="form-hint-inline">
        <text class="hint-icon">ğŸ’¡</text>
        <text class="hint-text">è‡³å°‘å¡«å†™ä¸€é¡¹å†…å®¹ï¼Œä¼šè®°å½•åœ¨æ²»ç–—å†å²ä¸­</text>
      </view>
    </scroll-view>
    
    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="sheet-footer">
      <t-button 
        theme="primary" 
        size="large" 
        block
        bind:tap="submitContinueTreatment"
      >
        ç¡®è®¤æäº¤
      </t-button>
    </view>
  </view>

</view>
