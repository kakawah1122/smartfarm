<!-- miniprogram/packageHealth/cured-records-list/cured-records-list.wxml -->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="治愈记录" 
    showBack="{{true}}" 
    fallbackUrl="/pages/health/health" 
  />

  <!-- 内容区域 -->
  <view class="content-wrapper">
    <!-- 加载状态 -->
    <view class="loading-container" wx:if="{{loading}}">
      <t-loading theme="circular" size="60rpx" text="加载中..." />
    </view>

    <!-- 内容区 -->
    <scroll-view class="list-container" scroll-y wx:else>
      <!-- 统计卡片 -->
      <view class="stats-section">
        <view class="stats-grid">
          <view class="stat-card success">
            <view class="stat-info">
              <text class="stat-label">累计治愈</text>
              <text class="stat-value">{{stats.totalCured}}</text>
            </view>
          </view>

          <view class="stat-card primary">
            <view class="stat-info">
              <text class="stat-label">治疗成本</text>
              <text class="stat-value">¥{{stats.totalCost}}</text>
            </view>
          </view>

          <view class="stat-card warning">
            <view class="stat-info">
              <text class="stat-label">平均成本</text>
              <text class="stat-value">¥{{stats.avgCostPerAnimal}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="empty-container" wx:if="{{records.length === 0}}">
        <t-empty>
          <view slot="description" class="empty-tip">
            <text class="tip-title">暂无治愈记录</text>
            <text class="tip-subtitle">请在治疗记录中点击"记录治愈"按钮</text>
            <text class="tip-subtitle">治愈后的记录将在此处显示</text>
          </view>
        </t-empty>
      </view>

      <!-- 记录列表 -->
      <view class="records-list" wx:if="{{records.length > 0}}">
        <view 
          class="record-card"
          wx:for="{{records}}"
          wx:key="_id"
          bind:tap="onRecordTap"
          data-id="{{item._id}}"
        >
        <!-- 记录头部 -->
        <view class="record-header">
          <view class="record-title-row">
            <text class="record-name">{{item.diagnosis.confirmed || item.diagnosis.preliminary}}</text>
            <t-tag 
              theme="success" 
              size="small" 
              class="status-tag"
            >
              已治愈
            </t-tag>
          </view>
        </view>

        <!-- 记录内容 -->
        <view class="record-content">
          <!-- 第一行：治疗编号 -->
          <view class="info-row" wx:if="{{item.treatmentNumber}}">
            <view class="info-group full-width">
              <text class="info-label">编号：</text>
              <text class="info-value">{{item.treatmentNumber}}</text>
            </view>
          </view>
          
          <!-- 信息行：批次 + 治愈数量 + 治疗数量 -->
          <view class="info-row">
            <view class="info-group">
              <text class="info-label">批次：</text>
              <text class="info-value">{{item.batchNumber || item.batchId}}</text>
            </view>
            <view class="info-group">
              <text class="info-label">治愈：</text>
              <text class="info-value cured-count">{{item.outcome.curedCount}} 只</text>
            </view>
            <view class="info-group" wx:if="{{item.outcome.totalTreated}}">
              <text class="info-label">治疗：</text>
              <text class="info-value">{{item.outcome.totalTreated}} 只</text>
            </view>
          </view>

          <!-- 底部：日期 + 记录者 -->
          <view class="record-footer">
            <view class="footer-left">
              <text class="date-text">{{item.treatmentDate}}</text>
              <text class="operator-text" wx:if="{{item.operatorName}}">{{item.operatorName}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 底部安全区域占位 -->
      <view class="safe-area"></view>
    </scroll-view>
  </view>

  <!-- 治愈记录详情弹窗 -->
  <cured-record-detail
    visible="{{showDetailPopup}}"
    record="{{selectedRecord}}"
    bind:close="closeDetailPopup"
  />
</view>

