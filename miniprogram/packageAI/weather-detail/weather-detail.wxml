<view class="weather-detail-page">
  <!-- 导航栏 -->
  <navigation-bar 
    title="天气详情"
    show-back="true"
    bind:back="onNavigateBack"
  />

  <scroll-view class="scroll-container" scroll-y enhanced="{{true}}" show-scrollbar="{{false}}">
    
    <!-- 当前天气卡片 - 使用 weather-card 组件 -->
    <weather-card
      class="current-weather-card"
      weather="{{weather}}"
      location="{{location}}"
      loading="{{false}}"
      has-error="{{false}}"
      clickable="{{false}}"
      show-update-time="{{false}}"
      bind:refresh="onPullDownRefresh"
    />

    <!-- 天气预警卡片 - 重新设计 -->
    <view class="card warning-card" wx:if="{{warningList.length > 0}}">
      <view class="card-header">
        <text class="card-title">天气预警</text>
        <t-tag theme="warning" variant="light" size="medium">{{warningList.length}}条</t-tag>
      </view>
      <view class="card-content">
        <view class="warning-list">
          <view class="warning-item warning-level-{{item.severityLevel}}" wx:for="{{warningList}}" wx:key="id">
            <view class="warning-main">
              <view class="warning-header-row">
                <t-tag theme="{{item.theme}}" size="medium">{{item.severity}}</t-tag>
                <text class="warning-type-name">{{item.typeName}}</text>
              </view>
              <text class="warning-title-text">{{item.title}}</text>
            </view>
            
            <!-- 预警详情（可展开） -->
            <view class="warning-details" wx:if="{{item.text}}">
              <text class="warning-text">{{item.text}}</text>
            </view>
            
            <!-- 时间信息 -->
            <view class="warning-footer">
              <view class="time-badge" wx:if="{{item.pubTime}}">
                <text class="time-text">{{item.pubTime}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 24小时预报卡片 - 重新设计 -->
    <view class="card hourly-forecast-card">
      <view class="card-header">
        <text class="card-title">24小时预报</text>
        <view class="next-hour-badge" wx:if="{{nextHourWeather}}">
          <text class="badge-text">{{nextHourWeather.desc}}</text>
        </view>
      </view>
      <view class="card-content">
        <scroll-view scroll-x class="hourly-scroll" show-scrollbar="{{false}}" enhanced="{{true}}">
          <view class="hourly-container">
            <view class="hourly-item {{index === 0 ? 'is-current' : ''}}" wx:for="{{hourlyForecast}}" wx:key="time">
              <text class="hour-label">{{item.timeLabel}}</text>
                <text class="hour-icon">{{item.icon}}</text>
                <text class="hour-temp">{{item.temp}}°</text>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- 空气质量卡片 - 重新设计 -->
    <view class="card air-quality-card" wx:if="{{airData}}">
      <view class="card-header">
        <text class="card-title">空气质量</text>
        <t-tag 
          theme="{{airData.aqi <= 50 ? 'success' : (airData.aqi <= 100 ? 'warning' : 'danger')}}" 
          variant="light" 
          size="medium"
        >
          {{airData.category}}
        </t-tag>
      </view>
      <view class="card-content">
        <!-- AQI主显示 - 参照iOS天气样式 -->
        <view class="aqi-main-display-ios">
          <view class="aqi-header-row">
            <text class="aqi-number-large">{{airData.aqi}}</text>
            <text class="aqi-separator">-</text>
            <text class="aqi-category-text">{{airData.category}}</text>
            </view>
          
          <!-- 彩色渐变进度条 -->
          <view class="aqi-gradient-bar">
            <view class="aqi-gradient-bg"></view>
            <view class="aqi-indicator" style="left: {{airData.progress}}%;"></view>
          </view>
        </view>
        
        <!-- 主要污染物 -->
        <view class="pollutants-summary-ios" wx:if="{{airData.pm2p5 || airData.pm10}}">
          <view class="pollutant-item-ios">
            <text class="pollutant-label-ios">PM2.5</text>
            <text class="pollutant-value-ios">{{airData.pm2p5}}</text>
          </view>
          <view class="pollutant-item-ios">
            <text class="pollutant-label-ios">PM10</text>
            <text class="pollutant-value-ios">{{airData.pm10}}</text>
          </view>
          <view class="pollutant-item-ios">
            <text class="pollutant-label-ios">O₃</text>
            <text class="pollutant-value-ios">{{airData.o3}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 详细指标卡片 - 重新设计 -->
    <view class="card weather-metrics-card">
      <view class="card-header">
        <text class="card-title">详细指标</text>
        <view class="metrics-badge">
          <text class="badge-text">实时数据</text>
        </view>
      </view>
      <view class="card-content">
        <view class="metrics-grid-custom">
          <view class="metric-item-custom">
            <text class="metric-value-custom">{{weather.humidity}}%</text>
            <text class="metric-label-custom">湿度</text>
            </view>
          
          <view class="metric-item-custom">
            <text class="metric-value-custom">{{weather.windScale}}</text>
            <text class="metric-label-custom">风力</text>
            </view>
          
          <view class="metric-item-custom">
            <text class="metric-value-custom">{{weather.visibility || '--'}}km</text>
            <text class="metric-label-custom">能见度</text>
            </view>
          
          <view class="metric-item-custom">
            <text class="metric-value-custom">{{weather.pressure || '--'}}</text>
            <text class="metric-label-custom">气压</text>
          </view>
            </view>
      </view>
    </view>


    <!-- 7天预报卡片 - iOS风格 -->
    <view class="card weekly-forecast-card">
      <view class="card-header">
        <text class="card-title">7日天气预报</text>
      </view>
      <view class="card-content">
        <view class="daily-list">
          <view class="daily-item {{index === 0 ? 'is-today' : ''}}" wx:for="{{dailyForecast}}" wx:key="date">
            <view class="day-section">
              <text class="day-name">{{item.dayName}}</text>
                <text class="day-icon">{{item.iconDay}}</text>
            </view>
            
            <view class="temp-section">
              <text class="temp-min">{{item.tempMin}}°</text>
              <view class="temp-bar-container">
                <view class="temp-bar-fill" style="width: {{item.tempProgress}}%;"></view>
              </view>
              <text class="temp-max">{{item.tempMax}}°</text>
            </view>
          </view>
        </view>
      </view>
    </view>




  </scroll-view>

</view>
