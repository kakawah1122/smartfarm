# 📊 历史鹅价数据导入指南

## 🎯 问题说明

**现象**：趋势图只显示一个数据点（11月8日）

**原因**：`goose_prices` 数据库集合中只有当前录入的一天数据，缺少10月30日到11月7日的历史数据。

**解决方案**：使用批量导入脚本将历史数据导入数据库。

---

## ⚡ 快速导入（推荐）

### 方法1：使用云函数导入

1. **创建临时云函数**
   - 打开：云开发控制台 → 云函数
   - 点击：新建云函数
   - 名称：`import-historical-prices`
   - 运行环境：Node.js 16

2. **复制导入代码**
   - 打开 `scripts/import-historical-prices.js`
   - 复制全部代码
   - 粘贴到云函数编辑器中
   - 点击：保存并安装依赖

3. **执行导入**
   - 点击：云端测试
   - 函数名：`import-historical-prices`
   - 点击：开始测试
   - 等待执行完成（约5-10秒）

4. **查看结果**
   ```json
   {
     "success": true,
     "message": "历史数据导入成功",
     "stats": {
       "imported": 10,
       "updated": 0,
       "total": 10
     }
   }
   ```

5. **验证数据**
   - 打开：云开发控制台 → 数据库 → goose_prices
   - 应该看到 10 条记录（10月30日 ~ 11月8日）

6. **删除临时云函数**
   - 导入完成后可以删除此云函数

---

### 方法2：手动录入（适合少量数据）

使用小程序的 **鹅价管理** 页面，逐日手动录入：

1. 进入：个人中心 → 鹅价管理
2. 选择日期：2025-10-30
3. 录入数据：
   - 中种鹅：38-41
   - 大种鹅：52-54
   - 特大种鹅：56-60
   - 120日龄：18.5-18.5
   - 130日龄：19-19
4. 保存
5. 重复步骤2-4，录入其他日期...

⚠️ **注意**：手动录入比较费时，推荐使用方法1。

---

## 📝 导入的数据明细

根据图2的表格，将导入以下数据：

| 日期 | 中种鹅 | 大种鹅 | 特大种鹅 | 120日龄 | 130日龄 |
|------|--------|--------|----------|---------|---------|
| 10-30 | 38-41 | 52-54 | 56-60 | 18.5 | 19.0 |
| 10-31 | 38-41 | 52-54 | 56-60 | 18.0 | 18.5 |
| 11-01 | 36-39 | 50-52 | 54-58 | 18.0 | 18.5 |
| 11-02 | 36-39 | 50-52 | 54-58 | 17.0 | 17.5 |
| 11-03 | 36-39 | 50-52 | 54-58 | 17.0 | 17.5 |
| 11-04 | 34-37 | 48-50 | 52-56 | 16.5 | 17.0 |
| 11-05 | 32-35 | 46-48 | 50-54 | 16.5 | 17.0 |
| 11-06 | 30-33 | 44-46 | 48-52 | 16.5 | 17.0 |
| 11-07 | 28-31 | 42-44 | 46-50 | 16.5 | 17.0 |
| 11-08 | 26-29 | 40-42 | 44-48 | 16.5 | 17.0 |

---

## ✅ 验证导入结果

### 1. 查看数据库
```
云开发控制台 → 数据库 → goose_prices

应该看到 10 条记录，每条记录包含：
- date: 日期字段
- goslingBreeds: 鹅苗价格数组（3个品种）
- meatBreeds: 肉鹅价格数组（2个日龄）
```

### 2. 查看趋势图
```
小程序 → 首页 → 点击鹅价卡片 → 鹅价详情

成鹅价格 tab：
- 应该显示 120日龄、130日龄 两个卡片
- 趋势图应该显示 10 个数据点（10月30日 ~ 11月8日）

鹅苗价格 tab：
- 应该显示 中种鹅、大种鹅、特大种鹅 三个卡片
- 趋势图应该显示完整的价格走势
```

### 3. 检查趋势
从图2的数据可以看出：
- ✅ **鹅苗价格**：持续下跌（10月30日 38-41 → 11月8日 26-29）
- ✅ **肉鹅价格**：稳中有降（10月30日 18.5-19 → 11月8日 16.5-17）

趋势图应该能清晰反映这个变化趋势。

---

## 🔧 故障排查

### 问题1：导入失败 - 权限不足
**错误**：`database permission denied`

**解决**：
```
云开发控制台 → 数据库 → goose_prices → 权限设置

改为：
{
  "read": true,
  "write": "auth.openid != null"
}
```

### 问题2：导入后趋势图仍然只有一个点
**可能原因**：
1. 小程序缓存未刷新
2. 数据格式不正确

**解决步骤**：
1. 关闭小程序，完全退出
2. 重新打开小程序
3. 进入鹅价详情页
4. 查看控制台日志，检查数据加载情况

### 问题3：部分日期数据缺失
**原因**：数据导入不完整

**解决**：
1. 检查云函数执行日志
2. 查看是否有错误信息
3. 重新执行导入脚本

---

## 📊 导入完成后的效果

### 趋势图示例（预期效果）

**中种鹅价格走势**：
```
45 ┤
40 ┤●
35 ┤  ●●
30 ┤      ●●●
25 ┤           ●●
   └──────────────────
   10-30        11-08
```

**120日龄价格走势**：
```
19.0 ┤●
18.5 ┤ ●●
18.0 ┤    ●●
17.5 ┤      ●
17.0 ┤       ●
16.5 ┤        ●●●●
     └──────────────────
     10-30        11-08
```

---

## 🎯 下一步

导入完成后：
1. ✅ 趋势图将显示完整的10天价格走势
2. ✅ 可以看到鹅价下跌的趋势
3. ✅ 为后续AI价格预测提供基础数据

---

## 📞 需要帮助？

如果遇到问题：
1. 查看云函数执行日志
2. 检查数据库记录数量
3. 重启小程序清除缓存
4. 查看控制台错误信息

导入成功后，趋势图应该能完整显示10天的价格变化！

