# ⚡ 立即操作 - 3步修复

## 🎯 问题

GEMINI成功（34秒），但触发信号超时（16秒），导致任务被错误标记为失败。

---

## ✅ 修复（3步，10分钟完成）

### 第1步：上传 ai-diagnosis 云函数 📤

**在微信开发者工具中**：
```
1. 找到 cloudfunctions/ai-diagnosis
2. 右键 → "上传并部署：云端安装依赖"  
3. 等待完成（约30秒）
```

**修改内容**：移除"触发超时就标记失败"的逻辑

---

### 第2步：配置云函数超时 ⏰

**打开控制台**：
```
微信开发者工具 → 顶部菜单"云开发" → "云开发控制台"
```

**配置2个云函数**：

#### A. process-ai-diagnosis
```
云函数列表 → process-ai-diagnosis
→ 函数配置 → 超时时间
→ 改为：150 秒
→ 保存 ✅
```

#### B. ai-multi-model
```
云函数列表 → ai-multi-model
→ 函数配置 → 超时时间
→ 改为：120 秒
→ 保存 ✅
```

---

### 第3步：测试 🧪

```
1. 打开 AI诊断页面
2. 上传 1张 清晰图片
3. 提交诊断
4. 等待 60-90秒（不要重复点击）
5. 看到诊断结果 ✅
```

---

## 📊 快速检查清单

- [ ] 上传 `ai-diagnosis` 云函数
- [ ] `process-ai-diagnosis` 超时改为 150秒
- [ ] `ai-multi-model` 超时改为 120秒
- [ ] 测试1张图片
- [ ] 成功！🎉

---

## 🎯 验证成功

### 正常日志（可能看到）

**ai-diagnosis**：
```
诊断任务已创建: xxx
⚠️ 触发信号超时（任务继续执行）  ← 这是正常的！
```

**process-ai-diagnosis**：
```
开始处理诊断任务
调用 ai-multi-model
诊断完成 ✅
```

**ai-multi-model**：
```
调用 Google Gemini API
执行时间: 34142ms
成功 ✅
```

### 前端显示

```
✅ 诊断中...（60-90秒）
✅ 诊断完成！
✅ 显示完整结果
```

---

## 💡 重点说明

### "触发信号超时"是正常的

```
触发超时 ≠ 任务失败

触发信号：ai-diagnosis → process-ai-diagnosis（可能超时16秒）
任务执行：process-ai-diagnosis 自己执行（配置150秒）

只要配置了超时，任务会继续执行并成功！
```

---

## ⚠️ 注意事项

1. **两个云函数都要配置**（不是三个）
   - ✅ process-ai-diagnosis: 150秒
   - ✅ ai-multi-model: 120秒
   - ❌ ai-diagnosis: 不需要改

2. **必须点击"保存"**
   - 修改后一定要保存

3. **等待2分钟后测试**
   - 配置需要生效时间

4. **只上传1张图片**
   - 多张图片需要更长时间

---

## 🆘 如果还是失败

**请提供**：
1. ai-diagnosis 日志（最新一条）
2. process-ai-diagnosis 日志（最新一条）
3. ai-multi-model 日志（最新一条）
4. 云函数配置截图（显示超时时间）

---

**现在就开始操作！** 🚀

第1步：上传 ai-diagnosis 云函数
第2步：配置2个云函数超时
第3步：测试1张图片

10分钟搞定！ ✨

